<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>梓樂Nagoya v65.0 (VJW + Map Fix)</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAMAAAAKE/YAAAAhUExURQAAAHCAj8W1tcW1tcW1tcW1tcW1tcW1tcW1tcW1tcW1tc/y0e0AAAALdFJOUwAAP19/gL+/z9/vI9vUOgAAAAlwSFlzAAAOwwAADsMBx2+oZAAABqZJREFUeNrtnQt7ojAMhU9baKHQvrf//7+8Q4FCoS1t0znn5Fy8w0eIIcnJJSGFAAAAAAAAAAAAAAAAAAAAAAAA4J+i67q+7/92Gf+aIAiC13A4/Osy/iU1x1uSJH9dxr+k5ng55/zP5fxLao638/n8r8v4l9QcbxVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1/R983bTtu9M07Z/4+rZt27Z9d/q+/xNf347jOI777gzD+ImvbydJkiTJuzMM4ye+vp0lWZZl784wjJ/4+naO53ie9+4Mw/iJr2/neZ7n+bvTNO2f+Pp2juM4jvvudF33J76+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6/pXfP2S53me99/x9cMwDMMw/H18/fV6vV6v/x1fP03TNE3T38fXT9M0TdPf8fXjOI7jOP4+vn4cx3Ec/x1fP0mSJEn+Pr5+kiRJkvwdXz/LsizL/j6+fpZlWZb9HV8/z/M8z/8+vn6e53me/x1fP8/zPM//Pr5+nud5nv8dX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV/Xv+Pr13G9Xq/X3/H167iu67quf8fXr+O6ruu6/h1fv47ruq7r+nd8/Tqu67qu69/x9eu4ruu6rn/H16/juq7rur6Ir6v4uoyvX8f1fd/3fX0RX1fxdRlfv47r+77v+/oivq7i6zK+fh3X933f9/VFfF3F12V8/Tqu7/u+7+uL+LqKr8v4+nVcPwiC4C/j6yq+LuPr13H9IAiCv4yvq/i6jK9fx/WDIAj+Mr6u4usyvn4d1w+CIPjL+LqKr8v4+nVcPwiC4C/j6yq+LuPr13H9IAiCv4yvq/i6jK9fx/WDIAj+Mr6u4usyvn4d1w+CIPjL+LqKr8v4+nVcPwiC4C/j6yq+LuPr13H9IAiC/4Ovi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyv/wN9F4L72+M1OAAAAABJRU5ErkJggg==">
    <link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAMAAAAKE/YAAAAhUExURQAAAHCAj8W1tcW1tcW1tcW1tcW1tcW1tcW1tcW1tcW1tc/y0e0AAAALdFJOUwAAP19/gL+/z9/vI9vUOgAAAAlwSFlzAAAOwwAADsMBx2+oZAAABqZJREFUeNrtnQt7ojAMhU9baKHQvrf//7+8Q4FCoS1t0znn5Fy8w0eIIcnJJSGFAAAAAAAAAAAAAAAAAAAAAAAA4J+i67q+7/92Gf+aIAiC13A4/Osy/iU1x1uSJH9dxr+k5ng55/zP5fxLao638/n8r8v4l9QcbxVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1/R983bTtu9M07Z/4+rZt27Z9d/q+/xNf347jOI777gzD+ImvbydJkiTJuzMM4ye+vp0lWZZl784wjJ/4+naO53ie9+4Mw/iJr2/neZ7n+bvTNO2f+Pp2juM4jvvudF33J76+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6/pXfP2S53me99/x9cMwDMMw/H18/fV6vV6v/x1fP03TNE3T38fXT9M0TdPf8fXjOI7jOP4+vn4cx3Ec/x1fP0mSJEn+Pr5+kiRJkvwdXz/LsizL/j6+fpZlWZb9HV8/z/M8z/8+vn6e53me/x1fP8/zPM//Pr5+nud5nv8dX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV/Xv+Pr13G9Xq/X3/H167iu67quf8fXr+O6ruu6/h1fv47ruq7r+nd8/Tqu67qu69/x9eu4ruu6rn/H16/juq7rur6Ir6v4uoyvX8f1fd/3fX0RX1fxdRlfv47r+77v+/oivq7i6zK+fh3X933f9/VFfF3F12V8/Tqu7/u+7+uL+LqKr8v4+nVcPwiC4C/j6yq+LuPr13H9IAiCv4yvq/i6jK9fx/WDIAj+Mr6u4usyvn4d1w+CIPjL+LqKr8v4+nVcPwiC4C/j6yq+LuPr13H9IAiCv4yvq/i6jK9fx/WDIAj+Mr6u4usyvn4d1w+CIPjL+LqKr8v4+nVcPwiC4C/j6yq+LuPr13H9IAiC/4Ovi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyv/wN9F4L72+M1OAAAAABJRU5ErkJggg==">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3.4.19/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&family=Shippori+Mincho:wght@600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg-main: #70808f; --bg-card: #c5b59d; --text-on-card: #4a4238; --text-on-bg: #f3f0eb; }
        body { font-family: 'Zen Maru Gothic', sans-serif; background-color: var(--bg-main); color: var(--text-on-bg); margin: 0; padding: 0; height: 100dvh; width: 100vw; overflow: hidden; -webkit-tap-highlight-color: transparent; }
        .font-mincho { font-family: 'Shippori Mincho', serif; }
        .glass { background: var(--bg-card); color: var(--text-on-card); border: 1px solid rgba(255,255,255,0.3); border-radius: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-top { padding-top: max(20px, env(safe-area-inset-top)); }
        .safe-bottom { padding-bottom: max(20px, env(safe-area-inset-bottom)); }
        input { user-select: text !important; pointer-events: auto !important; }
        .modal-layer { position: fixed; inset: 0; z-index: 99999; }
        .modal-content { position: relative; z-index: 100000; }
        @keyframes slide-up { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slide-up 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .ticket-stub { clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 70%, 5% 65%, 0% 60%, 0% 0%); cursor: pointer; transition: transform 0.1s; }
        .ticket-stub:active { transform: scale(0.98); }
        .method-online { background: #e6f4ea; color: #1e4620; border-left: 4px solid #34a853; }
        .method-onsite { background: #fef7e0; color: #5f370e; border-left: 4px solid #fbbc04; }
        .method-mobile { background: #f1f3f4; color: #3c4043; border-left: 4px solid #9aa0a6; }
        .sync-status { position: fixed; top: 10px; right: 10px; z-index: 9999; font-size: 10px; font-weight: bold; padding: 4px 8px; border-radius: 20px; background: rgba(0,0,0,0.5); color: white; display: flex; items-center; gap: 5px; }
        [v-cloak] { display: none !important; }
        .toggle-btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .phrase-card:active { transform: scale(0.95); background: white; }
    </style>
</head>
<body>

<div id="app" v-cloak class="flex flex-col h-full w-full max-w-md mx-auto relative bg-[#70808f]">
    
    <div class="sync-status" v-if="syncStatus">
        <div class="w-2 h-2 rounded-full" :class="syncColor"></div>
        {{ syncStatus }}
    </div>

    <main v-show="!isModalOpen" class="flex-1 overflow-y-auto no-scrollbar z-10 pb-28 pt-safe-top px-5 scroll-smooth relative">
        
        <div v-if="currentView === 'itinerary'" class="space-y-5 pb-4">
            <div class="flex justify-between items-center mb-2 mt-2">
                <div>
                    <div class="text-[10px] font-bold text-white/80 uppercase tracking-widest">JP.TRIP 2026</div>
                    <h1 class="text-3xl font-black font-mincho text-white flex items-center gap-2"><i class="fas fa-chess-rook text-xl opacity-80"></i> 梓樂Nagoya</h1>
                </div>
                <div class="w-10 h-10 rounded-full border-2 border-white/50 overflow-hidden shadow-lg bg-[#70808f] flex items-center justify-center">
                    <i class="fas fa-mountain text-white text-xl"></i>
                </div>
            </div>
            
            <div class="glass p-5 relative overflow-hidden mb-2 shadow-xl">
                <div class="flex justify-between items-end mb-2"><span class="text-xs font-bold opacity-60 uppercase tracking-wider">距離出發 (HKO)</span><i class="fas fa-plane text-[#726251] animate-pulse"></i></div>
                <div class="flex items-baseline gap-2 mb-4">
                    <span class="text-5xl font-black font-mono tracking-tighter">{{ countdown.days }}</span><span class="text-xs font-bold opacity-80 mr-2">days</span>
                    <span class="text-xl font-mono font-bold">{{ countdown.hours }}</span><span class="text-[10px] opacity-60 mr-1">h</span>
                    <span class="text-xl font-mono font-bold">{{ countdown.minutes }}</span><span class="text-[10px] opacity-60 mr-1">m</span>
                    <span class="text-xl font-mono font-bold">{{ countdown.seconds }}</span><span class="text-[10px] opacity-60">s</span>
                </div>
                <div class="relative w-full h-2 bg-[#4a4238]/10 rounded-full mt-2"><div class="absolute top-0 left-0 h-full bg-[#726251] rounded-full transition-all duration-1000" :style="{ width: tripProgress + '%' }"></div></div>
            </div>

            <div class="bg-[#70808f] sticky top-0 z-30 py-2 -mx-5 px-5 border-b border-[#c5b59d]/30 shadow-lg">
                <div class="flex gap-3 overflow-x-auto no-scrollbar">
                    <button v-for="(day, idx) in itinerary" :key="idx" @click="dayIndex = idx" class="flex-shrink-0 w-12 h-14 rounded-xl flex flex-col items-center justify-center border transition-all cursor-pointer active:scale-95" :class="dayIndex === idx ? 'bg-[#c5b59d] text-[#4a4238] border-[#c5b59d] shadow-lg scale-105' : 'bg-white/10 border-white/10 text-white/60'">
                        <span class="text-[9px] font-bold uppercase">{{ day.date_en.substr(0,3) }}</span>
                        <span class="text-lg font-black">{{ day.date_short.split('/')[1] }}</span>
                    </button>
                </div>
            </div>

            <div class="glass p-3 border-l-4 border-[#726251] flex items-center justify-between">
                <div class="flex flex-col"><span class="text-[10px] font-bold opacity-60 uppercase tracking-wider">{{ itinerary[dayIndex].date_short }} Weather</span><span class="text-xs font-bold">{{ itinerary[dayIndex].location }}</span></div>
                <div class="flex gap-3 overflow-x-auto no-scrollbar max-w-[65%]"><div v-for="(h, i) in currentDayWeather" :key="i" class="flex flex-col items-center min-w-[2.5rem]"><span class="text-[9px] opacity-60 font-mono">{{ h.time }}</span><i :class="h.icon" class="text-sm my-0.5"></i><span class="text-[10px] font-bold">{{ h.temp }}</span></div></div>
            </div>
            <div class="relative pl-2">
                <div class="absolute left-[7px] top-2 bottom-0 w-[2px] bg-[#c5b59d]/30 rounded-full"></div>
                <div v-for="(place, pIdx) in itinerary[dayIndex].places" :key="pIdx" class="relative pl-8 mb-6 group">
                    <div class="absolute left-0 top-0 w-4 h-4 bg-[#c5b59d] border-[3px] border-[#70808f] rounded-full z-10" :class="getTypeColor(place.type)"></div>
                    <div @click="openDetail(place)" class="glass p-4 relative overflow-hidden active:scale-[0.98] transition-all cursor-pointer hover:bg-[#d6c9b5] z-10">
                        <div class="flex justify-between items-start mb-2 relative z-10"><span class="text-[10px] font-black bg-[#70808f] text-white px-2 py-1 rounded">{{ place.time }}</span><span class="text-[10px] font-bold opacity-60 uppercase">{{ place.typeLabel }}</span></div>
                        <h3 class="text-lg font-black mb-1 relative z-10">{{ place.name }}</h3><p class="text-xs opacity-80 line-clamp-1 mb-2 relative z-10">{{ place.desc }}</p>
                        <div class="flex flex-wrap gap-2 mt-2 relative z-10"><span v-for="tag in place.highlights" class="px-2 py-1 bg-white/50 border border-black/5 rounded text-[10px] font-bold text-[#726251]">{{ tag }}</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'wallet'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">Spend & Buy</h2>
            <div class="flex bg-white/10 p-1 rounded-xl"><button @click="walletMode='expense'" class="flex-1 py-3 rounded-lg text-xs font-bold transition-all" :class="walletMode==='expense'?'bg-[#c5b59d] text-[#4a4238] shadow-sm':'text-white/60'">記帳</button><button @click="walletMode='wishlist'" class="flex-1 py-3 rounded-lg text-xs font-bold transition-all" :class="walletMode==='wishlist'?'bg-[#c5b59d] text-[#4a4238] shadow-sm':'text-white/60'">購物</button></div>
            <div v-if="walletMode==='expense'" class="space-y-4">
                <div class="grid grid-cols-3 gap-2">
                    <div @click="budgetFilter='All'" class="glass p-3 flex flex-col items-center justify-center cursor-pointer transition-all border-2" :class="budgetFilter==='All'?'border-[#726251] bg-[#d6c9b5]':'border-transparent'"><span class="text-[9px] font-bold opacity-60 uppercase">Total</span><span class="text-sm font-black">¥{{ totalSpent.toLocaleString() }}</span></div>
                    <div @click="budgetFilter='TszLok'" class="glass p-3 flex flex-col items-center justify-center cursor-pointer transition-all border-2" :class="budgetFilter==='TszLok'?'border-[#91867f] bg-[#d6c9b5]':'border-transparent'"><span class="text-[9px] font-bold opacity-60 uppercase">TszLok</span><span class="text-sm font-black">¥{{ spentTszLok.toLocaleString() }}</span></div>
                    <div @click="budgetFilter='TszTung'" class="glass p-3 flex flex-col items-center justify-center cursor-pointer transition-all border-2" :class="budgetFilter==='TszTung'?'border-[#726251] bg-[#d6c9b5]':'border-transparent'"><span class="text-[9px] font-bold opacity-60 uppercase">TszTung</span><span class="text-sm font-black">¥{{ spentTszTung.toLocaleString() }}</span></div>
                </div>
                <div class="glass p-3 flex justify-between items-center bg-[#f3f0eb]/50"><span class="text-xs font-bold opacity-60">HKD Approx.</span><span class="text-lg font-mono font-black">HKD ${{ (filteredTotal * currencyRate).toFixed(1) }}</span></div>
                <div class="space-y-3 pb-20"><div v-for="(item, idx) in filteredBudgetList" :key="idx" class="glass p-4 flex justify-between items-center"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full flex items-center justify-center text-xs text-white shadow-sm" :class="item.payer==='TszLok'?'bg-[#91867f]':'bg-[#726251]'">{{ item.payer[0] }}</div><span class="text-sm font-bold">{{ item.name }}</span></div><div class="flex flex-col items-end"><span class="font-mono font-bold opacity-80">¥{{ item.price }}</span><span class="text-[9px] font-mono opacity-50">HKD ${{ (item.price * currencyRate).toFixed(1) }}</span></div><button @click="deleteBudget(item)" class="opacity-40 hover:text-red-600 ml-2"><i class="fas fa-times text-xs"></i></button></div></div>
                <div class="fixed bottom-24 right-6 z-40"><button @click="showBudgetInput=true" class="w-14 h-14 bg-[#c5b59d] text-[#4a4238] rounded-full shadow-xl flex items-center justify-center text-xl border-2 border-white/20 active:scale-90 transition-transform"><i class="fas fa-plus"></i></button></div>
            </div>
            <div v-if="walletMode==='wishlist'" class="grid grid-cols-2 gap-4 pb-20">
                <div @click="showWishlistInput=true" class="glass p-4 flex flex-col items-center justify-center aspect-square border-2 border-dashed border-[#4a4238]/20 hover:bg-[#d6c9b5] cursor-pointer opacity-60 hover:opacity-100 transition-opacity"><i class="fas fa-plus text-2xl mb-2"></i><span class="text-xs font-bold">Add Item</span></div>
                <div v-for="(item, idx) in wishlist" :key="idx" class="glass overflow-hidden relative group"><button @click="deleteWishlist(idx)" class="absolute top-2 right-2 w-6 h-6 bg-black/60 rounded-full flex items-center justify-center text-xs z-10 text-white shadow-md"><i class="fas fa-times"></i></button><img v-if="item.image" :src="item.image" class="w-full aspect-square object-cover"><div v-else class="w-full aspect-square bg-[#4a4238]/10 flex items-center justify-center flex-col p-2 text-center"><i class="fas fa-shopping-bag text-2xl mb-2 opacity-30"></i></div><div class="p-3"><div class="font-bold text-sm truncate">{{ item.name }}</div><div class="font-mono text-xs font-bold opacity-60">¥{{ item.price }}</div><div class="font-mono text-[9px] font-bold opacity-40">HKD ${{ (item.price * currencyRate).toFixed(1) }}</div></div></div>
            </div>
        </div>

        <div v-if="currentView === 'packing'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">行李清單</h2>
            <div class="flex bg-white/10 p-1 rounded-xl mb-4">
                <button @click="packingTab='TszLok'" class="flex-1 py-3 rounded-lg text-xs font-bold transition-all toggle-btn" :class="packingTab==='TszLok'?'bg-[#91867f] text-white shadow-sm':'text-white/60'">TszLok (Boy)</button>
                <button @click="packingTab='TszTung'" class="flex-1 py-3 rounded-lg text-xs font-bold transition-all toggle-btn" :class="packingTab==='TszTung'?'bg-[#726251] text-white shadow-sm':'text-white/60'">TszTung (Girl)</button>
            </div>
            <div v-if="packingTab==='TszLok'" class="space-y-4 animate-slide-up">
                <div class="glass overflow-hidden"><div class="bg-[#91867f]/20 px-5 py-3 flex items-center gap-3 border-b border-[#4a4238]/10"><i class="fas fa-briefcase text-[#91867f]"></i><span class="font-bold text-sm uppercase">TszLok Hand Carry</span></div><div class="p-2 grid gap-1"><label v-for="(item, idx) in packingList.tszLok.handCarry" :key="idx" class="flex items-center p-3 hover:bg-white/10 rounded-xl cursor-pointer check-box"><input type="checkbox" v-model="item.checked" @change="saveData" class="hidden"><div class="w-5 h-5 rounded border-2 border-[#4a4238]/30 flex items-center justify-center mr-3 bg-white/50"><i class="fas fa-check text-[#4a4238] text-[10px] opacity-0" :class="{'opacity-100': item.checked}"></i></div><span class="text-sm font-bold" :class="{'line-through opacity-40': item.checked}">{{ item.name }}</span></label></div></div>
                <div class="glass overflow-hidden"><div class="bg-[#91867f]/20 px-5 py-3 flex items-center gap-3 border-b border-[#4a4238]/10"><i class="fas fa-suitcase text-[#91867f]"></i><span class="font-bold text-sm uppercase">TszLok Luggage</span></div><div class="p-2 grid gap-1"><label v-for="(item, idx) in packingList.tszLok.luggage" :key="idx" class="flex items-center p-3 hover:bg-white/10 rounded-xl cursor-pointer check-box"><input type="checkbox" v-model="item.checked" @change="saveData" class="hidden"><div class="w-5 h-5 rounded border-2 border-[#4a4238]/30 flex items-center justify-center mr-3 bg-white/50"><i class="fas fa-check text-[#4a4238] text-[10px] opacity-0" :class="{'opacity-100': item.checked}"></i></div><span class="text-sm font-bold" :class="{'line-through opacity-40': item.checked}">{{ item.name }}</span></label></div></div>
            </div>
            <div v-if="packingTab==='TszTung'" class="space-y-4 animate-slide-up">
                <div class="glass overflow-hidden"><div class="bg-[#726251]/20 px-5 py-3 flex items-center gap-3 border-b border-[#4a4238]/10"><i class="fas fa-briefcase text-[#726251]"></i><span class="font-bold text-sm uppercase">TszTung Hand Carry</span></div><div class="p-2 grid gap-1"><label v-for="(item, idx) in packingList.tszTung.handCarry" :key="idx" class="flex items-center p-3 hover:bg-white/10 rounded-xl cursor-pointer check-box"><input type="checkbox" v-model="item.checked" @change="saveData" class="hidden"><div class="w-5 h-5 rounded border-2 border-[#4a4238]/30 flex items-center justify-center mr-3 bg-white/50"><i class="fas fa-check text-[#4a4238] text-[10px] opacity-0" :class="{'opacity-100': item.checked}"></i></div><span class="text-sm font-bold" :class="{'line-through opacity-40': item.checked}">{{ item.name }}</span></label></div></div>
                <div class="glass overflow-hidden"><div class="bg-[#726251]/20 px-5 py-3 flex items-center gap-3 border-b border-[#4a4238]/10"><i class="fas fa-suitcase text-[#726251]"></i><span class="font-bold text-sm uppercase">TszTung Luggage</span></div><div class="p-2 grid gap-1"><label v-for="(item, idx) in packingList.tszTung.luggage" :key="idx" class="flex items-center p-3 hover:bg-white/10 rounded-xl cursor-pointer check-box"><input type="checkbox" v-model="item.checked" @change="saveData" class="hidden"><div class="w-5 h-5 rounded border-2 border-[#4a4238]/30 flex items-center justify-center mr-3 bg-white/50"><i class="fas fa-check text-[#4a4238] text-[10px] opacity-0" :class="{'opacity-100': item.checked}"></i></div><span class="text-sm font-bold" :class="{'line-through opacity-40': item.checked}">{{ item.name }}</span></label></div></div>
            </div>
        </div>

        <div v-if="currentView === 'reservations'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">預約 & 票券 Resv</h2>
            
            <div class="glass p-5 border-l-4 border-blue-500 mb-4 bg-white/20">
                <h3 class="text-xs font-bold uppercase tracking-widest text-[#4a4238] mb-3"><i class="fas fa-qrcode mr-2"></i>Visit Japan Web (入境 QR)</h3>
                <div class="flex gap-3">
                    <a href="https://www.vjw.digital.go.jp/main/#/vjwpti006" target="_blank" class="flex-1 py-3 bg-[#91867f] text-white text-center rounded-xl font-bold shadow-md active:scale-95 transition-transform text-sm"><i class="fas fa-male mr-1"></i> TszLok</a>
                    <a href="https://www.vjw.digital.go.jp/main/#/vjwpic026" target="_blank" class="flex-1 py-3 bg-[#726251] text-white text-center rounded-xl font-bold shadow-md active:scale-95 transition-transform text-sm"><i class="fas fa-female mr-1"></i> TszTung</a>
                </div>
            </div>

            <div class="space-y-3">
                <div class="glass p-0 overflow-hidden relative border-l-4 border-[#91867f]">
                    <div class="bg-[#91867f]/10 p-3 flex justify-between items-center border-b border-[#4a4238]/10"><span class="text-xs font-bold uppercase tracking-widest text-[#91867f]">HOTEL</span><span class="text-xs font-bold text-[#4a4238]">Day 1-3</span></div>
                    <div class="p-4">
                        <div class="font-black text-lg mb-1">西鐵酒店 Croom 名古屋</div>
                        <div class="text-xs opacity-90 mb-1 font-bold">確認號: 1359041951884860 | PIN: 9525</div>
                        <div class="text-xs opacity-70 mb-2">入住: 2/25 (15:00) - 退房: 2/28 (11:00)</div>
                        <div class="text-xs opacity-50 selectable">愛知県名古屋市中区錦3丁目4-3 (Tel: +81-52-9635959)</div>
                        <button @click="detailModal={show:true, data:{isVoucher:true, title:'西鐵酒店 Croom 名古屋', confirm:'1359041951884860', pin:'9525', order:'1359041951884810', dates:'2/25 - 2/28', address:'3 Chome-4-3 Nishiki, Naka Ward, Nagoya', tel:'+81-52-9635959', room:'Comfort Double (Non-smoking)', guest:'Lo Tsz Lok', price:'HK$2,545.30 (Paid)', cancel:'2/24 23:00 前免費取消'}}" class="mt-3 block w-full py-3 bg-[#91867f] text-white text-center rounded-xl font-bold shadow-md active:scale-95 transition-transform text-sm"><i class="fas fa-file-invoice mr-2"></i>查看電子憑證 (Digital Voucher)</button>
                    </div>
                </div>
                <div class="glass p-0 overflow-hidden relative border-l-4 border-[#726251]">
                    <div class="bg-[#726251]/10 p-3 flex justify-between items-center border-b border-[#4a4238]/10"><span class="text-xs font-bold uppercase tracking-widest text-[#726251]">HOTEL</span><span class="text-xs font-bold text-[#4a4238]">Day 4-6</span></div>
                    <div class="p-4">
                        <div class="font-black text-lg mb-1">東急 STAY 飛驒高山 結之湯</div>
                        <div class="text-xs opacity-90 mb-1 font-bold">確認號: 6185199858 | PIN: 8900</div>
                        <div class="text-xs opacity-70 mb-2">入住: 2/28 (15:00) - 退房: 3/3 (11:00)</div>
                        <div class="text-xs opacity-50 selectable">岐阜県高山市花里町4丁目301 (Tel: +81-577-361109)</div>
                        <div class="mt-2 text-[10px] text-red-800 bg-red-100 px-2 py-1 rounded inline-block">需現場支付溫泉稅 (約 ¥900/房)</div>
                        <button @click="detailModal={show:true, data:{isVoucher:true, title:'東急 STAY 飛驒高山 結之湯', confirm:'6185199858', pin:'8900', order:'1359041951886445', dates:'2/28 - 3/3', address:'Hanasatomachi 4-301, Takayama, Gifu', tel:'+81-577-361109', room:'Comfort Double (1 Large Bed)', guest:'Lo Tsz Lok', price:'HK$2,830.73 (Paid) + ¥900 Tax', cancel:'2/25 23:59 前免費取消'}}" class="mt-3 block w-full py-3 bg-[#726251] text-white text-center rounded-xl font-bold shadow-md active:scale-95 transition-transform text-sm"><i class="fas fa-file-invoice mr-2"></i>查看電子憑證 (Digital Voucher)</button>
                    </div>
                </div>
                <div class="glass p-0 overflow-hidden relative border-l-4 border-[#91867f]"><div class="bg-[#91867f]/10 p-3 flex justify-between items-center border-b border-[#4a4238]/10"><span class="text-xs font-bold uppercase tracking-widest text-[#91867f]">Outbound</span><span class="text-xs font-bold text-[#4a4238]">2/25 (Wed)</span></div><div class="p-4 flex justify-between items-center"><div class="text-center"><div class="text-2xl font-black font-mono">HKG</div></div><div class="flex flex-col items-center px-4"><i class="fas fa-arrow-right text-[#91867f] mb-1"></i><div class="text-[10px] font-bold bg-[#4a4238] text-white px-2 py-0.5 rounded">UO680</div></div><div class="text-center"><div class="text-2xl font-black font-mono">NGO</div></div></div></div>
                <div class="glass p-0 overflow-hidden relative border-l-4 border-[#726251]"><div class="bg-[#726251]/10 p-3 flex justify-between items-center border-b border-[#4a4238]/10"><span class="text-xs font-bold uppercase tracking-widest text-[#726251]">Inbound</span><span class="text-xs font-bold text-[#4a4238]">3/3 (Tue)</span></div><div class="p-4 flex justify-between items-center"><div class="text-center"><div class="text-2xl font-black font-mono">NGO</div></div><div class="flex flex-col items-center px-4"><i class="fas fa-arrow-right text-[#726251] mb-1"></i><div class="text-[10px] font-bold bg-[#4a4238] text-white px-2 py-0.5 rounded">UO685</div></div><div class="text-center"><div class="text-2xl font-black font-mono">HKG</div></div></div></div>
            </div>
            
            <div><div class="flex items-center gap-2 mb-2 text-white/80"><span class="w-2 h-2 rounded-full bg-[#34a853] shadow-[0_0_10px_#34a853]"></span><h3 class="text-xs font-bold uppercase tracking-widest">現在就買 Online</h3></div><div class="space-y-2"><div v-for="(item, i) in getTicketsByMethod('online')" :key="i" @click="openTicketDetail(item)" class="ticket-stub p-4 rounded-r-xl flex justify-between items-center shadow-md bg-white border-l-4 border-[#34a853]"><div class="flex flex-col"><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-black uppercase opacity-60 text-[#4a4238]">Day {{ item.date.split('/')[1] }}</span><span class="text-[10px] font-bold bg-black/5 px-1.5 rounded">{{ item.date }}</span></div><div class="font-black text-sm text-[#4a4238] leading-tight">{{ item.title }}</div></div><div class="text-right"><i class="fas fa-chevron-right text-xs opacity-30"></i></div></div></div></div>
            <div><div class="flex items-center gap-2 mb-2 text-white/80"><span class="w-2 h-2 rounded-full bg-[#fbbc04] shadow-[0_0_10px_#fbbc04]"></span><h3 class="text-xs font-bold uppercase tracking-widest">現場購買 Onsite</h3></div><div class="space-y-2"><div v-for="(item, i) in getTicketsByMethod('onsite')" :key="i" @click="openTicketDetail(item)" class="ticket-stub p-4 rounded-r-xl flex justify-between items-center shadow-md bg-white border-l-4 border-[#fbbc04]"><div class="flex flex-col"><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-black uppercase opacity-60 text-[#4a4238]">Day {{ item.date.split('/')[1] }}</span><span class="text-[10px] font-bold bg-black/5 px-1.5 rounded">{{ item.date }}</span></div><div class="font-black text-sm text-[#4a4238] leading-tight">{{ item.title }}</div></div><div class="text-right"><i class="fas fa-chevron-right text-xs opacity-30"></i></div></div></div></div>
            <div><div class="flex items-center gap-2 mb-2 text-white/80"><span class="w-2 h-2 rounded-full bg-[#9aa0a6] shadow-[0_0_10px_#9aa0a6]"></span><h3 class="text-xs font-bold uppercase tracking-widest">數位支付 Mobile</h3></div><div class="space-y-2"><div v-for="(item, i) in getTicketsByMethod('mobile')" :key="i" @click="openTicketDetail(item)" class="ticket-stub p-4 rounded-r-xl flex justify-between items-center shadow-md bg-white border-l-4 border-[#9aa0a6]"><div class="flex flex-col"><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-black uppercase opacity-60 text-[#4a4238]">Day {{ item.date.split('/')[1] }}</span><span class="text-[10px] font-bold bg-black/5 px-1.5 rounded">{{ item.date }}</span></div><div class="font-black text-sm text-[#4a4238] leading-tight">{{ item.title }}</div></div><div class="text-right"><i class="fas fa-chevron-right text-xs opacity-30"></i></div></div></div></div>
        </div>

        <div v-if="currentView === 'reminders'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">省錢 & 攻略 Tips</h2>
            <div class="glass overflow-hidden relative"><div class="bg-[#70808f] p-3 text-white flex justify-between items-center border-b border-white/20"><span class="font-bold text-sm"><i class="fas fa-key mr-2"></i>寄放行李</span><span class="bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold">Coin Locker</span></div><div class="p-5"><h3 class="font-bold text-lg mb-2 text-[#4a4238]">名古屋站/高山站</h3><ul class="text-sm space-y-3 opacity-90 leading-relaxed list-disc pl-4 text-[#4a4238]"><li><b class="text-[#726251]">IC 卡付款：</b>大部分置物櫃可用 Suica/Pasmo 付款，不用找零錢，且鑰匙就是你的卡。</li><li><b class="text-[#726251]">高山站：</b>若車站置物櫃滿了，可去對面的「高山濃飛巴士中心」找置物櫃。</li></ul></div></div>
            <div class="glass overflow-hidden relative"><div class="bg-[#91867f] p-3 text-white flex justify-between items-center border-b border-white/20"><span class="font-bold text-sm"><i class="fas fa-print mr-2"></i>緊急列印</span><span class="bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold">7-11</span></div><div class="p-5"><h3 class="font-bold text-lg mb-2 text-[#4a4238]">車票沒電怎麼辦？</h3><p class="text-sm opacity-90 text-[#4a4238] mb-2">如果手機沒電無法出示車票 PDF，可去 7-11 使用多功能事務機。</p><div class="bg-[#726251]/10 p-2 rounded text-xs font-bold text-[#726251]">下載「netprint」App 上傳 PDF，去 7-11 輸入預約號碼列印。</div></div></div>
            <div class="glass overflow-hidden relative"><div class="bg-[#70808f] p-3 text-white flex justify-between items-center border-b border-white/20"><span class="font-bold text-sm"><i class="fas fa-subway mr-2"></i>Day 3 交通</span><span class="bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold">¥760 / 24hr</span></div><div class="p-5"><h3 class="font-bold text-lg mb-2 text-[#4a4238]">地鐵 24 小時券</h3><ul class="text-sm space-y-3 opacity-90 leading-relaxed list-disc pl-4 text-[#4a4238]"><li><b class="text-[#726251]">回本極快：</b>行程總車資約 ¥1,000+，使用此券<span class="font-bold border-b border-[#726251]">現省 ¥300</span>。</li><li><b class="text-[#726251]">彈性極高：</b>採「24小時制」。若 Day 3 早上 10:00 第一次刷卡，可用到 Day 4 早上 09:59。</li></ul></div></div>
            <div class="glass overflow-hidden relative"><div class="bg-[#91867f] p-3 text-white flex justify-between items-center border-b border-white/20"><span class="font-bold text-sm"><i class="fas fa-snowflake mr-2"></i>Day 6 警告</span><span class="bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold">安全第一</span></div><div class="p-5"><h3 class="font-bold text-lg mb-2 text-[#4a4238]">平湯大瀑布 雪地裝備</h3><div class="bg-red-500/10 p-3 rounded-lg mb-3 text-sm font-bold border-l-4 border-red-500 text-red-800">地面極滑！Danger!</div><p class="text-sm opacity-90 text-[#4a4238]">前往瀑布的路段為雪地微上坡，極易結冰滑倒。請務必穿著<b class="text-red-700">防滑鞋 (雪靴)</b> 或加裝簡易冰爪。</p></div></div>
        </div>

        <div v-if="currentView === 'tools'" class="space-y-6 pt-4 h-full flex flex-col">
            <h2 class="text-2xl font-black font-mincho text-white">隨身工具 Tools</h2>
            <div class="glass p-5">
                <h3 class="text-sm font-bold opacity-60 uppercase mb-3"><i class="fas fa-language mr-2"></i>指路卡 Speak for me</h3>
                <div class="grid grid-cols-2 gap-3">
                    <button v-for="p in phrases" :key="p.zh" @click="detailModal={show:true, data:{isPhrase:true, ...p}}" class="bg-white/50 p-4 rounded-xl text-left hover:bg-white transition-colors border border-[#4a4238]/10 phrase-card">
                        <div class="text-xs font-bold opacity-60 mb-1">{{ p.zh }}</div>
                        <div class="font-bold text-lg text-[#4a4238]">{{ p.jp_short }}</div>
                    </button>
                </div>
            </div>
            <div class="glass p-5 border-l-4 border-red-500">
                <h3 class="text-sm font-bold opacity-60 uppercase mb-3"><i class="fas fa-phone-alt mr-2 text-red-500"></i>緊急聯絡 Emergency</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center border-b border-[#4a4238]/10 pb-2"><span class="font-bold">警察局 (Police)</span><a href="tel:110" class="bg-red-500 text-white px-3 py-1 rounded-lg font-black text-sm">110</a></div>
                    <div class="flex justify-between items-center border-b border-[#4a4238]/10 pb-2"><span class="font-bold">救護車/火警 (Fire)</span><a href="tel:119" class="bg-red-500 text-white px-3 py-1 rounded-lg font-black text-sm">119</a></div>
                    <div class="mt-2"><div class="text-[10px] font-bold opacity-50 uppercase">駐日辦事處 (HK Immigration)</div><div class="font-bold text-sm mt-1 selectable">+852 1868</div></div>
                </div>
            </div>
            <div class="glass p-5">
                <h3 class="text-sm font-bold opacity-60 uppercase mb-3"><i class="fas fa-map-marker-alt mr-2"></i>飯店地址 Hotel Address</h3>
                <div class="bg-[#f3f0eb] p-3 rounded-lg border border-[#4a4238]/20 mb-3"><div class="text-[10px] opacity-60 mb-1">Nagoya (Day 1-3)</div><div class="font-black text-sm text-[#726251]">西鉄ホテル クルーム 名古屋</div><div class="text-xs opacity-80 mt-1 selectable">愛知県名古屋市中区錦3-4-3</div></div>
                <div class="bg-[#f3f0eb] p-3 rounded-lg border border-[#4a4238]/20"><div class="text-[10px] opacity-60 mb-1">Takayama (Day 4-6)</div><div class="font-black text-sm text-[#726251]">東急ステイ飛騨高山 結の湯</div><div class="text-xs opacity-80 mt-1 selectable">岐阜県高山市花里町4-126</div></div>
            </div>
        </div>

    </main>

    <nav v-show="!isModalOpen" class="fixed bottom-0 w-full h-[85px] bg-[#70808f]/95 backdrop-blur-xl border-t border-[#c5b59d]/20 z-50 flex justify-around items-center px-2 pb-safe-bottom">
        <button v-for="tab in tabs" :key="tab.id" @click="currentView = tab.id" class="flex flex-col items-center justify-center w-12 h-full space-y-1 transition-all cursor-pointer active:scale-95" :class="currentView === tab.id ? 'text-[#c5b59d] scale-110' : 'text-white/40'"><i :class="tab.icon" class="text-xl"></i><span class="text-[9px] font-bold uppercase tracking-widest">{{ tab.label }}</span></button>
    </nav>

    <div v-if="showBudgetInput" class="modal-layer flex items-end justify-center"><div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="showBudgetInput=false"></div><div class="bg-[#c5b59d] w-full max-w-md h-[90vh] rounded-t-3xl animate-slide-up flex flex-col text-[#4a4238] modal-content" @click.stop><div class="p-6 font-bold text-lg border-b border-[#4a4238]/10">Add Expense</div><div class="flex-1 overflow-y-auto p-6 pb-40"><div class="flex gap-3 mb-6"><button v-for="p in payers" :key="p" @click="newItem.payer=p" class="flex-1 py-4 rounded-xl border font-bold text-sm transition-colors" :class="newItem.payer===p?(p==='TszLok'?'bg-[#91867f] text-white border-transparent':'bg-[#726251] text-white border-transparent'):'border-[#4a4238]/30 text-[#4a4238]/60'">{{ p }}</button></div><div class="space-y-6"><div><label class="block text-xs font-bold opacity-60 mb-2">Item Name</label><input v-model="newItem.name" class="w-full bg-white p-5 rounded-2xl font-bold border-2 border-transparent text-[#4a4238] placeholder-[#4a4238]/30 focus:border-[#726251] outline-none text-lg"></div><div><label class="block text-xs font-bold opacity-60 mb-2">Price (¥)</label><input v-model.number="newItem.price" type="number" class="w-full bg-white p-5 rounded-2xl font-bold border-2 border-transparent text-[#4a4238] placeholder-[#4a4238]/30 focus:border-[#726251] outline-none text-lg"><div v-if="newItem.price" class="text-right mt-2 font-mono font-bold text-[#4a4238]/60">≈ HKD ${{ (newItem.price * currencyRate).toFixed(1) }}</div></div></div><div class="flex gap-3 mt-10"><button @click="showBudgetInput=false" class="flex-1 py-4 font-bold text-[#4a4238]/50 bg-black/5 rounded-2xl">Cancel</button><button @click="addItem" class="flex-1 py-4 bg-[#70808f] text-white rounded-2xl font-bold shadow-lg text-lg">Save</button></div></div></div></div>
    
    <div v-if="showWishlistInput" class="modal-layer flex items-end justify-center">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="showWishlistInput=false"></div>
        <div class="bg-[#c5b59d] w-full max-w-md h-[90vh] rounded-t-3xl animate-slide-up flex flex-col text-[#4a4238] modal-content" @click.stop>
            <div class="p-6 font-bold text-lg border-b border-[#4a4238]/10">Add Wishlist</div>
            <div class="flex-1 overflow-y-auto p-6 pb-40">
                <div class="mb-6 relative w-full h-48 bg-white/30 border-2 border-dashed border-[#4a4238]/20 rounded-2xl flex flex-col items-center justify-center overflow-hidden">
                    <div v-if="newWishItem.image" class="w-full h-full relative">
                        <img :src="newWishItem.image" class="w-full h-full object-contain bg-black/10">
                        <button @click="newWishItem.image=null" class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center"><i class="fas fa-times"></i></button>
                    </div>
                    <label v-else class="w-full h-full flex flex-col items-center justify-center cursor-pointer hover:bg-white/50 transition-colors">
                        <i class="fas fa-camera text-3xl mb-2 opacity-50"></i>
                        <span class="text-xs font-bold opacity-50">Select Photo (Album)</span>
                        <input type="file" accept="image/*" @change="handleImageUpload" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                    </label>
                </div>
                <div class="space-y-6"><div><label class="block text-xs font-bold opacity-60 mb-2">Item Name</label><input v-model="newWishItem.name" class="w-full bg-white p-5 rounded-2xl font-bold border-2 border-transparent text-[#4a4238] outline-none focus:border-[#726251] text-lg"></div><div><label class="block text-xs font-bold opacity-60 mb-2">Price (¥)</label><input v-model.number="newWishItem.price" type="number" class="w-full bg-white p-5 rounded-2xl font-bold border-2 border-transparent text-[#4a4238] outline-none focus:border-[#726251] text-lg"><div v-if="newWishItem.price" class="text-right mt-2 font-mono font-bold text-[#4a4238]/60">≈ HKD ${{ (newWishItem.price * currencyRate).toFixed(1) }}</div></div></div>
                <div class="flex gap-3 mt-10"><button @click="showWishlistInput=false" class="flex-1 py-4 font-bold text-[#4a4238]/50 bg-black/5 rounded-2xl">Cancel</button><button @click="addWishlist" class="flex-1 py-4 bg-[#70808f] text-white rounded-2xl font-bold shadow-lg text-lg">Add</button></div>
            </div>
        </div>
    </div>

    <div v-if="detailModal.show" class="modal-layer flex items-end justify-center"><div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="detailModal.show=false"></div><div class="bg-[#c5b59d] w-full max-w-md rounded-t-3xl p-6 relative animate-slide-up max-h-[85vh] overflow-y-auto text-[#4a4238] modal-content" @click.stop><div class="w-12 h-1 bg-[#4a4238]/20 rounded-full mx-auto mb-6"></div>
    
    <div v-if="detailModal.data.isPhrase" class="text-center py-10"><div class="text-sm font-bold opacity-60 mb-4">{{ detailModal.data.zh }}</div><div class="text-4xl font-black mb-6">{{ detailModal.data.jp }}</div><div class="text-xs opacity-50 font-mono">{{ detailModal.data.pronounce }}</div></div>

    <div v-else-if="detailModal.data.isVoucher" class="space-y-4">
        <span class="px-3 py-1 bg-[#726251] text-white rounded-lg text-xs font-bold uppercase">HOTEL VOUCHER</span>
        <h2 class="text-2xl font-black mt-2 mb-2 font-mincho">{{ detailModal.data.title }}</h2>
        <div class="bg-white/50 p-5 rounded-xl border border-[#4a4238]/10 space-y-4">
            <div><div class="text-[10px] uppercase opacity-50 font-bold">Confirmation No.</div><div class="font-mono font-black text-xl tracking-wider">{{ detailModal.data.confirm }}</div></div>
            <div class="flex justify-between">
                <div><div class="text-[10px] uppercase opacity-50 font-bold">PIN Code</div><div class="font-mono font-bold">{{ detailModal.data.pin }}</div></div>
                <div class="text-right"><div><div class="text-[10px] uppercase opacity-50 font-bold">Order ID</div><div class="font-mono font-bold">{{ detailModal.data.order }}</div></div></div>
            </div>
            <div class="border-t border-[#4a4238]/10 pt-4">
                <div class="flex justify-between mb-2"><span class="text-xs font-bold opacity-60">Guest</span><span class="text-xs font-bold">{{ detailModal.data.guest }}</span></div>
                <div class="flex justify-between mb-2"><span class="text-xs font-bold opacity-60">Dates</span><span class="text-xs font-bold">{{ detailModal.data.dates }}</span></div>
                <div class="flex justify-between mb-2"><span class="text-xs font-bold opacity-60">Room</span><span class="text-xs font-bold">{{ detailModal.data.room }}</span></div>
                <div class="flex justify-between"><span class="text-xs font-bold opacity-60">Price</span><span class="text-xs font-bold">{{ detailModal.data.price }}</span></div>
            </div>
        </div>
        <div class="bg-red-500/10 p-4 rounded-xl text-xs font-bold text-red-800"><i class="fas fa-info-circle mr-2"></i>{{ detailModal.data.cancel }}</div>
        <div class="space-y-2">
            <h4 class="text-xs font-bold opacity-50 uppercase mt-4">Address</h4>
            <div class="font-bold text-sm">{{ detailModal.data.address }}</div>
            <div class="font-mono text-xs opacity-60">{{ detailModal.data.tel }}</div>
        </div>
        <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(detailModal.data.title + ' 日本')" target="_blank" class="block w-full mt-6 py-4 bg-[#70808f] text-white text-center rounded-2xl font-bold shadow-lg"><i class="fas fa-map-marker-alt mr-2"></i>Open Map</a>
    </div>

    <div v-else-if="detailModal.data.isTicket"><span class="px-3 py-1 rounded-lg text-xs font-bold uppercase" :class="getMethodBadge(detailModal.data.method)">{{ getMethodLabel(detailModal.data.method) }}</span><h2 class="text-2xl font-black mt-3 mb-2 font-mincho">{{ detailModal.data.title }}</h2><div class="bg-white/40 p-4 rounded-xl mb-4 shadow-sm"><div class="text-[10px] font-bold opacity-50 uppercase tracking-widest mb-1">地點 / 詳細資訊</div><div class="font-bold mb-1">{{ detailModal.data.location }}</div><div v-if="detailModal.data.desc" class="text-xs opacity-70 font-mono">{{ detailModal.data.desc }}</div><div class="mt-3 flex gap-2"><a v-if="detailModal.data.method === 'online' && detailModal.data.url" :href="detailModal.data.url" target="_blank" class="flex-1 py-3 bg-[#34a853] text-white text-center rounded-xl font-bold shadow-md active:scale-95 transition-transform text-sm"><i class="fas fa-external-link-alt mr-2"></i>預約網站</a><a v-if="detailModal.data.pdfLink" :href="detailModal.data.pdfLink" target="_blank" class="flex-1 py-3 bg-[#70808f] text-white text-center rounded-xl font-bold shadow-md active:scale-95 transition-transform text-sm"><i class="fas fa-file-pdf mr-2"></i>車票 PDF</a></div></div><div class="space-y-4"><div v-if="detailModal.data.guide.steps"><h4 class="text-xs font-bold opacity-60 uppercase tracking-widest mb-2">操作步驟</h4><ul class="list-decimal pl-5 space-y-2 text-sm font-bold opacity-90"><li v-for="step in detailModal.data.guide.steps">{{ step }}</li></ul></div><div v-if="detailModal.data.guide.reminder" class="bg-red-400/10 p-4 rounded-xl border-l-4 border-red-500 text-sm font-bold text-red-900"><i class="fas fa-exclamation-triangle mr-2"></i>{{ detailModal.data.guide.reminder }}</div></div>
    <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(detailModal.data.title + ' 日本')" target="_blank" class="block w-full mt-6 py-4 bg-white text-[#4a4238] rounded-2xl font-bold shadow-lg text-center"><i class="fas fa-map-marker-alt mr-2"></i>Open Map</a>
    </div>

    <div v-else><span class="px-3 py-1 bg-[#70808f] text-white rounded-lg text-xs font-bold uppercase">{{ detailModal.data.typeLabel }}</span><h2 class="text-2xl font-black mt-3 mb-2 font-mincho">{{ detailModal.data.name }}</h2><div class="text-sm font-bold opacity-60 mb-6 flex items-center"><i class="far fa-clock mr-2"></i> {{ detailModal.data.time }}</div><div class="space-y-6 text-sm leading-relaxed"><div v-if="detailModal.data.desc"><h4 class="text-xs font-bold opacity-50 uppercase tracking-widest mb-2">Description</h4><p class="font-bold whitespace-pre-line">{{ detailModal.data.desc }}</p></div><div v-if="detailModal.data.strategy" class="bg-[#726251]/10 p-5 rounded-2xl border-l-4 border-[#726251]"><h4 class="text-xs font-bold uppercase tracking-widest mb-3 flex items-center"><i class="fas fa-chess-knight mr-2"></i>攻略 Strategy</h4><div class="font-bold whitespace-pre-line">{{ detailModal.data.strategy }}</div></div></div><div class="mt-6 space-y-3"><a v-if="detailModal.data.ticketLink" :href="detailModal.data.ticketLink" target="_blank" class="block w-full py-4 bg-[#726251] text-white text-center rounded-2xl font-bold shadow-lg">View Ticket</a><a v-if="detailModal.data.hotelLink" :href="detailModal.data.hotelLink" target="_blank" class="block w-full py-4 bg-[#91867f] text-white text-center rounded-2xl font-bold shadow-lg">View Hotel Booking</a></div><div class="h-6"></div>
    <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(detailModal.data.name + ' 日本')" target="_blank" class="block w-full py-4 bg-white text-[#4a4238] rounded-2xl font-bold shadow-lg text-center"><i class="fas fa-map-marker-alt mr-2"></i>Open Map</a>
    </div></div></div>

</div>

<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
    import { getFirestore, doc, onSnapshot, setDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    const firebaseConfig = {
        apiKey: "AIzaSyCDOiAGPDY7Jd7ysg1fapFnCdidwGE66q8",
        authDomain: "nagoya-2026-361a0.firebaseapp.com",
        projectId: "nagoya-2026-361a0",
        storageBucket: "nagoya-2026-361a0.firebasestorage.app",
        messagingSenderId: "156812601167",
        appId: "1:156812601167:web:852ed3f4f431f7506cc73a",
        measurementId: "G-Z0NV8048TJ"
    };

    window.onerror = function(msg, url, line) {
        console.warn("Global Error Suppressed:", msg);
        return false;
    };

    let db;
    try {
        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
    } catch (e) { console.warn("Firebase Init Error", e); }

    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            const currentView = ref('itinerary'); 
            const dayIndex = ref(0);
            const detailModal = ref({ show: false, data: {} });
            const walletMode = ref('expense');
            const budgetFilter = ref('All'); 
            const showBudgetInput = ref(false);
            const showWishlistInput = ref(false);
            const payers = ['TszLok', 'TszTung'];
            const newItem = ref({ name: '', price: '', payer: 'TszLok' });
            const newWishItem = ref({ name: '', price: '', image: null });
            const budgetList = ref([]);
            const wishlist = ref([]);
            
            const packingTab = ref('TszLok');
            const packingList = ref({
                tszLok: {
                    handCarry: [
                        {name: '個人證件 (身分證/護照/簽證)', checked: false}, 
                        {name: '登機證', checked: false}, 
                        {name: '銀包 (日圓/信用卡)', checked: false}, 
                        {name: 'SIM卡 / Wifi蛋', checked: false}, 
                        {name: '手機 & 充電線', checked: false}, 
                        {name: '行動電源 (尿袋)', checked: false}, 
                        {name: '口罩/消毒液', checked: false}
                    ],
                    luggage: [
                        {name: '外出衣物 (4-5套)', checked: false}, 
                        {name: '睡衣褲', checked: false}, 
                        {name: '內衣褲 & 襪', checked: false}, 
                        {name: '厚外套/羽絨', checked: false}, 
                        {name: '男士剃鬚刀', checked: false}, 
                        {name: '轉插 (兩腳扁插) & 拖板', checked: false}, 
                        {name: '雨傘/雨衣', checked: false}, 
                        {name: '拖鞋', checked: false}, 
                        {name: '備用膠袋 (裝污衣)', checked: false}
                    ]
                },
                tszTung: {
                    handCarry: [
                        {name: '個人證件 (身分證/護照/簽證)', checked: false}, 
                        {name: '登機證', checked: false}, 
                        {name: '銀包 (日圓/信用卡)', checked: false}, 
                        {name: 'SIM卡', checked: false}, 
                        {name: '手機 & 充電線', checked: false}, 
                        {name: '行動電源 (尿袋)', checked: false}, 
                        {name: '化妝包 (液體<100ml)', checked: false}
                    ],
                    luggage: [
                        {name: '外出衣物 (4-5套)', checked: false}, 
                        {name: '睡衣褲', checked: false}, 
                        {name: '內衣褲 & 襪', checked: false}, 
                        {name: '厚外套/羽絨', checked: false}, 
                        {name: '化妝品 & 卸妝', checked: false}, 
                        {name: '護膚品 (保濕)', checked: false}, 
                        {name: '洗面/洗髮/護髮', checked: false}, 
                        {name: '頭髮定型/電髮棒', checked: false}, 
                        {name: '梳 & 風筒', checked: false}, 
                        {name: '隱形眼鏡 & 藥水', checked: false}, 
                        {name: '女性護理用品', checked: false}, 
                        {name: '毛巾', checked: false}, 
                        {name: '公仔', checked: false}, 
                        {name: '熱水煲 (視需要)', checked: false}
                    ]
                }
            });

            const phrases = [
                { zh: '不好意思', jp_short: 'すみません', jp: 'すみません', pronounce: 'Sumimasen' },
                { zh: '謝謝', jp_short: 'ありがとう', jp: 'ありがとうございます', pronounce: 'Arigatou Gozaimasu' },
                { zh: '這個', jp_short: 'これ', jp: 'これをください', pronounce: 'Kore o kudasai' },
                { zh: '洗手間', jp_short: 'トイレ', jp: 'トイレはどこですか？', pronounce: 'Toire wa doko desu ka?' },
                { zh: '結帳', jp_short: 'お会計', jp: 'お会計をお願いします', pronounce: 'Okaikei o onegaishimasu' },
                { zh: '不要蔥', jp_short: 'ネギ抜き', jp: 'ネギを抜いてください', pronounce: 'Negi o nuite kudasai' },
                { zh: '有推薦嗎', jp_short: 'おすすめ', jp: 'おすすめは何ですか？', pronounce: 'Osusume wa nan desu ka?' },
                { zh: '請帶我去', jp_short: 'ここへ', jp: 'ここへ行ってください', pronounce: 'Koko e itte kudasai' }
            ];

            const currencyRate = ref(0.052);
            const calcExpression = ref('');
            const calcResult = ref('0');
            const syncStatus = ref('Connecting...');
            const syncColor = ref('bg-yellow-400');
            const tripDocId = "nagoya_v65_0"; 

            const fetchRate = async () => {
                try {
                    const res = await fetch('https://api.frankfurter.dev/v1/latest?from=JPY&to=HKD');
                    const data = await res.json();
                    if(data && data.rates && data.rates.HKD) {
                        currencyRate.value = data.rates.HKD;
                    }
                } catch(e) { console.log("Using default rate"); }
            };
            onMounted(() => { fetchRate(); });

            const getTypeColor = (t) => ({food:'border-[#726251] bg-[#c5b59d]', transport:'border-[#70808f] bg-[#c5b59d]', stay:'border-[#91867f] bg-[#c5b59d]', spot:'border-[#4a4238] bg-[#c5b59d]'}[t]||'border-gray-400');
            const getMethodClass = (m) => ({ 'method-online': m==='online', 'method-onsite': m==='onsite', 'method-mobile': m==='mobile' }[m]);
            const getMethodBadge = (m) => ({ 'bg-[#e6f4ea] text-[#1e4620]': m==='online', 'bg-[#fef7e0] text-[#5f370e]': m==='onsite', 'bg-[#f1f3f4] text-[#3c4043]': m==='mobile' }[m]);
            const getMethodLabel = (m) => ({ online:'線上預約', onsite:'現場購買', mobile:'數位支付' }[m]);

            onSnapshot(doc(db, "trips", tripDocId), (doc) => {
                syncStatus.value = "Live"; syncColor.value = "bg-green-400";
                if (doc.exists()) {
                    const data = doc.data();
                    if(data.budgetList) budgetList.value = data.budgetList;
                    if(data.wishlist) wishlist.value = data.wishlist;
                    if(data.packingList) packingList.value = data.packingList;
                }
            }, (error) => { console.error(error); syncStatus.value = "Offline"; syncColor.value = "bg-red-500"; });

            const saveData = async () => {
                syncStatus.value = "Saving..."; syncColor.value = "bg-blue-400 animate-pulse";
                try {
                    await setDoc(doc(db, "trips", tripDocId), { budgetList: budgetList.value, wishlist: wishlist.value, packingList: packingList.value }, { merge: true });
                    setTimeout(() => { syncStatus.value = "Live"; syncColor.value = "bg-green-400"; }, 500);
                } catch (e) { syncStatus.value = "Error"; syncColor.value = "bg-red-500"; }
            };
            watch(budgetList, saveData, { deep: true });
            watch(wishlist, saveData, { deep: true });
            const syncPacking = () => saveData();

            const handleImageUpload = (event) => {
                const file = event.target.files[0];
                if(!file) return;
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX = 500; 
                        const scale = MAX / img.width;
                        if (scale < 1) { canvas.width = MAX; canvas.height = img.height * scale; } else { canvas.width = img.width; canvas.height = img.height; }
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        newWishItem.value.image = canvas.toDataURL('image/jpeg', 0.5);
                    }
                }
            };

            const addItem = () => { if(newItem.value.name&&newItem.value.price){ budgetList.value.unshift({...newItem.value}); showBudgetInput.value=false; newItem.value={name:'',price:'',payer:'TszLok'}; }};
            const addWishlist = () => { if(newWishItem.value.name){ wishlist.value.unshift({...newWishItem.value}); newWishItem.value={name:'',price:'',image:null}; showWishlistInput.value=false; }};
            const deleteBudget = (item) => { const idx = budgetList.value.indexOf(item); if(idx>-1) budgetList.value.splice(idx,1); };
            const deleteWishlist = (idx) => wishlist.value.splice(idx, 1);
            const openDetail = (p) => { detailModal.value = { show:true, data:p }; };
            const openTicketDetail = (t) => { detailModal.value = { show:true, data: { ...t, isTicket: true } }; };
            const getTicketsByMethod = (m) => ticketList.value.filter(t => t.method === m);
            
            const isModalOpen = computed(() => showBudgetInput.value || showWishlistInput.value || detailModal.value.show);
            const now = ref(new Date());
            
            const countdown = computed(() => { 
                const target = new Date(2026, 1, 25, 9, 0, 0);
                const diff = target - now.value;
                if (diff <= 0) return { days: 0, hours: '00', minutes: '00', seconds: '00' };
                return { 
                    days: Math.floor(diff / (1000 * 60 * 60 * 24)), 
                    hours: Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2, '0'), 
                    minutes: Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0'),
                    seconds: Math.floor((diff % (1000 * 60)) / 1000).toString().padStart(2, '0')
                }; 
            });
            const tripProgress = computed(() => Math.min(100, Math.max(0, ((now.value - new Date(2026,1,3,9,0)) / (new Date(2026,1,25,9,0) - new Date(2026,1,3,9,0))) * 100)));
            const nowFormatted = computed(() => now.value.toLocaleDateString('en-GB', { month: 'numeric', day: 'numeric' }));
            setInterval(() => now.value = new Date(), 1000);

            const appendCalc = (c) => calcExpression.value += c;
            const clearCalc = () => { calcExpression.value=''; calcResult.value='0'; };
            const backspace = () => calcExpression.value = calcExpression.value.slice(0,-1);
            const calculate = () => { try { calcResult.value = new Function('return '+calcExpression.value)().toString(); } catch(e) { calcResult.value='Error'; } };
            const displayValue = computed(() => calcExpression.value || calcResult.value);
            
            const filteredBudgetList = computed(() => budgetFilter.value === 'All' ? budgetList.value : budgetList.value.filter(i => i.payer === budgetFilter.value));
            const filteredTotal = computed(() => filteredBudgetList.value.reduce((s,i)=>s+i.price,0));
            const totalSpent = computed(() => budgetList.value.reduce((s,i)=>s+i.price,0));
            const spentTszLok = computed(() => budgetList.value.filter(i=>i.payer==='TszLok').reduce((s,i)=>s+i.price,0));
            const spentTszTung = computed(() => budgetList.value.filter(i=>i.payer==='TszTung').reduce((s,i)=>s+i.price,0));

            const weatherDB = [
                { date: "2/25", hourly: [{time:"14:00",temp:"8°",icon:"fas fa-cloud-sun"},{time:"16:00",temp:"7°",icon:"fas fa-cloud"},{time:"18:00",temp:"6°",icon:"fas fa-moon"},{time:"20:00",temp:"5°",icon:"fas fa-moon"}] },
                { date: "2/26", hourly: [{time:"09:00",temp:"7°",icon:"fas fa-sun"},{time:"12:00",temp:"11°",icon:"fas fa-sun"},{time:"15:00",temp:"10°",icon:"fas fa-cloud-sun"},{time:"18:00",temp:"7°",icon:"fas fa-moon"}] },
                { date: "2/27", hourly: [{time:"10:00",temp:"9°",icon:"fas fa-cloud"},{time:"13:00",temp:"12°",icon:"fas fa-cloud-sun"},{time:"16:00",temp:"10°",icon:"fas fa-cloud"},{time:"19:00",temp:"8°",icon:"fas fa-cloud-rain"}] },
                { date: "2/28", hourly: [{time:"09:00",temp:"2°",icon:"fas fa-snowflake"},{time:"12:00",temp:"3°",icon:"fas fa-snowflake"},{time:"15:00",temp:"1°",icon:"fas fa-snowflake"},{time:"18:00",temp:"-1°",icon:"fas fa-snowflake"}] },
                { date: "3/1", hourly: [{time:"09:00",temp:"-2°",icon:"fas fa-snowflake"},{time:"12:00",temp:"0°",icon:"fas fa-snowflake"},{time:"15:00",temp:"-1°",icon:"fas fa-cloud-meatball"},{time:"18:00",temp:"-4°",icon:"fas fa-snowflake"}] },
                { date: "3/2", hourly: [{time:"09:00",temp:"-5°",icon:"fas fa-snowflake"},{time:"12:00",temp:"-2°",icon:"fas fa-sun"},{time:"15:00",temp:"-3°",icon:"fas fa-cloud-sun"},{time:"18:00",temp:"-6°",icon:"fas fa-moon"}] },
                { date: "3/3", hourly: [{time:"08:00",temp:"4°",icon:"fas fa-cloud-sun"},{time:"12:00",temp:"9°",icon:"fas fa-sun"},{time:"16:00",temp:"8°",icon:"fas fa-cloud-sun"},{time:"20:00",temp:"6°",icon:"fas fa-moon"}] }
            ];
            const currentDayWeather = computed(() => weatherDB[dayIndex.value]?.hourly || []);
            const keyLabels = { handCarry: 'Hand Carry', tszLok: 'TszLok (Boy)', tszTung: 'TszTung (Girl)' };

            const ticketList = ref([
                { 
                    date: "2/25 & 3/3", day: "Day 1, 7", title: "名鐵 μ-Sky (往返機場)", route: "機場 ↔ 名古屋", price: "¥1,430", method: "onsite", location: "機場/名鐵車站", 
                    guide: { 
                        steps: ["抵達名鐵機場站：走出機場入境大廳後，跟著「Train / Meitetsu Line」標示走。", "找到藍色或紅色售票機：選擇「μ-ticket」或「Limited Express」選項。", "劃位付款：前往「Nagoya」，選擇2人，選位 (可選連號)。", "可用現金、信用卡或 IC 卡。"], 
                        reminder: "一定要拿兩張票（乘車券+座位券）才能進站！" 
                    } 
                },
                { 
                    date: "2/26", day: "Day 2", title: "吉卜力大倉庫 (入場券)", route: "入場預約", price: "已預約", method: "online", location: "愛・地球博紀念公園", 
                    url: "https://quickticket.moala.fun/books?id=d1315e41-24de-40a9-a20a-0cf36d07ec8f",
                    guide: { steps: ["開啟預約 Email 確認信。", "點擊連結顯示入場 QR Code。", "依預約時間 12:00 排隊掃描入場。"], reminder: "請務必攜帶護照查驗身分！遲到無效。" } 
                },
                { date: "2/26", day: "Day 2", title: "吉卜力交通 (Linimo)", route: "市區 ↔ 吉卜力", price: "約 ¥1,340", method: "mobile", location: "Apple Wallet", guide: { steps: ["用 iPhone 交通卡。", "Apple Pay 加值 ¥3000。", "直接感應閘門。"], reminder: "確認手機有電！" } },
                { date: "2/27", day: "Day 3", title: "地鐵 24 小時券", route: "市區觀光", price: "¥760", method: "onsite", location: "地鐵售票機", guide: { steps: ["找黃色售票機。", "選 'Value Tickets'。", "平日¥760 / 週末¥620。"], reminder: "第一次進站啟用。" } },
                { 
                    date: "2/28", day: "Day 4", title: "濃飛巴士 (去程)", route: "名古屋 → 高山", price: "¥6,000 (來回)", method: "online", location: "名鐵巴士中心", 
                    desc: "發車: 09:30 | 出示 Web Ticket", 
                    pdfLink: "ticket_228.pdf", 
                    guide: { steps: ["前往名鐵巴士中心(名古屋站) 3F。", "出示 Web Ticket 手機畫面。", "尋找往高山/白川鄉月台。"], reminder: "請提早 15 分鐘抵達。" } 
                },
                { 
                    date: "3/1", day: "Day 5", title: "濃飛巴士 (白川鄉去程)", route: "高山 → 白川鄉", price: "¥2,800 (單程)", method: "online", location: "高山濃飛巴士中心", 
                    desc: "去程: 08:10 | 座位: 8A/8B",
                    pdfLink: "ticket_301.pdf", 
                    guide: { steps: ["前往高山站旁的巴士中心 4 號月台。", "出示 Email 電子票。", "座位 8A / 8B。"], reminder: "預約編號: 02062000931。請務必準時。" } 
                },
                { 
                    date: "3/1", day: "Day 5", title: "濃飛巴士 (白川鄉回程)", route: "白川鄉 → 高山", price: "¥5,600 (2人)", method: "online", location: "白川鄉巴士總站", 
                    desc: "發車: 15:45 | 座位: 1C/1D",
                    pdfLink: "ticket301_back.pdf", 
                    guide: { steps: ["前往白川鄉巴士總站。", "出示電子車票 (手機 PDF)。", "尋找車號 01，座位 1C/1D。"], reminder: "預約編號: 02072000521。發車前請提早抵達。" } 
                },
                { date: "3/2", day: "Day 6", title: "奧飛驒 2 日套票", route: "巴士+纜車", price: "¥6,300", method: "onsite", location: "高山濃飛巴士中心", guide: { steps: ["去 JR 旁巴士中心。", "買 'Okuhida Value Ticket'。", "付現金。"], reminder: "弄丟不補發！包含新穗高纜車來回。" } },
                { 
                    date: "3/3", day: "Day 7", title: "濃飛巴士 (回程)", route: "高山 → 名古屋", price: "使用來回票", method: "online", location: "高山濃飛巴士中心", 
                    desc: "發車: 13:20",
                    pdfLink: "ticket_303.pdf", 
                    guide: { steps: ["前往高山濃飛巴士中心。", "出示來回票回程憑證。", "上車睡覺。"], reminder: "下車地點: 名鐵巴士中心。" } 
                }
            ]);

            const itinerary = ref([
                { day: 1, date_short: "2/25", date_en: "Wed", location: "Nagoya", places: [
                    { time: "14:30", name: "中部國際機場", type: "transport", typeLabel: "抵達", desc: "入境、領行李 (預計 1 小時)。", highlights: ["入境"], strategy: "出關後跟著「名鐵電車」藍色指標走，前往機場站。" }, 
                    { time: "15:30", name: "名鐵 μ-Sky", type: "transport", typeLabel: "移動", desc: "前往名古屋站。", highlights: ["指定席"], strategy: "購票：自動售票機選「μ-ticket」，目的地「Nagoya」。\n劃位：機器上選 2 位成人及連號座位。\n費用：¥1,430。" }, 
                    { time: "16:15", name: "Taito Station", type: "spot", typeLabel: "娛樂", desc: "名站周邊夾娃娃。", highlights: ["夾娃娃"], strategy: "抵達名古屋站後、Check-in 前的空檔，快速體驗日本夾娃娃機。" }, 
                    { time: "17:00", name: "西鐵酒店 Croom", type: "stay", typeLabel: "Check-in", desc: "久屋大通站 4 號出口。", bookingType: "hotel", highlights: ["大浴場"], strategy: "訂單編號: 1359041951884860 | PIN: 9525\n位置：久屋大通站 4 號出口步行 1 分鐘。" }, 
                    { time: "18:00", name: "Indo Ryori Kalash", type: "food", typeLabel: "晚餐", desc: "地鐵鶴舞線「杁中站」。", highlights: ["印度咖哩"], strategy: "這是您指定的特色餐廳。\n搭乘地鐵鶴舞線至杁中站。" }, 
                    { time: "20:00", name: "Oasis 21", type: "spot", typeLabel: "夜景", desc: "水的宇宙船。", highlights: ["電視塔"], strategy: "在酒店附近，建議上頂層拍攝名古屋電視塔夜景。" }
                ]},
                { day: 2, date_short: "2/26", date_en: "Thu", location: "Nagoya", places: [
                    { time: "09:00", name: "Konparu 榮店", type: "food", typeLabel: "早餐", desc: "名古屋炸蝦三明治。", highlights: ["炸蝦三明治"], strategy: "必吃名古屋招牌炸蝦三明治，可內用或外帶。" }, 
                    { time: "11:00", name: "吉卜力公園", type: "spot", typeLabel: "拍照", desc: "愛・地球博紀念公園。", highlights: ["青春之丘"], strategy: "交通：搭乘地鐵轉 Linimo 線。\n先在外部園區拍照。" }, 
                    { time: "12:00", name: "吉卜力大倉庫", type: "spot", typeLabel: "重點", desc: "需依預約時間入場。", bookingType: "ticket", highlights: ["名場面展"], strategy: "內部展覽豐富，建議預留 3-4 小時。\n不要遲到！" }, 
                    { time: "18:00", name: "榮區購物", type: "spot", typeLabel: "購物", desc: "Tsubame Bread。", highlights: ["紅豆吐司"], strategy: "採購著名的紅豆吐司。\n逛逛榮區商圈。" }, 
                    { time: "18:30", name: "Workman Joshi", type: "spot", typeLabel: "購物", desc: "SKYLE 旗艦店。", highlights: ["機能服飾"], strategy: "距離等下要去的松坂屋和 HARBS 僅 5-8 分鐘路程。主打平價好看的防寒、防雨機能服飾。" }, 
                    { time: "19:00", name: "蓬萊軒 松坂屋", type: "food", typeLabel: "晚餐", desc: "鰻魚飯三吃。", highlights: ["鰻魚飯"], strategy: "人氣極高，建議抵達榮區時提前去櫃檯抽號碼牌。\n\n[☔ 備案]\nA. しら河 (Shirakawa): 榮 Gas Building B1 (價格親民)。\nB. 名古屋備長 (Bincho): LACHIC 7F (可吹冷氣)。\nC. 花岡 (Hanaoka): 三之丸附近 (獨特吃法)。" }, 
                    { time: "20:30", name: "HARBS 本店", type: "food", typeLabel: "甜點", desc: "水果千層蛋糕。", highlights: ["外帶"], strategy: "外帶招牌水果千層蛋糕回酒店享用。" }
                ]},
                { day: 3, date_short: "2/27", date_en: "Fri", location: "Nagoya", places: [
                    { time: "09:00", name: "Komeda's Coffee", type: "food", typeLabel: "早餐", desc: "點咖啡送吐司。", highlights: ["紅豆泥"], strategy: "名古屋特色早餐文化，點飲料送厚片吐司。" }, 
                    { time: "10:30", name: "名古屋港水族館", type: "spot", typeLabel: "景點", desc: "虎鯨與海豚表演。", highlights: ["虎鯨"], strategy: "重點觀看虎鯨與海豚表演（預定 2.5 小時）。" }, 
                    { time: "13:30", name: "矢場炸豬排", type: "food", typeLabel: "午餐", desc: "味噌豬排。", highlights: ["鐵板"], strategy: "品嚐道地的名古屋味噌豬排。" }, 
                    { time: "15:00", name: "大須商店街", type: "spot", typeLabel: "逛街", desc: "三輪神社與扭蛋。", highlights: ["兔子神社", "#C-pla"], strategy: "參拜兔子神社。大須商店街內新增目標「#C-pla」，這是名古屋扭蛋機最集中的地方，比車站的小機器更好逛！" }, 
                    { time: "17:00", name: "Piyorin 蛋糕", type: "food", typeLabel: "搶購", desc: "Café Gentiane。", highlights: ["挑戰"], strategy: "⚠️ 17:00 最後出爐時間！\n必須準時在名古屋站排隊。\n\n[☔ 備案]\n地雷也炸蝦飯糰 (Tenmusu)，名鐵百貨 B1 購買外帶。" }, 
                    { time: "17:40", name: "MUJI 名鐵百貨", type: "spot", typeLabel: "購物", desc: "生活雜貨。", highlights: ["旗艦店"], strategy: "預留 1 小時補貨，確保不影響晚餐與後續行程。" }, 
                    { time: "19:30", name: "名古屋站周邊", type: "food", typeLabel: "晚餐", desc: "寬麵或雞翅。", highlights: ["手羽先"], strategy: "推薦驛釜寬麵或世界之山將雞翅。" }
                ]},
                { day: 4, date_short: "2/28", date_en: "Sat", location: "Takayama", places: [
                    { time: "09:30", name: "濃飛巴士", type: "transport", typeLabel: "移動", desc: "前往高山。", highlights: ["Web Ticket"], strategy: "名鐵巴士中心 3F 搭乘。\n上車出示 Web Ticket 手機畫面即可。\n費用：來回票每人 ¥6,000。" }, 
                    { time: "12:30", name: "東急 Stay 飛驒高山", type: "stay", typeLabel: "寄放", desc: "步行 2 分鐘即達。", bookingType: "hotel", highlights: ["近車站"], strategy: "訂單編號: 6185199858 | PIN: 8900\n先寄放行李。" }, 
                    { time: "13:00", name: "高山老街", type: "spot", typeLabel: "散策", desc: "三町通。", highlights: ["飛驒牛壽司"], strategy: "漫步高山老街，品嚐路邊攤飛驒牛美食。" }, 
                    { time: "15:00", name: "Check-in", type: "stay", typeLabel: "入住", desc: "東急 Stay 飛驒高山。", highlights: ["休息"], strategy: "辦理入住手續，稍作休息。" }, 
                    { time: "18:00", name: "味藏天國", type: "food", typeLabel: "晚餐", desc: "飛驒牛燒肉。", highlights: ["A5飛驒牛"], strategy: "⚠️ 不能預約！請在 17:00 左右先去門口登記名字抽籤。\n\n[☔ 備案]\nA. 丸明 (Maruaki): 就在附近的另一名店。\nB. 老街飛驒牛握壽司 (輕食)。" }
                ]},
                { day: 5, date_short: "3/1", date_en: "Sun", location: "Shirakawa", places: [
                    { time: "08:10", name: "濃飛巴士", type: "transport", typeLabel: "移動", desc: "前往白川鄉。", highlights: ["8A/8B"], strategy: "預約編號：02062000931，座位 8A/8B。\n高山巴士總站 4 號月台候車，出示 Email 電子票上車。" }, 
                    { time: "09:30", name: "城山天守閣", type: "spot", typeLabel: "展望台", desc: "俯瞰合掌村。", highlights: ["經典角度"], strategy: "趁早先搭接駁車上去拍照，避開中午人潮。" }, 
                    { time: "12:30", name: "Irori", type: "food", typeLabel: "午餐", desc: "朴葉味噌燒。", highlights: ["傳統料理"], strategy: "品嚐傳統朴葉味噌燒。" }, 
                    { time: "13:30", name: "三小屋", type: "spot", typeLabel: "景點", desc: "村子後方。", highlights: ["田園風光"], strategy: "散步到村子後方，拍攝最著名的三小屋風景。" }, 
                    { time: "14:15", name: "喫茶落人", type: "food", typeLabel: "甜點", desc: "紅豆湯無限喝。", highlights: ["圍爐裏"], strategy: "喝咖啡，享用圍爐裏烤紅豆湯。" }, 
                    { time: "15:45", name: "濃飛巴士", type: "transport", typeLabel: "移動", desc: "返回高山。", highlights: ["回程"], strategy: "時間：16:35 抵達高山。" },
                    { time: "18:00", name: "麵屋しらかわ", type: "food", typeLabel: "晚餐", desc: "高山拉麵名店。", highlights: ["排隊店"], strategy: "高山拉麵代表名店，湯頭濃郁。\n\n[☔ 備案]\nLE MIDI (就在附近)，品嚐布丁或法式餐點。" }
                ]},
                { day: 6, date_short: "3/2", date_en: "Mon", location: "Okuhida", places: [
                    { time: "09:40", name: "濃飛巴士", type: "transport", typeLabel: "移動", desc: "前往新穗高。", highlights: ["套票"], strategy: "在高山巴士站購買「奧飛驒 2 日套票」(¥6,300)。" }, 
                    { time: "12:00", name: "新穗高山頂", type: "spot", typeLabel: "展望台", desc: "標高 2156m。", highlights: ["雪之迴廊"], strategy: "欣賞全景及雪之迴廊。" }, 
                    { time: "14:20", name: "平湯大瀑布", type: "spot", typeLabel: "步行攻略", desc: "雪地健行。", highlights: ["藍色冰瀑", "⚠️防滑鞋"], strategy: "路線：從平湯巴士總站出發，往瀑布方向走。\n地形：雪地微上坡，單程約 25 分鐘。\n⚠️ 裝備建議：務必穿著「防滑鞋」(雪靴或加裝冰爪)，因為雪地結冰非常滑！\n景點：高達 64 米的瀑布會結冰成漂亮的藍色，是冬季限定美景。" }, 
                    { time: "15:40", name: "平湯巴士站", type: "food", typeLabel: "休息", desc: "足湯與牛奶。", highlights: ["溫泉蛋"], strategy: "吃溫泉蛋、喝飛驒牛奶、享受免費足湯。" }, 
                    { time: "18:30", name: "丸明", type: "food", typeLabel: "晚餐", desc: "飛驒牛壽喜燒。", highlights: ["壽喜燒"], strategy: "高山著名飛驒牛餐廳。" }
                ]},
                { day: 7, date_short: "3/3", date_en: "Tue", location: "Airport", places: [
                    { time: "09:00", name: "宮川朝市", type: "spot", typeLabel: "市集", desc: "河邊早市。", highlights: ["伴手禮"], strategy: "最後採買當地農產品及工藝品。" }, 
                    { time: "12:00", name: "LE MIDI", type: "food", typeLabel: "午餐", desc: "南瓜布丁。", highlights: ["甜點"], strategy: "享用高山美食。" }, 
                    { time: "13:20", name: "濃飛巴士", type: "transport", typeLabel: "移動", desc: "前往名古屋。", highlights: ["回程"], strategy: "使用來回票回程。抵達名鐵巴士中心。" }, 
                    { time: "17:20", name: "名鐵 μ-Sky", type: "transport", typeLabel: "移動", desc: "前往機場。", highlights: ["NGO"], strategy: "在名鐵名古屋站售票機劃位付款 (¥1,430)。" }, 
                    { time: "21:00", name: "起飛返港", type: "transport", typeLabel: "離境", desc: "UO685。", bookingType: "flight", terminal: "T2", highlights: [], strategy: "滿載而歸！" }
                ]}
            ]);

            const tabs = [ { id: 'itinerary', label: 'Plan', icon: 'fas fa-map-marked-alt' }, { id: 'wallet', label: 'Wallet', icon: 'fas fa-wallet' }, { id: 'packing', label: 'Pack', icon: 'fas fa-suitcase' }, { id: 'reservations', label: 'Resv', icon: 'fas fa-ticket-alt' }, { id: 'reminders', label: 'Tips', icon: 'fas fa-lightbulb' }, { id: 'tools', label: 'Tools', icon: 'fas fa-toolbox' } ];

            return { currentView, dayIndex, itinerary, budgetList, packingList, packingTab, newItem, showBudgetInput, detailModal, countdown, openDetail, openTicketDetail, addItem, deleteBudget, payers, tabs, keyLabels, walletMode, showWishlistInput, newWishItem, wishlist, handleImageUpload, addWishlist, deleteWishlist, currentDayWeather, budgetFilter, filteredBudgetList, filteredTotal, totalSpent, spentTszLok, spentTszTung, getTypeColor, tripProgress, nowFormatted, isModalOpen, phrases, 
                // Calc exports
                currencyRate, calcExpression, appendCalc, clearCalc, backspace, calculate, displayValue,
                // Resv & Utils
                ticketList, getMethodClass, getMethodBadge, getMethodLabel, getTicketsByMethod,
                // Cloud Status
                syncStatus, syncColor, saveData, syncPacking
            };
        }
    }).mount('#app');
</script>
</body>
</html>
