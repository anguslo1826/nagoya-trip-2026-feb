<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>JP.TRIP 2026 v18</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="icon.jpg">
    <link rel="icon" type="image/jpeg" href="icon.jpg">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&family=Shippori+Mincho:wght@600;800&display=swap" rel="stylesheet">
    
    <style>
        /* THEME VARIABLES */
        :root {
            --navy-bg: #0f172a; 
            --text-light: #f8fafc;
        }

        body { 
            font-family: 'Zen Maru Gothic', sans-serif; 
            background-color: var(--navy-bg); 
            color: var(--text-light);
            overflow: hidden; 
            height: 100vh; width: 100vw;
        }
        
        .font-mincho { font-family: 'Shippori Mincho', serif; }
        
        /* SNOW EFFECT */
        .snow-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; overflow: hidden; }
        .snowflake { position: absolute; top: -10px; color: white; opacity: 0.4; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(110vh); } }

        /* UTILS */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .safe-top { padding-top: env(safe-area-inset-top); }
        
        /* GLASS CARD */
        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }

        /* CHECKBOX */
        .check-box input:checked + div { background-color: #10b981; border-color: #10b981; }
        
        /* IMAGE UPLOAD PREVIEW */
        .img-preview { width: 100%; height: 150px; object-fit: cover; border-radius: 12px; }
    </style>
</head>
<body>

<div id="app" class="flex flex-col h-full w-full max-w-md mx-auto relative bg-[#0f172a]">
    
    <div class="snow-container" id="snow-container"></div>

    <main class="flex-1 overflow-y-auto no-scrollbar relative z-10 pb-32 pt-safe-top px-5" ref="mainScroll">
        
        <div v-if="currentView === 'dashboard'" class="space-y-6 animate-fade-in pt-4">
            
            <div class="flex justify-between items-center">
                <div>
                    <div class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">JP.TRIP 2026</div>
                    <h1 class="text-3xl font-black font-mincho text-white">ÂêçÂè§Â±ã„ÉªÈ´òÂ±±</h1>
                </div>
                <div class="w-10 h-10 rounded-full border-2 border-white/20 overflow-hidden shadow-lg">
                    <img src="icon.jpg" class="w-full h-full object-cover">
                </div>
            </div>

            <div class="relative w-full aspect-[16/10] rounded-[32px] overflow-hidden shadow-2xl group">
                <img src="icon.jpg" class="absolute inset-0 w-full h-full object-cover opacity-60 transition-transform duration-700 group-hover:scale-105">
                <div class="absolute inset-0 bg-gradient-to-t from-[#0f172a] via-transparent to-transparent"></div>
                
                <div class="absolute bottom-5 left-5 right-5">
                    <div class="text-[10px] font-bold text-emerald-400 uppercase tracking-widest mb-1">Coming Soon</div>
                    <div class="flex items-baseline gap-2 mb-3">
                        <span class="text-5xl font-black font-mincho">{{ countdown.days }}</span>
                        <span class="text-sm font-bold">Days</span>
                        <span class="text-2xl font-mono text-white/80">{{ countdown.hours }}:{{ countdown.minutes }}</span>
                    </div>
                    <div class="w-full">
                        <div class="flex justify-between text-[9px] font-bold text-white/50 mb-1"><span>Now</span><span>2026.02.25</span></div>
                        <div class="h-1.5 bg-white/20 rounded-full overflow-hidden">
                            <div class="h-full bg-emerald-400 rounded-full transition-all duration-1000" :style="{ width: tripProgress + '%' }"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass p-5">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="font-bold text-sm text-white flex items-center"><i class="fas fa-calendar-alt mr-2 text-white/50"></i> ÊóÖÁ®ãÂ§©Ê∞£È†êÂ†±</h3>
                    <span class="text-[9px] bg-white/10 px-2 py-1 rounded text-white/60">2026 Feb</span>
                </div>
                <div class="flex gap-4 overflow-x-auto no-scrollbar pb-1">
                    <div v-for="(w, i) in forecast2026" :key="i" class="flex flex-col items-center min-w-[3.5rem] bg-white/5 p-2 rounded-xl border border-white/5">
                        <span class="text-[9px] font-bold text-white/50 mb-1">{{ w.date }}</span>
                        <i :class="w.icon" class="text-xl mb-1 text-white"></i>
                        <span class="text-sm font-black">{{ w.temp }}</span>
                        <span class="text-[8px] font-bold text-white/40 mt-1">{{ w.loc }}</span>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button @click="currentView='wallet'" class="glass p-4 flex flex-col items-center justify-center aspect-[4/3] hover:bg-white/5 transition-colors">
                    <div class="w-10 h-10 rounded-full bg-orange-500/20 text-orange-400 flex items-center justify-center text-lg mb-2"><i class="fas fa-wallet"></i></div>
                    <span class="font-bold text-sm">Èå¢ÂåÖ</span>
                </button>
                <button @click="currentView='packing'" class="glass p-4 flex flex-col items-center justify-center aspect-[4/3] hover:bg-white/5 transition-colors">
                    <div class="w-10 h-10 rounded-full bg-blue-500/20 text-blue-400 flex items-center justify-center text-lg mb-2"><i class="fas fa-suitcase"></i></div>
                    <span class="font-bold text-sm">Ë°åÊùé</span>
                </button>
            </div>
        </div>

        <div v-if="currentView === 'itinerary'" class="space-y-6 pt-2">
            <div class="sticky top-0 z-30 bg-[#0f172a]/95 backdrop-blur-md pb-4 pt-2 -mx-5 px-5 border-b border-white/10">
                <div class="flex justify-between items-end mb-4">
                    <h2 class="text-2xl font-black font-mincho">{{ itinerary[dayIndex].date_short }}</h2>
                    <span class="text-xs font-bold bg-white/10 px-2 py-1 rounded">{{ itinerary[dayIndex].location }}</span>
                </div>
                <div class="flex gap-3 overflow-x-auto no-scrollbar mask-linear">
                    <button v-for="(day, idx) in itinerary" :key="idx" @click="dayIndex = idx"
                            class="flex-shrink-0 w-12 h-14 rounded-xl flex flex-col items-center justify-center border transition-all"
                            :class="dayIndex === idx ? 'bg-white text-slate-900 border-white' : 'bg-white/5 border-white/10 text-white/40'">
                        <span class="text-[9px] font-bold uppercase">{{ day.date_en.substr(0,3) }}</span>
                        <span class="text-lg font-black">{{ day.day }}</span>
                    </button>
                </div>
            </div>

            <div class="relative pl-2">
                <div class="absolute left-[7px] top-2 bottom-0 w-[2px] bg-white/10 rounded-full"></div>
                <div v-for="(place, pIdx) in itinerary[dayIndex].places" :key="pIdx" class="relative pl-8 mb-6 group">
                    <div class="absolute left-0 top-0 w-4 h-4 bg-[#0f172a] border-[3px] rounded-full z-10" :class="getTypeColor(place.type)"></div>
                    <div @click="openDetail(place)" class="glass p-5 relative overflow-hidden active:scale-[0.98] transition-all cursor-pointer">
                        <div class="flex justify-between items-start mb-2">
                            <span class="text-[10px] font-black bg-white/10 px-2 py-1 rounded">{{ place.time }}</span>
                            <span class="text-[10px] font-bold opacity-60">{{ place.typeLabel }}</span>
                        </div>
                        <h3 class="text-lg font-black mb-1">{{ place.name }}</h3>
                        <p class="text-xs text-white/60 line-clamp-1 mb-3">{{ place.desc }}</p>
                        <div class="flex flex-wrap gap-2">
                            <span v-for="tag in place.highlights" class="px-2 py-1 bg-white/5 border border-white/10 rounded text-[10px] font-bold text-emerald-300">{{ tag }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'wallet'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho">Èå¢ÂåÖ & Ë≥ºÁâ©</h2>
            
            <div class="flex bg-white/10 p-1 rounded-xl">
                <button @click="walletMode='expense'" class="flex-1 py-2 rounded-lg text-xs font-bold transition-all" :class="walletMode==='expense'?'bg-white text-slate-900 shadow-sm':'text-white/50'">Ë®òÂ∏≥ Expenses</button>
                <button @click="walletMode='wishlist'" class="flex-1 py-2 rounded-lg text-xs font-bold transition-all" :class="walletMode==='wishlist'?'bg-white text-slate-900 shadow-sm':'text-white/50'">Ë≥ºÁâ©Ê∏ÖÂñÆ Wishlist</button>
            </div>

            <div v-if="walletMode==='expense'" class="space-y-4 animate-fade-in">
                <div class="flex gap-3 overflow-x-auto no-scrollbar pb-2">
                    <div class="glass p-4 min-w-[140px] h-24 flex flex-col justify-between bg-gradient-to-br from-indigo-600/50 to-purple-600/50">
                        <span class="text-[10px] opacity-60 font-bold uppercase">Total</span>
                        <span class="text-xl font-mono font-black">¬•{{ totalBudget.toLocaleString() }}</span>
                    </div>
                    <div class="glass p-4 min-w-[140px] h-24 flex flex-col justify-between">
                        <span class="text-[10px] opacity-60 font-bold uppercase"><i class="fas fa-mars text-blue-400 mr-1"></i> TszLok</span>
                        <span class="text-xl font-mono font-black text-blue-300">¬•{{ calcPayerTotal('TszLok').toLocaleString() }}</span>
                    </div>
                    <div class="glass p-4 min-w-[140px] h-24 flex flex-col justify-between">
                        <span class="text-[10px] opacity-60 font-bold uppercase"><i class="fas fa-venus text-pink-400 mr-1"></i> TszTung</span>
                        <span class="text-xl font-mono font-black text-pink-300">¬•{{ calcPayerTotal('TszTung').toLocaleString() }}</span>
                    </div>
                </div>
                <div class="space-y-3">
                    <div v-for="(item, idx) in budgetList" :key="idx" class="glass p-4 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-[10px] font-bold text-white shadow-sm" :class="item.payer==='TszLok'?'bg-blue-500':'bg-pink-500'">{{ item.payer==='TszLok'?'TL':'TT' }}</div>
                            <span class="text-sm font-bold">{{ item.name }}</span>
                        </div>
                        <div class="flex items-center gap-3"><span class="font-mono font-bold opacity-80">¬•{{ item.price }}</span><button @click="deleteBudget(idx)" class="text-white/20 hover:text-red-400"><i class="fas fa-times text-xs"></i></button></div>
                    </div>
                </div>
            </div>

            <div v-if="walletMode==='wishlist'" class="grid grid-cols-2 gap-4 animate-fade-in">
                <div @click="showWishlistInput=true" class="glass p-4 flex flex-col items-center justify-center aspect-square border-2 border-dashed border-white/20 hover:bg-white/5 cursor-pointer">
                    <i class="fas fa-camera text-2xl mb-2 text-white/50"></i>
                    <span class="text-xs font-bold text-white/50">Add Item</span>
                </div>
                <div v-for="(item, idx) in wishlist" :key="idx" class="glass overflow-hidden relative group">
                    <button @click="deleteWishlist(idx)" class="absolute top-2 right-2 w-6 h-6 bg-black/60 rounded-full flex items-center justify-center text-xs z-10 opacity-0 group-hover:opacity-100 transition-opacity"><i class="fas fa-times"></i></button>
                    <img :src="item.image" class="w-full aspect-square object-cover">
                    <div class="p-3">
                        <div class="font-bold text-sm truncate">{{ item.name }}</div>
                        <div class="font-mono text-xs font-bold text-emerald-400">¬•{{ item.price }}</div>
                    </div>
                </div>
            </div>
            
            <div class="fixed bottom-24 right-6 z-40">
                <button v-if="walletMode==='expense'" @click="showBudgetInput=true" class="w-14 h-14 bg-emerald-500 text-white rounded-full shadow-xl flex items-center justify-center text-xl"><i class="fas fa-plus"></i></button>
            </div>
        </div>

        <div v-if="currentView === 'packing'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho">Ë°åÊùéÊ∏ÖÂñÆ</h2>
            <div v-for="(group, key) in packingList" :key="key" class="glass overflow-hidden">
                <div class="bg-white/5 px-5 py-3 flex items-center gap-3 border-b border-white/5">
                    <i class="fas" :class="key==='handCarry'?'fa-briefcase':key==='tszLok'?'fa-mars text-blue-400':key==='tszTung'?'fa-venus text-pink-400':'fa-water'"></i>
                    <span class="font-bold text-sm uppercase tracking-wide">{{ keyLabels[key] }}</span>
                </div>
                <div class="p-2 grid gap-1">
                    <label v-for="(item, idx) in group" :key="idx" class="flex items-center p-3 hover:bg-white/5 rounded-xl cursor-pointer check-box transition-colors">
                        <input type="checkbox" v-model="item.checked" class="hidden">
                        <div class="w-5 h-5 rounded border-2 border-white/30 flex items-center justify-center mr-3 transition-colors bg-white/5"><i class="fas fa-check text-white text-[10px] opacity-0"></i></div>
                        <span class="text-sm font-bold transition-opacity" :class="{'line-through opacity-30': item.checked}">{{ item.name }}</span>
                    </label>
                </div>
            </div>
        </div>

    </main>

    <nav class="fixed bottom-0 w-full h-[85px] bg-[#0f172a]/95 backdrop-blur-xl border-t border-white/10 z-[50] flex justify-around items-center px-2 pb-safe-bottom">
        <button v-for="tab in tabs" :key="tab.id" @click="currentView = tab.id" 
                class="flex flex-col items-center justify-center w-14 h-full space-y-1 transition-all"
                :class="currentView === tab.id ? 'text-emerald-400 scale-110' : 'text-white/40'">
            <i :class="tab.icon" class="text-xl"></i>
            <span class="text-[9px] font-bold uppercase tracking-widest">{{ tab.label }}</span>
        </button>
    </nav>

    <div v-if="detailModal.show" class="fixed inset-0 z-[60] flex items-end justify-center">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="detailModal.show=false"></div>
        <div class="bg-[#1e293b] w-full max-w-md rounded-t-3xl p-6 relative border-t border-white/20 animate-slide-up max-h-[85vh] overflow-y-auto">
            <div class="w-12 h-1 bg-white/20 rounded-full mx-auto mb-6"></div>
            <span class="px-3 py-1 bg-white/10 rounded-lg text-xs font-bold uppercase text-emerald-300">{{ detailModal.data.typeLabel }}</span>
            <h2 class="text-2xl font-black mt-3 mb-2 font-mincho">{{ detailModal.data.name }}</h2>
            <div class="text-sm font-bold opacity-60 mb-6 flex items-center"><i class="far fa-clock mr-2"></i> {{ detailModal.data.time }}</div>
            <div class="space-y-6 text-sm leading-relaxed">
                <div v-if="detailModal.data.desc"><h4 class="text-xs font-bold opacity-50 uppercase tracking-widest mb-2">Description</h4><p class="font-bold">{{ detailModal.data.desc }}</p></div>
                <div v-if="detailModal.data.strategy" class="bg-emerald-500/10 p-5 rounded-2xl border-l-4 border-emerald-500"><h4 class="text-xs font-bold uppercase tracking-widest mb-3 flex items-center text-emerald-400"><i class="fas fa-chess-knight mr-2"></i>ÊîªÁï• Strategy</h4><div class="font-bold whitespace-pre-line">{{ detailModal.data.strategy }}</div></div>
                <a v-if="detailModal.data.ticketLink" :href="detailModal.data.ticketLink" target="_blank" class="block w-full py-4 bg-emerald-600 text-white text-center rounded-2xl font-bold shadow-lg">View Ticket</a>
            </div>
            <div class="h-20"></div>
            <div class="absolute bottom-6 left-6 right-6"><button @click="openMap(detailModal.data.name)" class="w-full py-4 bg-white text-slate-900 rounded-2xl font-bold shadow-lg">Open Map</button></div>
        </div>
    </div>

    <div v-if="showBudgetInput" class="fixed inset-0 z-[60] flex items-end justify-center"><div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="showBudgetInput=false"></div><div class="bg-[#1e293b] w-full max-w-md p-6 rounded-t-3xl border-t border-white/20 animate-slide-up"><h3 class="font-bold mb-4 text-lg">Add Expense</h3><div class="flex gap-3 mb-4"><button v-for="p in payers" :key="p" @click="newItem.payer=p" class="flex-1 py-3 rounded-xl border font-bold text-sm" :class="newItem.payer===p?(p==='TszLok'?'bg-blue-500 border-blue-500':'bg-pink-500 border-pink-500'):'border-white/20 text-white/50'">{{ p }}</button></div><input v-model="newItem.name" placeholder="Item Name" class="w-full bg-white/10 p-4 rounded-xl mb-3 font-bold border border-white/10 text-white"><input v-model.number="newItem.price" type="number" placeholder="¬• Amount" class="w-full bg-white/10 p-4 rounded-xl mb-6 font-bold border border-white/10 text-white"><div class="flex gap-3"><button @click="showBudgetInput=false" class="flex-1 py-3 font-bold text-white/50">Cancel</button><button @click="addItem" class="flex-1 py-3 bg-white text-slate-900 rounded-xl font-bold">Save</button></div></div></div>

    <div v-if="showWishlistInput" class="fixed inset-0 z-[60] flex items-end justify-center"><div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="showWishlistInput=false"></div><div class="bg-[#1e293b] w-full max-w-md p-6 rounded-t-3xl border-t border-white/20 animate-slide-up"><h3 class="font-bold mb-4 text-lg">Add to Wishlist</h3><div class="mb-4 relative group"><input type="file" accept="image/*" @change="handleImageUpload" class="absolute inset-0 w-full h-full opacity-0 z-10"><div v-if="!newWishItem.image" class="w-full h-32 bg-white/5 border-2 border-dashed border-white/20 rounded-xl flex flex-col items-center justify-center text-white/30"><i class="fas fa-camera text-2xl mb-1"></i><span class="text-xs">Upload Photo</span></div><img v-else :src="newWishItem.image" class="img-preview"></div><input v-model="newWishItem.name" placeholder="Product Name" class="w-full bg-white/10 p-4 rounded-xl mb-3 font-bold border border-white/10 text-white"><input v-model.number="newWishItem.price" type="number" placeholder="¬• Price" class="w-full bg-white/10 p-4 rounded-xl mb-6 font-bold border border-white/10 text-white"><div class="flex gap-3"><button @click="showWishlistInput=false" class="flex-1 py-3 font-bold text-white/50">Cancel</button><button @click="addWishlist" class="flex-1 py-3 bg-white text-slate-900 rounded-xl font-bold">Add</button></div></div></div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;

    createApp({
        setup() {
            const currentView = ref('dashboard');
            const dayIndex = ref(0);
            const detailModal = ref({ show: false, data: {} });
            
            // Wallet State
            const walletMode = ref('expense');
            const showBudgetInput = ref(false);
            const showWishlistInput = ref(false);
            const payers = ['TszLok', 'TszTung'];
            const newItem = ref({ name: '', price: '', payer: 'TszLok' });
            const newWishItem = ref({ name: '', price: '', image: null });
            const budgetList = ref([]);
            const wishlist = ref([]);

            // MOCK WEATHER 2026
            const forecast2026 = [
                { date: "2/25", temp: "8¬∞C", icon: "fas fa-cloud-sun", loc: "Nagoya" },
                { date: "2/26", temp: "10¬∞C", icon: "fas fa-sun", loc: "Nagoya" },
                { date: "2/27", temp: "12¬∞C", icon: "fas fa-cloud", loc: "Nagoya" },
                { date: "2/28", temp: "-2¬∞C", icon: "fas fa-snowflake", loc: "Takayama" },
                { date: "3/1", temp: "-3¬∞C", icon: "fas fa-snowflake", loc: "Shirakawa" },
                { date: "3/2", temp: "-5¬∞C", icon: "fas fa-snowflake", loc: "Okuhida" },
                { date: "3/3", temp: "9¬∞C", icon: "fas fa-plane", loc: "Airport" }
            ];

            // PACKING LIST
            const keyLabels = { handCarry: 'Hand Carry', tszLok: 'TszLok (Boy)', tszTung: 'TszTung (Girl)', shared: 'Kayak / Shared' };
            const packingList = ref({
                handCarry: [{name: 'ÂÄã‰∫∫Ë≠â‰ª∂ (Ë∫´ÂàÜË≠â/Ë≠∑ÁÖß/Á∞ΩË≠â)', checked: false}, {name: 'ÁôªÊ©üË≠â', checked: false}, {name: 'ÈäÄÂåÖ', checked: false}, {name: 'SIMÂç°', checked: false}, {name: 'ÊâãÊ©ü & ÂÖÖÈõª & Â∞øË¢ã', checked: false}, {name: 'ËÄ≥Ê©ü & Áõ∏Ê©ü', checked: false}, {name: 'È†êÁ¥ÑË≠âÊòé', checked: false}, {name: 'Âè£ÁΩ©/Ê∂àÊØí', checked: false}, {name: 'Á©∫Ê∞¥Ê®Ω & ÂéüÂ≠êÁ≠Ü', checked: false}, {name: 'ÊΩ§ÂîáËÜè', checked: false}, {name: 'ÁúºÁΩ©/È†∏Êûï', checked: false}, {name: 'Â±ã‰ºÅKey', checked: false}],
                tszLok: [{name: 'Â§ñÂá∫Ë°£Áâ©', checked: false}, {name: 'Áù°Ë°£Ë§≤', checked: false}, {name: 'ÂÖßË°£Ë§≤ & Ë•™', checked: false}, {name: 'Â§ñÂ•ó', checked: false}, {name: 'Áî∑Â£´ÂâÉÈ¨ö', checked: false}, {name: 'ËΩâÊèí & ÊãñÊùø', checked: false}, {name: 'Èõ®ÂÇò/Èõ®Ë°£', checked: false}, {name: 'ÊãñÈûã', checked: false}, {name: 'ÂÇôÁî®ËÜ†Ë¢ã', checked: false}],
                tszTung: [{name: 'Â§ñÂá∫Ë°£Áâ©', checked: false}, {name: 'Áù°Ë°£Ë§≤', checked: false}, {name: 'ÂÖßË°£Ë§≤ & Ë•™', checked: false}, {name: 'Â§ñÂ•ó', checked: false}, {name: 'ÂåñÂ¶ùÂìÅ', checked: false}, {name: 'Ë≠∑ËÜöÂìÅ', checked: false}, {name: 'Ê¥óÈù¢/Ê¥óÈ´Æ/Ë≠∑È´Æ', checked: false}, {name: 'È†≠È´ÆÂÆöÂûã', checked: false}, {name: 'Ê¢≥ & È¢®Á≠í', checked: false}, {name: 'Èö±ÂΩ¢ÁúºÈè°', checked: false}, {name: 'Â•≥ÊÄßË≠∑ÁêÜ', checked: false}, {name: 'ÊØõÂ∑æ', checked: false}, {name: 'ÂÖ¨‰ªî', checked: false}, {name: 'ÁÜ±Ê∞¥ÁÖ≤', checked: false}],
                shared: [{name: 'Kayak: Ê≥≥Ë°£', checked: false}, {name: 'Kayak: Èò≤Ê∞¥Ë¢ã', checked: false}, {name: 'Kayak: Aqua Shoes', checked: false}, {name: 'Kayak: ÊØõÂ∑æ/Ê≤ñÊ∂ºÊ∂≤', checked: false}]
            });

            // ITINERARY
            const itinerary = ref([
                { day: 1, date_short: "2/25", date_en: "Wed", location: "Nagoya", places: [
                    { time: "14:30", name: "‰∏≠ÈÉ®ÂúãÈöõÊ©üÂ†¥", type: "transport", typeLabel: "ÊäµÈÅî", desc: "NGO ÊäµÈÅî„ÄÇË≥ºË≤∑ Œº-Sky„ÄÇ", strategy: "1. Ë≥ºË≤∑„ÄéŒº-Sky„ÄèÁâπÊÄ•Âà∏„ÄÇ\n2. ÂÖ®ËªäÊåáÂÆöÂ∏≠„ÄÇ", highlights: ["Á∂†Ëå∂"] },
                    { time: "15:30", name: "ÂâçÂæÄÂ∏ÇÂçÄ", type: "transport", typeLabel: "ÁßªÂãï", desc: "Êê≠‰πòÂêçÈêµ ‚Üí ÂêçÂè§Â±ãÁ´ô„ÄÇ", strategy: "ËΩâ‰πòÊ´ªÈÄöÁ∑öËá≥„Äé‰πÖÂ±ãÂ§ßÈÄöÁ´ô„Äè„ÄÇ\nÊâæ 4B Êàñ 1A Âá∫Âè£„ÄÇ", highlights: ["4B/1AÂá∫Âè£"] },
                    { time: "16:30", name: "Ë•øÈêµÈÖíÂ∫ó Croom", type: "stay", typeLabel: "Check-in", desc: "ÊîæÂ•ΩË°åÊùé„ÄÇ", strategy: "Check-in ÂæåÂéªÂ§ßÊµ¥Â†¥„ÄÇ", highlights: ["Â§ßÊµ¥Â†¥"] },
                    { time: "18:00", name: "Indo Ryori Kalash", type: "food", typeLabel: "ÊôöÈ§ê", desc: "Ê≠•Ë°å5ÂàÜÈêò„ÄÇÂç∞Â∫¶ÊñôÁêÜ„ÄÇ", strategy: "‚óè È£≤ÂìÅÔºöMango Lassi„ÄÇ\n‚óè ‰∏ªÈ£üÔºöËµ∑Âè∏ÁÉ§È§Ö„ÄÇ\n‚óè ÁßòÊäÄÔºöÂêÉ‰∏çÂÆåÂ§ñÂ∏∂Áï∂Êó©È§ê„ÄÇ", highlights: ["Cheese Naan"] },
                    { time: "20:00", name: "Oasis 21", type: "spot", typeLabel: "Â§úÊôØ", desc: "Ê∞¥ÁöÑÂÆáÂÆôËàπ„ÄÇ", strategy: "ÊãçÊîùÈõªË¶ñÂ°îÂÄíÂΩ±„ÄÇ", highlights: ["ÊãçÁÖß"] },
                    { time: "21:00", name: "‰æøÂà©ÂïÜÂ∫ó", type: "spot", typeLabel: "Êé°Ë≤∑", desc: "7-11„ÄÇ", strategy: "ÂøÖË≤∑ÔºöÁÑ¶Á≥ñÁÉ§Â∏ÉËïæÂÜ∞Ê∑áÊ∑ã„ÄÇ", highlights: ["ÁÑ¶Á≥ñÂÜ∞Ê∑áÊ∑ã"] }
                ]},
                { day: 2, date_short: "2/26", date_en: "Thu", location: "Nagoya", places: [
                    { time: "09:00", name: "Konparu Ê¶ÆÂ∫ó", type: "food", typeLabel: "Êó©È§ê", desc: "Ê¶ÆÂú∞‰∏ãË°ó„ÄÇ", strategy: "‚ö†Ô∏è Áõ¥Êé•Â§ñÂ∏∂ÁÇ∏Ëù¶‰∏âÊòéÊ≤ªÂéªÂêâÂçúÂäõÂêÉÔºÅ\n‚ùå ‰∏çË¶ÅÂàáÈÇä„ÄÇ", highlights: ["ÁÇ∏Ëù¶‰∏âÊòéÊ≤ª"] },
                    { time: "10:30", name: "ÂâçÂæÄÂêâÂçúÂäõ", type: "transport", typeLabel: "ÁßªÂãï", desc: "Ê¶Æ‚ÜíËó§‰πã‰∏ò‚ÜíLinimo„ÄÇ", strategy: "Âú®Ëó§‰πã‰∏òËΩâ Linimo„ÄÇ", highlights: ["Linimo"] },
                    { time: "12:00", name: "ÂêâÂçúÂäõÂ§ßÂÄâÂ∫´", type: "spot", typeLabel: "ÈáçÈªû", desc: "12:00 Ê∫ñÊôÇÂÖ•Â†¥„ÄÇ", strategy: "‚ö†Ô∏è TszLok Â∏∂Ë≠∑ÁÖßÔºÅ\n‚óè ÂãïÁ∑öÔºöÂêçÂ†¥Èù¢Â±ï(ÁÑ°ËáâÁî∑) ‚Üí ÁçµÊà∂Â∫ßÈõªÂΩ±Èô¢ ‚Üí ÂïÜÂ∫ó„ÄÇ", highlights: ["ÂêçÂ†¥Èù¢Â±ï"], booking: "Ticket Needed", ticketLink: "https://quickticket.moala.fun/books?id=d1315e41-24de-40a9-a20a-0cf36d07ec8f" },
                    { time: "18:30", name: "ÁÜ±Áî∞Ëì¨ËêäËªí", type: "food", typeLabel: "ÊôöÈ§ê", desc: "ÊùæÂùÇÂ±ãÂçóÈ§® 10F„ÄÇ", strategy: "üî• ÂêÉÊ≥ïÂõõÈÉ®Êõ≤Ôºö\n1. ÂéüÂë≥„ÄÇ\n2. Âä†‰ΩêÊñô„ÄÇ\n3. Ëå∂Ê≥°È£Ø„ÄÇ\n4. Ëá™ÈÅ∏„ÄÇ", highlights: ["ÂøÖÂêÉ"], booking: "#8823" },
                    { time: "20:00", name: "HARBS", type: "food", typeLabel: "ÁîúÈªû", desc: "ÈõªË¶ñÂ°îÊóÅ„ÄÇ", strategy: "Â§ñÂ∏∂Ê∞¥ÊûúÂçÉÂ±§ÂõûÈ£ØÂ∫ó„ÄÇ", highlights: ["Ê∞¥ÊûúÂçÉÂ±§"] }
                ]},
                { day: 3, date_short: "2/27", date_en: "Fri", location: "Nagoya", places: [
                    { time: "09:00", name: "Komeda's Coffee", type: "food", typeLabel: "Êó©È§ê", desc: "ÈªûÈ£≤ÊñôÈÄÅÂêêÂè∏„ÄÇ", strategy: "ÈÅ∏ CÈ§ê (Á¥ÖË±ÜÊ≥•)„ÄÇ", highlights: ["Á¥ÖË±ÜÂêêÂè∏"] },
                    { time: "10:00", name: "ÂêçÂè§Â±ãÊ∏ØÊ∞¥ÊóèÈ§®", type: "spot", typeLabel: "ÊôØÈªû", desc: "ÂåóÈ§®ÁúãËôéÈØ®„ÄÇ", strategy: "Êµ∑Ë±öÁßÄÂùêÂâç4ÊéíÊúÉÊøï„ÄÇ", highlights: ["ËôéÈØ®"] },
                    { time: "13:30", name: "Áü¢Â†¥ÁÇ∏Ë±¨Êéí", type: "food", typeLabel: "ÂçàÈ§ê", desc: "Â§ßÈ†àÂ∫ó„ÄÇ", strategy: "ÈªûÈêµÊùøÂë≥ÂôåË±¨Êéí„ÄÇÁ©øÂúçÂÖú„ÄÇ", highlights: ["ÈêµÊùø"] },
                    { time: "15:00", name: "Â§ßÈ†àÂïÜÂ∫óË°ó", type: "spot", typeLabel: "ÈÄõË°ó", desc: "Êï£Á≠ñ„ÄÇ", strategy: "‰∏âËº™Á•ûÁ§æÊë∏ÂÖîÂ≠ê„ÄÇ", highlights: ["‰∏âËº™Á•ûÁ§æ"] },
                    { time: "20:30", name: "Piyorin", type: "food", typeLabel: "ÊåëÊà∞", desc: "Â∞èÈõûËõãÁ≥ï„ÄÇ", strategy: "Â∞èÂøÉÊãøÂõûÈ£ØÂ∫ó‰∏çÂÄí„ÄÇ", highlights: ["Piyorin"] }
                ]},
                { day: 4, date_short: "2/28", date_en: "Sat", location: "Takayama", places: [
                    { time: "09:00", name: "JR Hida", type: "transport", typeLabel: "ÁßªÂãï", desc: "ÂâçÂæÄÈ´òÂ±±„ÄÇ", strategy: "ÂùêÊúÄÂæå‰∏ÄÊéí Luggage Seat„ÄÇ", highlights: ["ÊåáÂÆöÂ∏≠"] },
                    { time: "12:15", name: "È´òÂ±±Ê´ªÂ∫µ", type: "stay", typeLabel: "ÂØÑÊîæ", desc: "È´òÂ±±Á´ôÊóÅ„ÄÇ", strategy: "Â§ßÂª≥ÂØÑÊîæË°åÊùé„ÄÇ", highlights: [] },
                    { time: "13:00", name: "È´òÂ±±ËÄÅË°ó", type: "spot", typeLabel: "Êï£Á≠ñ", desc: "‰∏âÁî∫ÈÄö„ÄÇ", strategy: "ÂêÉÈ£õÈ©íÁâõÊè°Â£ΩÂè∏„ÄÇ", highlights: ["Â£ΩÂè∏"] },
                    { time: "18:00", name: "Âë≥ËóèÂ§©Âúã", type: "food", typeLabel: "ÊôöÈ§ê", desc: "È´òÂ±±Á¨¨‰∏ÄÁáíËÇâ„ÄÇ", strategy: "‚óè ÂøÖÈªûÔºöAjikura Mori ÊãºÁõ§„ÄÇ\n‚óè Êè°Â£ΩÂè∏ÂøÖÈªû„ÄÇ", highlights: ["È£õÈ©íÁâõ"], booking: "ÈúÄÈ†êÁ¥Ñ" },
                    { time: "22:00", name: "Â§úÈ≥¥ÊãâÈ∫µ", type: "food", typeLabel: "ÂÆµÂ§ú", desc: "È£ØÂ∫óÂÖçË≤ª„ÄÇ", strategy: "‰∏çË¶ÅÈåØÈÅé„ÄÇ", highlights: ["ÂÖçË≤ª"] }
                ]},
                { day: 5, date_short: "3/1", date_en: "Sun", location: "Shirakawa-go", places: [
                    { time: "09:00", name: "ÊøÉÈ£õÂ∑¥Â£´", type: "transport", typeLabel: "ÁßªÂãï", desc: "ÂâçÂæÄÁôΩÂ∑ùÈÑâ„ÄÇ", highlights: ["ÊöàËªäËó•"], booking: "Bus Ticket" },
                    { time: "10:00", name: "ÁôΩÂ∑ùÈÑâ", type: "spot", typeLabel: "‰∏ñÁïåÈÅ∫Áî¢", desc: "ÂêàÊéåÊùë„ÄÇ", strategy: "‰∏äÂ±ïÊúõÂè∞„ÄÇ", highlights: ["Â±ïÊúõÂè∞"] },
                    { time: "12:00", name: "Âñ´Ëå∂ËêΩ‰∫∫", type: "food", typeLabel: "ÂçàÈ§ê", desc: "Ochiudo„ÄÇ", strategy: "ÂíñÂì©È£Ø + ÁÑ°ÈôêÁ¥ÖË±ÜÊπØ„ÄÇ", highlights: ["Á¥ÖË±ÜÊπØ"] },
                    { time: "16:00", name: "Ë≤∏ÂàáÈ¢®ÂëÇ", type: "spot", typeLabel: "Ê∫´Ê≥â", desc: "È£ØÂ∫óÈ†ÇÊ®ì„ÄÇ", strategy: "ÁßÅ‰∫∫ÊπØÂ±ã„ÄÇ", highlights: ["ÁßÅ‰∫∫ÊπØÂ±ã"] },
                    { time: "18:00", name: "‰∏∏Êòé", type: "food", typeLabel: "ÊôöÈ§ê", desc: "Â£ΩÂñúÁáí„ÄÇ", strategy: "ËÇâÊ≤æËõãÊ∂≤ÂêÉ„ÄÇ", highlights: ["Â£ΩÂñúÁáí"], booking: "" }
                ]},
                { day: 6, date_short: "3/2", date_en: "Mon", location: "Okuhida", places: [
                    { time: "10:30", name: "Êñ∞Á©óÈ´òÁ∫úËªä", type: "spot", typeLabel: "ÁµïÊôØ", desc: "ÈõôÂ±§Á∫úËªä„ÄÇ", strategy: "Êê∂2Ê®ìÁ™óÈÇä„ÄÇ", highlights: ["Èõ™ÊôØ"] },
                    { time: "14:00", name: "Âπ≥ÊπØ‰πãÊ£Æ", type: "spot", typeLabel: "Ê∫´Ê≥â", desc: "Êó•Ê≠∏Ê∫´Ê≥â„ÄÇ", strategy: "Èú≤Â§©Èõ™Ë¶ãÊ∫´Ê≥â„ÄÇ", highlights: ["Êó•Ê≠∏"] },
                    { time: "18:00", name: "Center4", type: "food", typeLabel: "ÊôöÈ§ê", desc: "È£õÈ©íÁâõÊº¢Â†°„ÄÇ", strategy: "Ëã•ÁÑ°‰ΩçÂéªÂêÉ‰∫¨ya„ÄÇ", highlights: ["Êº¢Â†°"], booking: "" }
                ]},
                { day: 7, date_short: "3/3", date_en: "Tue", location: "Airport", places: [
                    { time: "08:00", name: "ÂÆÆÂ∑ùÊúùÂ∏Ç", type: "spot", typeLabel: "Â∏ÇÈõÜ", desc: "Ë≤∑‰º¥ÊâãÁ¶Æ„ÄÇ", highlights: ["ÊúùÂ∏Ç"] },
                    { time: "13:30", name: "ÂâçÂæÄÊ©üÂ†¥", type: "transport", typeLabel: "ÁßªÂãï", desc: "ÊøÉÈ£õÂ∑¥Â£´Áõ¥ÈÅî„ÄÇ", highlights: ["È†êÁ¥Ñ"] },
                    { time: "17:00", name: "Flight of Dreams", type: "spot", typeLabel: "Ê©üÂ†¥", desc: "Ê≥¢Èü≥787„ÄÇ", highlights: ["Ëù¶È§Ö"] },
                    { time: "21:00", name: "Ëµ∑È£õËøîÊ∏Ø", type: "transport", typeLabel: "Èõ¢Â¢É", desc: "UO685„ÄÇ", highlights: [], booking: "" }
                ]}
            ]);

            // COUNTDOWN
            const now = ref(new Date());
            const tripStart = new Date('2026-02-25T10:00:00+09:00');
            const countdown = computed(() => {
                const diff = tripStart - now.value;
                if(diff <= 0) return {days:0, hours:'00', minutes:'00'};
                return {
                    days: Math.floor(diff/(1000*60*60*24)),
                    hours: Math.floor((diff%(1000*60*60*24))/(1000*60*60)).toString().padStart(2,'0'),
                    minutes: Math.floor((diff%(1000*60*60))/(1000*60)).toString().padStart(2,'0')
                };
            });
            const tripProgress = computed(() => {
                const booking = new Date('2025-02-25T10:00:00+09:00');
                const total = tripStart - booking;
                const elapsed = now.value - booking;
                return Math.min(Math.max((elapsed/total)*100, 0), 100);
            });
            setInterval(() => now.value = new Date(), 60000);

            // PERSISTENCE
            onMounted(() => { 
                initSnow();
                const b = localStorage.getItem('jp_v18_b'); if(b) budgetList.value = JSON.parse(b); 
                const w = localStorage.getItem('jp_v18_w'); if(w) wishlist.value = JSON.parse(w); 
                const p = localStorage.getItem('jp_v18_p'); if(p) packingList.value = JSON.parse(p);
            });
            watch(budgetList, v => localStorage.setItem('jp_v18_b', JSON.stringify(v)), {deep:true});
            watch(wishlist, v => localStorage.setItem('jp_v18_w', JSON.stringify(v)), {deep:true});
            watch(packingList, v => localStorage.setItem('jp_v18_p', JSON.stringify(v)), {deep:true});

            const initSnow = () => {
                const c = document.getElementById('snow-container');
                c.innerHTML = '';
                for(let i=0; i<30; i++) {
                    const f = document.createElement('div');
                    f.className = 'snowflake fas fa-snowflake';
                    f.style.left = Math.random()*100+'vw';
                    f.style.animationDuration = (Math.random()*5+5)+'s';
                    f.style.fontSize = (Math.random()*10+5)+'px';
                    c.appendChild(f);
                }
            };

            const getTypeColor = (t) => ({food:'border-orange-400 bg-orange-500', transport:'border-blue-400 bg-blue-500', stay:'border-purple-400 bg-purple-500', spot:'border-emerald-400 bg-emerald-500'}[t]||'border-gray-400');
            const openDetail = (p) => { detailModal.value = { show:true, data:p }; };
            const openMap = (n) => window.open(`https://www.google.com/maps/search/?api=1&query=${n} Japan`, '_blank');
            const addItem = () => { if(newItem.value.name&&newItem.value.price){ budgetList.value.unshift({...newItem.value}); showBudgetInput.value=false; newItem.value={name:'',price:'',payer:'TszLok'}; }};
            const deleteBudget = (i) => budgetList.value.splice(i,1);
            const totalBudget = computed(() => budgetList.value.reduce((s,i)=>s+i.price,0));
            const calcPayerTotal = (p) => budgetList.value.filter(i=>i.payer===p).reduce((s,i)=>s+i.price,0);
            
            const handleImageUpload = (event) => { const file = event.target.files[0]; if(file) { const reader = new FileReader(); reader.onload = (e) => { newWishItem.value.image = e.target.result; }; reader.readAsDataURL(file); } };
            const addWishlist = () => { if(newWishItem.value.name) { wishlist.value.unshift({...newWishItem.value}); newWishItem.value = { name: '', price: '', image: null }; showWishlistInput.value = false; } };
            const deleteWishlist = (idx) => wishlist.value.splice(idx, 1);

            const tabs = [
                { id: 'dashboard', label: 'Home', icon: 'fas fa-home' },
                { id: 'itinerary', label: 'Plan', icon: 'fas fa-map-marked-alt' },
                { id: 'wallet', label: 'Wallet', icon: 'fas fa-wallet' },
                { id: 'packing', label: 'Pack', icon: 'fas fa-suitcase' }
            ];

            return { currentView, dayIndex, itinerary, budgetList, packingList, newItem, showBudgetInput, detailModal, forecast2026, countdown, tripProgress, openDetail, openMap, addItem, deleteBudget, totalBudget, calcPayerTotal, payers, tabs, keyLabels, walletMode, showWishlistInput, newWishItem, wishlist, handleImageUpload, addWishlist, deleteWishlist };
        }
    }).mount('#app');
</script>
</body>
</html>
