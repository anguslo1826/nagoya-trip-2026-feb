<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ¢“æ¨‚Nagoya Trip v58.6</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3.4.19/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&family=Shippori+Mincho:wght@600;800&display=swap" rel="stylesheet">
    
    <style>
        /* THEME - "è’¼ç°ã®åœ°å±¤" Palette */
        :root {
            --bg-main: #70808f;     /* Slate Blue */
            --bg-card: #c5b59d;     /* Sand Beige */
            --text-on-card: #4a4238;/* Dark Brown */
            --text-on-bg: #f3f0eb;  /* Off White */
            --accent: #91867f;      /* Misty Umber */
        }
        body { 
            font-family: 'Zen Maru Gothic', sans-serif; 
            background-color: var(--bg-main); 
            color: var(--text-on-bg); 
            margin: 0; padding: 0; 
            height: 100dvh; width: 100vw; 
            overflow: hidden; 
            -webkit-tap-highlight-color: transparent;
        }
        .font-mincho { font-family: 'Shippori Mincho', serif; }
        .glass { 
            background: var(--bg-card); 
            color: var(--text-on-card);
            border: 1px solid rgba(255,255,255,0.3); 
            border-radius: 20px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-top { padding-top: max(20px, env(safe-area-inset-top)); }
        .safe-bottom { padding-bottom: max(20px, env(safe-area-inset-bottom)); }
        
        /* FIX: Force Inputs to be interactable */
        input { 
            user-select: text !important; 
            -webkit-user-select: text !important;
            pointer-events: auto !important;
        }

        /* Modal Z-Index Fixes */
        .modal-layer { position: fixed; inset: 0; z-index: 99999; }
        .modal-content { position: relative; z-index: 100000; }
        
        /* Animation */
        @keyframes slide-up {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .animate-slide-up { animation: slide-up 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        /* Calculator Grid */
        .calc-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
        }
        .calc-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(74, 66, 56, 0.1);
            border-radius: 12px;
            height: 50px;
            font-weight: 800;
            font-size: 1.2rem;
            color: #4a4238;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.1s;
        }
        .calc-btn:active { background: rgba(255, 255, 255, 0.4); transform: scale(0.95); }
        .calc-btn.op { background: rgba(114, 98, 81, 0.2); color: #726251; }
        .calc-btn.eq { background: #726251; color: white; }

        /* Ticket Styles */
        .ticket-stub {
            position: relative;
            clip-path: polygon(
                0% 0%, 100% 0%, 100% 100%, 0% 100%, 
                0% 70%, 5% 65%, 0% 60%, /* Left notch */
                0% 0%
            );
            cursor: pointer;
            transition: transform 0.1s;
        }
        .ticket-stub:active { transform: scale(0.98); }

        /* Method Colors */
        .method-online { background: #e6f4ea; color: #1e4620; border-left: 4px solid #34a853; } /* Green */
        .method-onsite { background: #fef7e0; color: #5f370e; border-left: 4px solid #fbbc04; } /* Yellow */
        .method-mobile { background: #f1f3f4; color: #3c4043; border-left: 4px solid #9aa0a6; } /* Grey */

        [v-cloak] { display: none !important; }
    </style>
</head>
<body>

<div id="app" v-cloak class="flex flex-col h-full w-full max-w-md mx-auto relative bg-[#70808f]">
    
    <main v-show="!isModalOpen" class="flex-1 overflow-y-auto overflow-x-hidden no-scrollbar z-10 pb-28 pt-safe-top px-5 scroll-smooth relative" ref="mainScroll">
        
        <div v-if="currentView === 'itinerary'" class="space-y-5 pb-4">
            <div class="flex justify-between items-center mb-2 mt-2">
                <div>
                    <div class="text-[10px] font-bold text-white/80 uppercase tracking-widest">JP.TRIP 2026</div>
                    <h1 class="text-3xl font-black font-mincho text-white flex items-center gap-2">
                        <i class="fas fa-chess-rook text-xl opacity-80"></i> æ¢“æ¨‚Nagoya Trip ğŸ‡¯ğŸ‡µ
                    </h1>
                </div>
                <div class="w-10 h-10 rounded-full border-2 border-white/50 overflow-hidden shadow-lg bg-[#c5b59d] flex items-center justify-center">
                    <img src="icon.jpg" class="w-full h-full object-cover" onerror="this.style.display='none'">
                    <i class="fas fa-user text-[#4a4238] opacity-50 absolute" style="z-index:-1;"></i>
                </div>
            </div>

            <div class="glass p-5 relative overflow-hidden mb-2 shadow-xl">
                <div class="flex justify-between items-end mb-2">
                    <span class="text-xs font-bold opacity-60 uppercase tracking-wider">è·é›¢å‡ºç™¼ (HKO Time)</span>
                    <i class="fas fa-plane text-[#726251] animate-pulse"></i>
                </div>
                <div class="flex items-baseline gap-2 mb-4">
                    <span class="text-6xl font-black font-mono tracking-tighter">{{ countdown.days }}</span>
                    <span class="text-sm font-bold opacity-80">Days</span>
                    <span class="text-2xl font-mono font-bold ml-2">{{ countdown.hours }}:{{ countdown.minutes }}:{{ countdown.seconds }}</span>
                </div>
                <div class="relative w-full h-2 bg-[#4a4238]/10 rounded-full mt-2">
                    <div class="absolute top-0 left-0 h-full bg-[#726251] rounded-full transition-all duration-1000" :style="{ width: tripProgress + '%' }"></div>
                </div>
                <div class="flex justify-between mt-2 text-[10px] font-bold opacity-50 font-mono">
                    <span>Now ({{ nowFormatted }})</span>
                    <span>2026.02.25 Go</span>
                </div>
            </div>

            <div class="bg-[#70808f] sticky top-0 z-30 py-2 -mx-5 px-5 border-b border-[#c5b59d]/30 shadow-lg">
                <div class="flex gap-3 overflow-x-auto no-scrollbar">
                    <button v-for="(day, idx) in itinerary" :key="idx" @click="dayIndex = idx"
                            class="flex-shrink-0 w-12 h-14 rounded-xl flex flex-col items-center justify-center border transition-all cursor-pointer active:scale-95"
                            :class="dayIndex === idx ? 'bg-[#c5b59d] text-[#4a4238] border-[#c5b59d] shadow-lg scale-105' : 'bg-white/10 border-white/10 text-white/60'">
                        <span class="text-[9px] font-bold uppercase">{{ day.date_en.substr(0,3) }}</span>
                        <span class="text-lg font-black">{{ day.day }}</span>
                    </button>
                </div>
            </div>

            <div class="glass p-3 border-l-4 border-[#726251] flex items-center justify-between">
                <div class="flex flex-col">
                    <span class="text-[10px] font-bold opacity-60 uppercase tracking-wider">{{ itinerary[dayIndex].date_short }} Weather</span>
                    <span class="text-xs font-bold">{{ itinerary[dayIndex].location }}</span>
                </div>
                <div class="flex gap-3 overflow-x-auto no-scrollbar max-w-[65%]">
                    <div v-for="(h, i) in currentDayWeather" :key="i" class="flex flex-col items-center min-w-[2.5rem]">
                        <span class="text-[9px] opacity-60 font-mono">{{ h.time }}</span>
                        <i :class="h.icon" class="text-sm my-0.5"></i>
                        <span class="text-[10px] font-bold">{{ h.temp }}</span>
                    </div>
                </div>
            </div>

            <div class="relative pl-2">
                <div class="absolute left-[7px] top-2 bottom-0 w-[2px] bg-[#c5b59d]/30 rounded-full"></div>
                <div v-for="(place, pIdx) in itinerary[dayIndex].places" :key="pIdx" class="relative pl-8 mb-6 group">
                    <div class="absolute left-0 top-0 w-4 h-4 bg-[#c5b59d] border-[3px] border-[#70808f] rounded-full z-10" :class="getTypeColor(place.type)"></div>
                    <div @click="openDetail(place)" class="glass p-4 relative overflow-hidden active:scale-[0.98] transition-all cursor-pointer hover:bg-[#d6c9b5] z-10">
                        <div class="flex justify-between items-start mb-2 relative z-10">
                            <span class="text-[10px] font-black bg-[#70808f] text-white px-2 py-1 rounded">{{ place.time }}</span>
                            <span class="text-[10px] font-bold opacity-60 uppercase">{{ place.typeLabel }}</span>
                        </div>
                        <h3 class="text-lg font-black mb-1 relative z-10">{{ place.name }}</h3>
                        <p class="text-xs opacity-80 line-clamp-1 mb-2 relative z-10">{{ place.desc }}</p>
                        
                        <div v-if="place.bookingType === 'flight'" class="mt-3 bg-[#70808f]/10 p-3 rounded-xl border border-[#70808f]/20 flex justify-between items-center relative z-20">
                            <div class="flex flex-col"><span class="text-[10px] font-bold uppercase opacity-60">Flight</span><span class="text-lg font-mono font-bold">{{ place.flightNo }}</span></div>
                            <div class="text-right"><span class="text-[10px] opacity-50 block">Info</span><span class="text-sm font-bold opacity-80">{{ place.terminal }}</span></div>
                        </div>
                        
                        <div class="flex flex-wrap gap-2 mt-2 relative z-10">
                            <span v-for="tag in place.highlights" class="px-2 py-1 bg-white/50 border border-black/5 rounded text-[10px] font-bold text-[#726251]">{{ tag }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'wallet'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">Spend & Buyyyyy</h2>
            <div class="flex bg-white/10 p-1 rounded-xl">
                <button @click="walletMode='expense'" class="flex-1 py-3 rounded-lg text-xs font-bold transition-all" :class="walletMode==='expense'?'bg-[#c5b59d] text-[#4a4238] shadow-sm':'text-white/60'">è¨˜å¸³ Expenses</button>
                <button @click="walletMode='wishlist'" class="flex-1 py-3 rounded-lg text-xs font-bold transition-all" :class="walletMode==='wishlist'?'bg-[#c5b59d] text-[#4a4238] shadow-sm':'text-white/60'">è³¼ç‰© Wishlist</button>
            </div>
            
            <div v-if="walletMode==='expense'" class="space-y-4">
                <div class="flex gap-2 overflow-x-auto no-scrollbar">
                    <button @click="budgetFilter='All'" class="px-4 py-2 rounded-full text-xs font-bold border transition-all" :class="budgetFilter==='All'?'bg-[#c5b59d] text-[#4a4238] border-[#c5b59d]':'bg-transparent text-white/60 border-white/20'">All</button>
                    <button @click="budgetFilter='TszLok'" class="px-4 py-2 rounded-full text-xs font-bold border transition-all" :class="budgetFilter==='TszLok'?'bg-[#91867f] text-white border-[#91867f]':'bg-transparent text-[#91867f] border-[#91867f]'">ğŸ‘¦ TszLok</button>
                    <button @click="budgetFilter='TszTung'" class="px-4 py-2 rounded-full text-xs font-bold border transition-all" :class="budgetFilter==='TszTung'?'bg-[#726251] text-white border-[#726251]':'bg-transparent text-[#726251] border-[#726251]'">ğŸ‘§ TszTung</button>
                </div>
                
                <div class="glass p-5 flex justify-between items-center">
                    <div class="flex flex-col"><span class="text-xs font-bold opacity-60 uppercase mb-1">Total Spent</span><span class="text-3xl font-mono font-black">Â¥{{ filteredTotal.toLocaleString() }}</span></div>
                </div>
                
                <div class="space-y-3 pb-20">
                    <div v-if="filteredBudgetList.length === 0" class="text-center opacity-40 text-xs py-10 font-bold">No expenses yet. Start spending!</div>
                    <div v-for="(item, idx) in filteredBudgetList" :key="idx" class="glass p-4 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs text-white shadow-sm" :class="item.payer==='TszLok'?'bg-[#91867f]':'bg-[#726251]'">{{ item.payer[0] }}</div>
                            <span class="text-sm font-bold">{{ item.name }}</span>
                        </div>
                        <div class="flex items-center gap-3"><span class="font-mono font-bold opacity-80">Â¥{{ item.price }}</span><button @click="deleteBudget(item)" class="opacity-40 hover:text-red-600"><i class="fas fa-times text-xs"></i></button></div>
                    </div>
                </div>
                
                <div class="fixed bottom-24 right-6 z-40">
                    <button @click="showBudgetInput=true" class="w-14 h-14 bg-[#c5b59d] text-[#4a4238] rounded-full shadow-xl flex items-center justify-center text-xl border-2 border-white/20 active:scale-90 transition-transform"><i class="fas fa-plus"></i></button>
                </div>
            </div>

            <div v-if="walletMode==='wishlist'" class="grid grid-cols-2 gap-4 pb-20">
                <div @click="showWishlistInput=true" class="glass p-4 flex flex-col items-center justify-center aspect-square border-2 border-dashed border-[#4a4238]/20 hover:bg-[#d6c9b5] cursor-pointer opacity-60 hover:opacity-100 transition-opacity">
                    <i class="fas fa-camera text-2xl mb-2"></i><span class="text-xs font-bold">Add Item</span>
                </div>
                <div v-for="(item, idx) in wishlist" :key="idx" class="glass overflow-hidden relative group">
                    <button @click="deleteWishlist(idx)" class="absolute top-2 right-2 w-6 h-6 bg-black/60 rounded-full flex items-center justify-center text-xs z-10 text-white shadow-md"><i class="fas fa-times"></i></button>
                    <img :src="item.image" class="w-full aspect-square object-cover">
                    <div class="p-3"><div class="font-bold text-sm truncate">{{ item.name }}</div><div class="font-mono text-xs font-bold opacity-60">Â¥{{ item.price }}</div></div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'reservations'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">é ç´„ & ç¥¨åˆ¸ Resv</h2>

            <div class="space-y-3">
                <div class="glass p-0 overflow-hidden relative border-l-4 border-[#91867f]">
                    <div class="bg-[#91867f]/10 p-3 flex justify-between items-center border-b border-[#4a4238]/10">
                        <span class="text-xs font-bold uppercase tracking-widest text-[#91867f]"><i class="fas fa-plane-departure mr-2"></i>Outbound</span>
                        <span class="text-xs font-bold text-[#4a4238]">2/25 (Wed)</span>
                    </div>
                    <div class="p-4 flex justify-between items-center">
                        <div class="text-center"><div class="text-2xl font-black font-mono">HKG</div><div class="text-[10px] font-bold opacity-50">Hong Kong</div></div>
                        <div class="flex flex-col items-center px-4"><i class="fas fa-arrow-right text-[#91867f] mb-1"></i><div class="text-[10px] font-bold bg-[#4a4238] text-white px-2 py-0.5 rounded">UO680</div></div>
                        <div class="text-center"><div class="text-2xl font-black font-mono">NGO</div><div class="text-[10px] font-bold opacity-50">Nagoya</div></div>
                    </div>
                </div>

                <div class="glass p-0 overflow-hidden relative border-l-4 border-[#726251]">
                    <div class="bg-[#726251]/10 p-3 flex justify-between items-center border-b border-[#4a4238]/10">
                        <span class="text-xs font-bold uppercase tracking-widest text-[#726251]"><i class="fas fa-plane-arrival mr-2"></i>Inbound</span>
                        <span class="text-xs font-bold text-[#4a4238]">3/3 (Tue)</span>
                    </div>
                    <div class="p-4 flex justify-between items-center">
                        <div class="text-center"><div class="text-2xl font-black font-mono">NGO</div><div class="text-[10px] font-bold opacity-50">Nagoya</div></div>
                        <div class="flex flex-col items-center px-4"><i class="fas fa-arrow-right text-[#726251] mb-1"></i><div class="text-[10px] font-bold bg-[#4a4238] text-white px-2 py-0.5 rounded">UO685</div></div>
                        <div class="text-center"><div class="text-2xl font-black font-mono">HKG</div><div class="text-[10px] font-bold opacity-50">Hong Kong</div></div>
                    </div>
                </div>
            </div>

            <div class="space-y-6">
                <div>
                    <div class="flex items-center gap-2 mb-2 text-white/80">
                        <span class="w-2 h-2 rounded-full bg-[#34a853] shadow-[0_0_10px_#34a853]"></span>
                        <h3 class="text-xs font-bold uppercase tracking-widest">ç¾åœ¨å°±è²· Online</h3>
                    </div>
                    <div class="space-y-2">
                        <div v-for="(item, i) in getTicketsByMethod('online')" :key="i" 
                             @click="openTicketDetail(item)"
                             class="ticket-stub p-4 rounded-r-xl flex justify-between items-center shadow-md bg-white border-l-4 border-[#34a853]">
                            <div class="flex flex-col">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-[10px] font-black uppercase opacity-60">{{ item.day }}</span>
                                    <span class="text-[10px] font-bold bg-black/5 px-1.5 rounded">{{ item.date }}</span>
                                </div>
                                <div class="font-black text-sm text-[#4a4238] leading-tight">{{ item.title }}</div>
                            </div>
                            <div class="text-right"><i class="fas fa-chevron-right text-xs opacity-30"></i></div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="flex items-center gap-2 mb-2 text-white/80">
                        <span class="w-2 h-2 rounded-full bg-[#fbbc04] shadow-[0_0_10px_#fbbc04]"></span>
                        <h3 class="text-xs font-bold uppercase tracking-widest">ç¾å ´è³¼è²· Onsite</h3>
                    </div>
                    <div class="space-y-2">
                        <div v-for="(item, i) in getTicketsByMethod('onsite')" :key="i" 
                             @click="openTicketDetail(item)"
                             class="ticket-stub p-4 rounded-r-xl flex justify-between items-center shadow-md bg-white border-l-4 border-[#fbbc04]">
                            <div class="flex flex-col">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-[10px] font-black uppercase opacity-60">{{ item.day }}</span>
                                    <span class="text-[10px] font-bold bg-black/5 px-1.5 rounded">{{ item.date }}</span>
                                </div>
                                <div class="font-black text-sm text-[#4a4238] leading-tight">{{ item.title }}</div>
                            </div>
                            <div class="text-right"><i class="fas fa-chevron-right text-xs opacity-30"></i></div>
                        </div>
                    </div>
                </div>

                <div>
                    <div class="flex items-center gap-2 mb-2 text-white/80">
                        <span class="w-2 h-2 rounded-full bg-[#9aa0a6] shadow-[0_0_10px_#9aa0a6]"></span>
                        <h3 class="text-xs font-bold uppercase tracking-widest">æ•¸ä½æ”¯ä»˜ Mobile</h3>
                    </div>
                    <div class="space-y-2">
                        <div v-for="(item, i) in getTicketsByMethod('mobile')" :key="i" 
                             @click="openTicketDetail(item)"
                             class="ticket-stub p-4 rounded-r-xl flex justify-between items-center shadow-md bg-white border-l-4 border-[#9aa0a6]">
                            <div class="flex flex-col">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-[10px] font-black uppercase opacity-60">{{ item.day }}</span>
                                    <span class="text-[10px] font-bold bg-black/5 px-1.5 rounded">{{ item.date }}</span>
                                </div>
                                <div class="font-black text-sm text-[#4a4238] leading-tight">{{ item.title }}</div>
                            </div>
                            <div class="text-right"><i class="fas fa-chevron-right text-xs opacity-30"></i></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="glass p-5 border-t-4 border-red-400 mb-20">
                <h3 class="font-bold text-sm mb-3 flex items-center"><i class="fas fa-clipboard-check mr-2"></i>æœ€çµ‚ç¢ºèªæ¸…å–®</h3>
                <div class="space-y-2">
                    <label class="flex items-center gap-3 p-2 bg-black/5 rounded-lg cursor-pointer">
                        <input type="checkbox" class="w-4 h-4 accent-[#726251]">
                        <span class="text-xs font-bold">å¯¦é«”ä¿¡ç”¨å¡ (Day 4 é ˜ç¥¨å¿…å‚™)</span>
                    </label>
                    <label class="flex items-center gap-3 p-2 bg-black/5 rounded-lg cursor-pointer">
                        <input type="checkbox" class="w-4 h-4 accent-[#726251]">
                        <span class="text-xs font-bold">JR èªè­‰ç¢¼ (PIN: <span class="font-black text-red-600">1226</span>)</span>
                    </label>
                    <label class="flex items-center gap-3 p-2 bg-black/5 rounded-lg cursor-pointer">
                        <input type="checkbox" class="w-4 h-4 accent-[#726251]">
                        <span class="text-xs font-bold">ç¾é‡‘ Â¥15,000 (Day 6 è²·ç¥¨)</span>
                    </label>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'packing'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">è¡Œææ¸…å–®</h2>
            <div v-for="(group, key) in packingList" :key="key" class="glass overflow-hidden">
                <div class="bg-[#726251]/10 px-5 py-3 flex items-center gap-3 border-b border-[#4a4238]/10">
                    <i class="fas" :class="key==='handCarry'?'fa-briefcase':key==='tszLok'?'fa-male text-[#91867f]':key==='tszTung'?'fa-female text-[#726251]':'fa-box'"></i>
                    <span class="font-bold text-sm uppercase tracking-wide">{{ keyLabels[key] }}</span>
                </div>
                <div class="p-2 grid gap-1">
                    <label v-for="(item, idx) in group" :key="idx" class="flex items-center p-3 hover:bg-[#726251]/5 rounded-xl cursor-pointer check-box transition-colors">
                        <input type="checkbox" v-model="item.checked" class="hidden">
                        <div class="w-5 h-5 rounded border-2 border-[#4a4238]/30 flex items-center justify-center mr-3 transition-colors bg-white/50"><i class="fas fa-check text-[#4a4238] text-[10px] opacity-0" :class="{'opacity-100': item.checked}"></i></div>
                        <span class="text-sm font-bold transition-opacity" :class="{'line-through opacity-40': item.checked}">{{ item.name }}</span>
                    </label>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'reminders'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">çœéŒ¢æ”»ç•¥ Tips</h2>
            
            <div class="glass overflow-hidden relative">
                <div class="bg-[#70808f] p-3 text-white flex justify-between items-center border-b border-white/20">
                    <span class="font-bold text-sm"><i class="fas fa-subway mr-2"></i>Day 3 äº¤é€š</span>
                    <span class="bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold">Â¥760 / 24hr</span>
                </div>
                <div class="p-5">
                    <h3 class="font-bold text-lg mb-2 text-[#4a4238]">åœ°éµ 24 å°æ™‚åˆ¸</h3>
                    <ul class="text-sm space-y-3 opacity-90 leading-relaxed list-disc pl-4 text-[#4a4238]">
                        <li><b class="text-[#726251]">å›æœ¬æ¥µå¿«ï¼š</b>è¡Œç¨‹ç¸½è»Šè³‡ç´„ Â¥1,000+ï¼Œä½¿ç”¨æ­¤åˆ¸<span class="font-bold border-b border-[#726251]">ç¾çœ Â¥300</span>ã€‚</li>
                        <li><b class="text-[#726251]">å½ˆæ€§æ¥µé«˜ï¼š</b>æ¡ã€Œ24å°æ™‚åˆ¶ã€ã€‚è‹¥ Day 3 æ—©ä¸Š 10:00 ç¬¬ä¸€æ¬¡åˆ·å¡ï¼Œå¯ç”¨åˆ° Day 4 æ—©ä¸Š 09:59ã€‚</li>
                    </ul>
                </div>
            </div>

            <div class="glass overflow-hidden relative">
                <div class="bg-[#91867f] p-3 text-white flex justify-between items-center border-b border-white/20">
                    <span class="font-bold text-sm"><i class="fas fa-snowflake mr-2"></i>Day 6 å‚™æ¡ˆ</span>
                    <span class="bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold">Weather Check</span>
                </div>
                <div class="p-5">
                    <h3 class="font-bold text-lg mb-2 text-[#4a4238]">æ–°ç©—é«˜çºœè»Šå¤©æ°£å‚™æ¡ˆ</h3>
                    <div class="bg-[#726251]/10 p-3 rounded-lg mb-3 text-sm font-bold border-l-4 border-[#726251] text-[#4a4238]">
                        å‡ºç™¼å‰å‹™å¿…çœ‹ Live Cameraï¼
                    </div>
                    <p class="text-sm opacity-90 leading-relaxed mb-2 text-[#4a4238]">
                        å¦‚æœå±±é ‚<b class="text-red-500">å¤§éœ§æˆ–èƒ½è¦‹åº¦ä½</b>ï¼Œ<span class="font-bold underline">ä¸è¦è²· Â¥6,300 çš„å¥—ç¥¨</span>ã€‚
                    </p>
                    <p class="text-sm opacity-90 leading-relaxed text-[#4a4238]">
                        <i class="fas fa-arrow-right mr-1 text-[#726251]"></i> æ›¿ä»£æ–¹æ¡ˆï¼šæ”¹åœ¨å¹³æ¹¯æº«æ³‰å€æ³¡æ¹¯ï¼ˆå–®ç´”æ³¡æ¹¯ç´„ Â¥600ï¼‰ï¼Œçœä¸‹æ˜‚è²´çºœè»Šè²»ã€‚
                    </p>
                </div>
            </div>

             <div class="glass overflow-hidden relative">
                <div class="bg-[#726251] p-3 text-white flex justify-between items-center border-b border-white/20">
                    <span class="font-bold text-sm"><i class="fas fa-ticket-alt mr-2"></i>Day 6 å¥—ç¥¨</span>
                    <span class="bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold">Save Â¥1,100</span>
                </div>
                <div class="p-5">
                    <h3 class="font-bold text-lg mb-2 text-[#4a4238]">å¥§é£›é©’ 2 æ—¥å¥—ç¥¨</h3>
                    <div class="bg-[#726251]/10 p-3 rounded-lg mb-3 text-xs font-bold border border-[#726251]/20 flex justify-between items-center text-[#4a4238]">
                        <span class="opacity-50 line-through">åˆ†é–‹è²· Â¥7,400</span>
                        <span class="text-[#726251] text-sm">å¥—ç¥¨ Â¥6,300</span>
                    </div>
                    <p class="text-sm opacity-90 leading-relaxed mb-2 font-bold text-[#4a4238]">å¤©æ°£å¥½æ™‚å¿…è²·ï¼åŒ…å«å·´å£«+çºœè»Šã€‚</p>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'info'" class="space-y-6 pt-4 h-full flex flex-col">
            <h2 class="text-2xl font-black font-mincho text-white">åŒ¯ç‡è¨ˆç®—æ©Ÿ</h2>
            
            <div class="glass flex-1 p-5 flex flex-col">
                <div class="bg-[#f3f0eb] rounded-xl p-4 mb-4 flex-1 flex flex-col justify-end items-end shadow-inner relative overflow-hidden">
                    <div class="text-[#4a4238]/40 font-bold font-mono text-sm mb-1 break-all text-right">{{ calcExpression || '0' }}</div>
                    <div class="text-[#4a4238] font-black font-mono text-4xl mb-1 break-all text-right">Â¥{{ displayValue }}</div>
                    <div class="w-full h-[1px] bg-[#4a4238]/10 my-2"></div>
                    <div class="text-[#726251] font-bold font-mono text-2xl flex items-center justify-end w-full">
                        <span class="text-xs mr-2 opacity-50">HKD</span> ${{ (parseFloat(displayValue.replace(/,/g,'')) * currencyRate).toFixed(1) }}
                    </div>
                    
                    <div class="absolute top-2 left-2 flex items-center gap-1 opacity-40 hover:opacity-100 transition-opacity">
                        <span class="text-[9px] font-bold">Rate:</span>
                        <input type="number" v-model="currencyRate" class="w-12 bg-transparent border-b border-[#4a4238]/30 text-[10px] font-mono text-right outline-none">
                    </div>
                </div>

                <div class="calc-grid">
                    <button @click="clearCalc" class="calc-btn op">C</button>
                    <button @click="appendCalc('(')" class="calc-btn op">(</button>
                    <button @click="appendCalc(')')" class="calc-btn op">)</button>
                    <button @click="appendCalc('/')" class="calc-btn op">Ã·</button>
                    
                    <button @click="appendCalc('7')" class="calc-btn">7</button>
                    <button @click="appendCalc('8')" class="calc-btn">8</button>
                    <button @click="appendCalc('9')" class="calc-btn">9</button>
                    <button @click="appendCalc('*')" class="calc-btn op">Ã—</button>
                    
                    <button @click="appendCalc('4')" class="calc-btn">4</button>
                    <button @click="appendCalc('5')" class="calc-btn">5</button>
                    <button @click="appendCalc('6')" class="calc-btn">6</button>
                    <button @click="appendCalc('-')" class="calc-btn op">-</button>
                    
                    <button @click="appendCalc('1')" class="calc-btn">1</button>
                    <button @click="appendCalc('2')" class="calc-btn">2</button>
                    <button @click="appendCalc('3')" class="calc-btn">3</button>
                    <button @click="appendCalc('+')" class="calc-btn op">+</button>
                    
                    <button @click="backspace" class="calc-btn op"><i class="fas fa-backspace text-sm"></i></button>
                    <button @click="appendCalc('0')" class="calc-btn">0</button>
                    <button @click="appendCalc('.')" class="calc-btn">.</button>
                    <button @click="calculate" class="calc-btn eq">=</button>
                </div>
            </div>
            
            <div class="glass p-5 text-center shrink-0">
                <div class="text-[10px] font-bold opacity-60 uppercase tracking-widest mb-1">è·é›¢å‡ºç™¼ (HKO)</div>
                <div class="text-xl font-black font-mono">{{ countdown.days }} Days {{ countdown.hours }}h</div>
            </div>
        </div>

    </main>

    <nav v-show="!isModalOpen" class="fixed bottom-0 w-full h-[85px] bg-[#70808f]/95 backdrop-blur-xl border-t border-[#c5b59d]/20 z-50 flex justify-around items-center px-2 pb-safe-bottom">
        <button v-for="tab in tabs" :key="tab.id" @click="currentView = tab.id" class="flex flex-col items-center justify-center w-12 h-full space-y-1 transition-all cursor-pointer active:scale-95" :class="currentView === tab.id ? 'text-[#c5b59d] scale-110' : 'text-white/40'">
            <i :class="tab.icon" class="text-xl"></i>
            <span class="text-[9px] font-bold uppercase tracking-widest">{{ tab.label }}</span>
        </button>
    </nav>

    <div v-if="showBudgetInput" class="modal-layer flex items-end justify-center">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="showBudgetInput=false"></div>
        <div class="bg-[#c5b59d] w-full max-w-md h-[90vh] rounded-t-3xl animate-slide-up flex flex-col text-[#4a4238] modal-content" @click.stop>
            <div class="p-6 font-bold text-lg border-b border-[#4a4238]/10">Add Expense</div>
            <div class="flex-1 overflow-y-auto p-6 pb-40"> 
                <div class="flex gap-3 mb-6">
                    <button v-for="p in payers" :key="p" @click="newItem.payer=p" class="flex-1 py-4 rounded-xl border font-bold text-sm transition-colors" :class="newItem.payer===p?(p==='TszLok'?'bg-[#91867f] text-white border-transparent':'bg-[#726251] text-white border-transparent'):'border-[#4a4238]/30 text-[#4a4238]/60'">{{ p }}</button>
                </div>
                <div class="space-y-6">
                    <div>
                        <label class="block text-xs font-bold opacity-60 mb-2">Item Name</label>
                        <input v-model="newItem.name" class="w-full bg-white p-5 rounded-2xl font-bold border-2 border-transparent text-[#4a4238] placeholder-[#4a4238]/30 focus:border-[#726251] outline-none text-lg">
                    </div>
                    <div>
                        <label class="block text-xs font-bold opacity-60 mb-2">Price (Â¥)</label>
                        <input v-model.number="newItem.price" type="number" class="w-full bg-white p-5 rounded-2xl font-bold border-2 border-transparent text-[#4a4238] placeholder-[#4a4238]/30 focus:border-[#726251] outline-none text-lg">
                    </div>
                </div>
                <div class="flex gap-3 mt-10">
                    <button @click="showBudgetInput=false" class="flex-1 py-4 font-bold text-[#4a4238]/50 bg-black/5 rounded-2xl">Cancel</button>
                    <button @click="addItem" class="flex-1 py-4 bg-[#70808f] text-white rounded-2xl font-bold shadow-lg text-lg">Save</button>
                </div>
            </div>
        </div>
    </div>
    
    <div v-if="showWishlistInput" class="modal-layer flex items-end justify-center">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="showWishlistInput=false"></div>
        <div class="bg-[#c5b59d] w-full max-w-md h-[90vh] rounded-t-3xl animate-slide-up flex flex-col text-[#4a4238] modal-content" @click.stop>
            <div class="p-6 font-bold text-lg border-b border-[#4a4238]/10">Add to Wishlist</div>
            
            <div class="flex-1 overflow-y-auto p-6 pb-40"> 
                <div class="mb-6 relative group w-full">
                    <div v-if="!newWishItem.image" class="w-full h-56 bg-white/50 border-2 border-dashed border-[#4a4238]/30 rounded-2xl flex flex-col items-center justify-center text-[#4a4238]/40 relative hover:bg-white/70 transition-colors">
                        <i class="fas fa-camera text-4xl mb-2"></i><span class="text-sm font-bold">Upload Photo</span>
                        <input type="file" accept="image/*" @change="handleImageUpload" class="absolute inset-0 w-full h-full opacity-0 z-20 cursor-pointer">
                    </div>
                    <div v-else class="relative w-full">
                        <img :src="newWishItem.image" class="w-full max-h-72 object-contain rounded-2xl bg-black/10">
                        <div class="flex gap-3 mt-3">
                            <label class="flex-1 py-3 bg-white/50 rounded-xl text-sm font-bold text-center cursor-pointer hover:bg-white/80 text-[#4a4238] transition-colors">Change<input type="file" accept="image/*" @change="handleImageUpload" class="hidden"></label>
                            <button @click="newWishItem.image = null" class="flex-1 py-3 bg-red-100 text-red-500 rounded-xl text-sm font-bold hover:bg-red-200 transition-colors">Remove</button>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-6">
                    <div>
                        <label class="block text-xs font-bold opacity-60 mb-2">Product Name</label>
                        <input v-model="newWishItem.name" class="w-full bg-white p-5 rounded-2xl font-bold border-2 border-transparent text-[#4a4238] outline-none focus:border-[#726251] text-lg">
                    </div>
                    <div>
                        <label class="block text-xs font-bold opacity-60 mb-2">Price (Â¥)</label>
                        <input v-model.number="newWishItem.price" type="number" class="w-full bg-white p-5 rounded-2xl font-bold border-2 border-transparent text-[#4a4238] outline-none focus:border-[#726251] text-lg">
                    </div>
                </div>

                <div class="flex gap-3 mt-10">
                    <button @click="showWishlistInput=false" class="flex-1 py-4 font-bold text-[#4a4238]/50 bg-black/5 rounded-2xl">Cancel</button>
                    <button @click="addWishlist" class="flex-1 py-4 bg-[#70808f] text-white rounded-2xl font-bold shadow-lg text-lg">Add Item</button>
                </div>
            </div>
        </div>
    </div>

    <div v-if="detailModal.show" class="modal-layer flex items-end justify-center"><div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="detailModal.show=false"></div>
        <div class="bg-[#c5b59d] w-full max-w-md rounded-t-3xl p-6 relative animate-slide-up max-h-[85vh] overflow-y-auto text-[#4a4238] modal-content" @click.stop>
            <div class="w-12 h-1 bg-[#4a4238]/20 rounded-full mx-auto mb-6"></div>
            
            <div v-if="detailModal.data.isTicket">
                <span class="px-3 py-1 rounded-lg text-xs font-bold uppercase" :class="getMethodBadge(detailModal.data.method)">{{ getMethodLabel(detailModal.data.method) }}</span>
                <h2 class="text-2xl font-black mt-3 mb-2 font-mincho">{{ detailModal.data.title }}</h2>
                
                <div class="bg-white/40 p-4 rounded-xl mb-4 shadow-sm">
                    <div class="text-[10px] font-bold opacity-50 uppercase tracking-widest mb-1">è³¼ç¥¨åœ°é» / ç¶²å€</div>
                    <div class="font-bold mb-3">{{ detailModal.data.location }}</div>
                    
                    <a v-if="detailModal.data.method === 'online' && detailModal.data.url" 
                       :href="detailModal.data.url" target="_blank"
                       class="block w-full py-3 bg-[#34a853] text-white text-center rounded-xl font-bold shadow-md active:scale-95 transition-transform">
                       <i class="fas fa-external-link-alt mr-2"></i>å‰å¾€é ç´„ç¶²ç«™
                    </a>
                </div>

                <div class="space-y-4">
                    <div v-if="detailModal.data.guide.steps">
                         <h4 class="text-xs font-bold opacity-60 uppercase tracking-widest mb-2">æ“ä½œæ­¥é©Ÿ</h4>
                         <ul class="list-decimal pl-5 space-y-2 text-sm font-bold opacity-90">
                             <li v-for="step in detailModal.data.guide.steps">{{ step }}</li>
                         </ul>
                    </div>
                    
                    <div v-if="detailModal.data.guide.reminder" class="bg-red-400/10 p-4 rounded-xl border-l-4 border-red-500 text-sm font-bold text-red-900">
                        <i class="fas fa-exclamation-triangle mr-2"></i>{{ detailModal.data.guide.reminder }}
                    </div>
                </div>
            </div>

            <div v-else>
                <span class="px-3 py-1 bg-[#70808f] text-white rounded-lg text-xs font-bold uppercase">{{ detailModal.data.typeLabel }}</span>
                <h2 class="text-2xl font-black mt-3 mb-2 font-mincho">{{ detailModal.data.name }}</h2>
                <div class="text-sm font-bold opacity-60 mb-6 flex items-center"><i class="far fa-clock mr-2"></i> {{ detailModal.data.time }}</div>
                <div class="space-y-6 text-sm leading-relaxed">
                    <div v-if="detailModal.data.desc"><h4 class="text-xs font-bold opacity-50 uppercase tracking-widest mb-2">Description</h4><p class="font-bold whitespace-pre-line">{{ detailModal.data.desc }}</p></div>
                    <div v-if="detailModal.data.strategy" class="bg-[#726251]/10 p-5 rounded-2xl border-l-4 border-[#726251]"><h4 class="text-xs font-bold uppercase tracking-widest mb-3 flex items-center"><i class="fas fa-chess-knight mr-2"></i>æ”»ç•¥ Strategy</h4><div class="font-bold whitespace-pre-line">{{ detailModal.data.strategy }}</div></div>
                </div>
                <div class="mt-6 space-y-3">
                    <a v-if="detailModal.data.ticketLink" :href="detailModal.data.ticketLink" target="_blank" class="block w-full py-4 bg-[#726251] text-white text-center rounded-2xl font-bold shadow-lg">View Ticket</a>
                    <a v-if="detailModal.data.hotelLink" :href="detailModal.data.hotelLink" target="_blank" class="block w-full py-4 bg-[#91867f] text-white text-center rounded-2xl font-bold shadow-lg">View Hotel Booking</a>
                </div>
                <div class="h-6"></div>
                <button @click="openMap(detailModal.data.name)" class="w-full py-4 bg-white text-[#4a4238] rounded-2xl font-bold shadow-lg">Open Map</button>
            </div>

        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            const currentView = ref('itinerary'); 
            const dayIndex = ref(0);
            const detailModal = ref({ show: false, data: {} });
            const walletMode = ref('expense');
            const budgetFilter = ref('All'); 
            const showBudgetInput = ref(false);
            const showWishlistInput = ref(false);
            const payers = ['TszLok', 'TszTung'];
            const newItem = ref({ name: '', price: '', payer: 'TszLok' });
            const newWishItem = ref({ name: '', price: '', image: null });
            const budgetList = ref([]);
            const wishlist = ref([]);
            
            // Calculator State
            const currencyRate = ref(0.052);
            const calcExpression = ref('');
            const calcResult = ref('0');

            // Computed: Check if any modal is open
            const isModalOpen = computed(() => showBudgetInput.value || showWishlistInput.value || detailModal.value.show);

            const weatherDB = [
                { date: "2/25", hourly: [{time:"14:00",temp:"8Â°",icon:"fas fa-cloud-sun"},{time:"16:00",temp:"7Â°",icon:"fas fa-cloud"},{time:"18:00",temp:"6Â°",icon:"fas fa-moon"},{time:"20:00",temp:"5Â°",icon:"fas fa-moon"}] },
                { date: "2/26", hourly: [{time:"09:00",temp:"7Â°",icon:"fas fa-sun"},{time:"12:00",temp:"11Â°",icon:"fas fa-sun"},{time:"15:00",temp:"10Â°",icon:"fas fa-cloud-sun"},{time:"18:00",temp:"7Â°",icon:"fas fa-moon"}] },
                { date: "2/27", hourly: [{time:"10:00",temp:"9Â°",icon:"fas fa-cloud"},{time:"13:00",temp:"12Â°",icon:"fas fa-cloud-sun"},{time:"16:00",temp:"10Â°",icon:"fas fa-cloud"},{time:"19:00",temp:"8Â°",icon:"fas fa-cloud-rain"}] },
                { date: "2/28", hourly: [{time:"09:00",temp:"2Â°",icon:"fas fa-snowflake"},{time:"12:00",temp:"3Â°",icon:"fas fa-snowflake"},{time:"15:00",temp:"1Â°",icon:"fas fa-snowflake"},{time:"18:00",temp:"-1Â°",icon:"fas fa-snowflake"}] },
                { date: "3/1", hourly: [{time:"09:00",temp:"-2Â°",icon:"fas fa-snowflake"},{time:"12:00",temp:"0Â°",icon:"fas fa-snowflake"},{time:"15:00",temp:"-1Â°",icon:"fas fa-cloud-meatball"},{time:"18:00",temp:"-4Â°",icon:"fas fa-snowflake"}] },
                { date: "3/2", hourly: [{time:"09:00",temp:"-5Â°",icon:"fas fa-snowflake"},{time:"12:00",temp:"-2Â°",icon:"fas fa-sun"},{time:"15:00",temp:"-3Â°",icon:"fas fa-cloud-sun"},{time:"18:00",temp:"-6Â°",icon:"fas fa-moon"}] },
                { date: "3/3", hourly: [{time:"08:00",temp:"4Â°",icon:"fas fa-cloud-sun"},{time:"12:00",temp:"9Â°",icon:"fas fa-sun"},{time:"16:00",temp:"8Â°",icon:"fas fa-cloud-sun"},{time:"20:00",temp:"6Â°",icon:"fas fa-moon"}] }
            ];
            const currentDayWeather = computed(() => weatherDB[dayIndex.value]?.hourly || []);

            const packingList = ref({
                handCarry: [{name: 'å€‹äººè­‰ä»¶ (èº«åˆ†è­‰/è­·ç…§/ç°½è­‰)', checked: false}, {name: 'ç™»æ©Ÿè­‰', checked: false}, {name: 'éŠ€åŒ…', checked: false}, {name: 'SIMå¡', checked: false}, {name: 'æ‰‹æ©Ÿ & å……é›»', checked: false}, {name: 'é ç´„è­‰æ˜', checked: false}, {name: 'å£ç½©/æ¶ˆæ¯’', checked: false}],
                tszLok: [{name: 'å¤–å‡ºè¡£ç‰©', checked: false}, {name: 'ç¡è¡£è¤²', checked: false}, {name: 'å…§è¡£è¤² & è¥ª', checked: false}, {name: 'å¤–å¥—', checked: false}, {name: 'ç”·å£«å‰ƒé¬š', checked: false}, {name: 'è½‰æ’ & æ‹–æ¿', checked: false}, {name: 'é›¨å‚˜/é›¨è¡£', checked: false}, {name: 'æ‹–é‹', checked: false}, {name: 'å‚™ç”¨è† è¢‹', checked: false}],
                tszTung: [{name: 'å¤–å‡ºè¡£ç‰©', checked: false}, {name: 'ç¡è¡£è¤²', checked: false}, {name: 'å…§è¡£è¤² & è¥ª', checked: false}, {name: 'å¤–å¥—', checked: false}, {name: 'åŒ–å¦å“', checked: false}, {name: 'è­·è†šå“', checked: false}, {name: 'æ´—é¢/æ´—é«®', checked: false}, {name: 'é ­é«®å®šå‹', checked: false}, {name: 'æ¢³ & é¢¨ç­’', checked: false}, {name: 'éš±å½¢çœ¼é¡', checked: false}, {name: 'å¥³æ€§è­·ç†', checked: false}, {name: 'æ¯›å·¾', checked: false}, {name: 'å…¬ä»”', checked: false}, {name: 'ç†±æ°´ç…²', checked: false}]
            });
            const keyLabels = { handCarry: 'Hand Carry', tszLok: 'TszLok (Boy)', tszTung: 'TszTung (Girl)' };

            // ENRICHED TICKET DATA (Method: online, onsite, mobile)
            const ticketList = ref([
                { 
                    date: "2/25 & 3/3", day: "Day 1, 7", title: "åéµ Î¼-Sky (å¾€è¿”æ©Ÿå ´)", route: "æ©Ÿå ´ â†” åå¤å±‹", price: "Â¥1,430", method: "onsite", location: "æ©Ÿå ´/åéµè»Šç«™ å”®ç¥¨æ©Ÿ",
                    guide: {
                        steps: ["å»å”®ç¥¨æ©Ÿé¸ 'Nagoya' æˆ– 'Central Japan Int'l Airport'ã€‚", "é™¤äº†åŸºæœ¬é‹è²» (Â¥980)ï¼Œå‹™å¿…åŠ è³¼ 'Î¼-ticket' (Â¥450) æ‰æœ‰æŒ‡å®šåº§ä½ã€‚", "ä»˜æ¬¾ï¼šç¾é‡‘æˆ–ä¿¡ç”¨å¡ã€‚"],
                        reminder: "ä¸€å®šè¦æ‹¿å…©å¼µç¥¨ï¼ˆä¹˜è»Šåˆ¸+åº§ä½åˆ¸ï¼‰æ‰èƒ½é€²ç«™ï¼"
                    }
                },
                { 
                    date: "2/26", day: "Day 2", title: "å‰åœåŠ›äº¤é€š (Linimo)", route: "å¸‚å€ â†” å‰åœåŠ›å…¬åœ’", price: "ç´„ Â¥1,340", method: "mobile", location: "Apple Wallet",
                    guide: {
                        steps: ["iPhone æ‰“é–‹ Apple Walletã€‚", "æ–°å¢äº¤é€šå¡ (Suica æˆ– ICOCA)ã€‚", "ç”¨ Apple Pay åŠ å€¼ç´„ Â¥3,000ã€‚", "é€²å‡ºç«™æ™‚æ‰‹æ©Ÿç›´æ¥æ„Ÿæ‡‰é–˜é–€ã€‚"],
                        reminder: "ç¢ºèªæ‰‹æ©Ÿæœ‰é›»ï¼"
                    }
                },
                { 
                    date: "2/27", day: "Day 3", title: "åœ°éµ 24 å°æ™‚åˆ¸", route: "å¸‚å€è§€å…‰", price: "Â¥760", method: "onsite", location: "åœ°éµç«™ é»ƒè‰²å”®ç¥¨æ©Ÿ",
                    guide: {
                        steps: ["æ‰¾é»ƒè‰²å”®ç¥¨æ©Ÿã€‚", "é»é¸è¢å¹• 'ãŠå¾—ãªãƒã‚±ãƒƒãƒˆ (Value Tickets)'ã€‚", "å¹³æ—¥é¸ '24-hour Pass' (Â¥760)ã€‚", "é€±æœ«é¸ 'Donichi Eco Ticket' (Â¥620)ã€‚"],
                        reminder: "ç¬¬ä¸€æ¬¡é€²ç«™æœƒå°ä¸Šæ™‚é–“ï¼Œå¯ä½¿ç”¨è‡³éš”å¤©åŒæ™‚é–“ã€‚"
                    }
                },
                { 
                    date: "2/28 & 3/3", day: "Day 4, 7", title: "JR ç‰¹æ€¥ Hida è™Ÿ", route: "åå¤å±‹ â†” é«˜å±±", price: "Â¥6,140", method: "online", location: "JR è¥¿æ—¥æœ¬é ç´„å®˜ç¶²", url: "https://www.westjr.co.jp/global/tc/ticket/",
                    guide: {
                        steps: ["é€²å…¥å®˜ç¶²ï¼Œæœå°‹ 'Nagoya' åˆ° 'Takayama'ã€‚", "é–å®š 09:39 ç™¼è»Šçš„ Hida 5 è™Ÿã€‚", "é¸ä½ï¼šå»ç¨‹ D å´ï¼Œå›ç¨‹ A å´ã€‚", "ä»˜æ¬¾ï¼šå¿…é ˆä½¿ç”¨ã€å¯¦é«”ä¿¡ç”¨å¡ã€ã€‚"],
                        reminder: "2/28 ç•¶å¤©è«‹å¸¶é€™å¼µã€å¯¦é«”ä¿¡ç”¨å¡ã€å»ç¶ è‰²æ©Ÿå™¨é ˜ç¥¨ï¼ä¸å¯ç”¨ Apple Payã€‚"
                    }
                },
                { 
                    date: "3/1", day: "Day 5", title: "æ¿ƒé£›å·´å£« (ç™½å·é„‰)", route: "é«˜å±± â†” ç™½å·é„‰", price: "Â¥5,200", method: "online", location: "Japan Bus Online", url: "https://japanbusonline.com/zh-tw",
                    guide: {
                        steps: ["é€²å…¥ç¶²ç«™ Japan Bus Onlineã€‚", "é ç´„ 08:50 å‰çš„ç­æ¬¡ã€‚", "ç·šä¸Šåˆ·å¡ä»˜æ¬¾ã€‚", "æ”¶åˆ° E-ticket Emailã€‚"],
                        reminder: "ä¸ç”¨é ˜å¯¦é«”ç¥¨ï¼Œä¸Šè»Šå‡ºç¤ºæ‰‹æ©Ÿ QR Code å³å¯ã€‚"
                    }
                },
                { 
                    date: "3/2", day: "Day 6", title: "å¥§é£›é©’ 2 æ—¥å¥—ç¥¨", route: "å·´å£«+çºœè»Š", price: "Â¥6,300", method: "onsite", location: "é«˜å±±æ¿ƒé£›å·´å£«ä¸­å¿ƒ",
                    guide: {
                        steps: ["å» JR é«˜å±±ç«™æ—çš„å·´å£«ä¸­å¿ƒæ«ƒæª¯ã€‚", "èªª 'Okuhida Value Ticket, 2 Days'ã€‚", "å»ºè­°æº–å‚™ç¾é‡‘ä»˜æ¬¾ã€‚"],
                        reminder: "é€™æœ¬ç¥¨åŒ…å«ä¾†å›å·´å£«å’Œæ–°ç©—é«˜çºœè»Šåˆ¸ï¼Œå¼„ä¸Ÿä¸è£œç™¼ã€‚"
                    }
                }
            ]);

            const getTicketsByMethod = (m) => ticketList.value.filter(t => t.method === m);

            const itinerary = ref([
                { day: 1, date_short: "2/25", date_en: "Wed", location: "Nagoya", places: [
                    { time: "14:30", name: "ä¸­éƒ¨åœ‹éš›æ©Ÿå ´", type: "transport", typeLabel: "æŠµé”", desc: "NGO æŠµé”ã€‚è³¼è²· Î¼-Skyã€‚", bookingType: "flight", flightNo: "UO680", terminal: "T2 æŠµé”", highlights: ["ç¶ èŒ¶"], strategy: "å‡ºé—œå¾Œè·Ÿè‘—ã€Œåéµé›»è»Šã€æŒ‡æ¨™èµ°ã€‚\nå»è‡ªå‹•å”®ç¥¨æ©Ÿæˆ–æ«ƒæª¯è³¼ç¥¨ã€‚\nè²·ä¸€ç“¶ç¶ èŒ¶ (ä¼Šå³è¡›é–€)ã€‚" },
                    { time: "15:30", name: "å‰å¾€å¸‚å€", type: "transport", typeLabel: "ç§»å‹•", desc: "åéµâ†’åå¤å±‹ç«™â†’æ«»é€šç·šâ†’ä¹…å±‹å¤§é€šã€‚", highlights: ["æ«»é€šç·š"], strategy: "æŠµé”åå¤å±‹ç«™å¾Œï¼Œä¸è¦å‡ºç«™åˆ°åœ°é¢ï¼Œç›´æ¥æ‰¾ã€Œæ«»é€šç·š (ç´…ç·š)ã€åœ°éµæŒ‡æ¨™ã€‚\nå¾€ã€Œå¾·é‡ã€æ–¹å‘ï¼Œä¸‹è»Šç«™ï¼šä¹…å±‹å¤§é€šã€‚" },
                    { time: "16:30", name: "è¥¿éµé…’åº— Croom", type: "stay", typeLabel: "Check-in", desc: "ä¹…å±‹å¤§é€šç«™ 4B å‡ºå£ã€‚", bookingType: "hotel", hotelLink: "https://hk.trip.com/hotels/ctorderdetail?orderid=1359041951884810", highlights: ["å¤§æµ´å ´"], strategy: "èµ° 4B æˆ– 1A å‡ºå£ï¼ˆæœ‰é›»æ‰¶æ¢¯ï¼‰ã€‚\nC/I å¾Œå…ˆå»å¤§æµ´å ´æ´—æ¾¡æˆ–åœ¨æˆ¿é–“ä¼‘æ¯ã€‚\né£¯åº—å°é¢æœ‰ 7-11ã€‚" },
                    { time: "18:00", name: "Indo Ryori Kalash", type: "food", typeLabel: "æ™šé¤", desc: "å°¼æ³Šçˆ¾å’–å“©ã€‚èµ·å¸çƒ¤é¤…ä»½é‡å·¨å¤§ã€‚", highlights: ["Cheese Naan"], strategy: "é€™æ˜¯å°¼æ³Šçˆ¾äººé–‹çš„åº—ã€‚\nå¿…é»ï¼šCheese Naan (èµ·å¸çƒ¤é¤…)ã€Butter Chicken Curryã€Mango Lassiã€‚\nå…©äººé»ä¸€ä»½çƒ¤é¤…åˆ†é£Ÿå³å¯ã€‚" },
                    { time: "20:00", name: "Oasis 21", type: "spot", typeLabel: "å¤œæ™¯", desc: "æ°´ä¹‹å®‡å®™èˆ¹ã€‚", highlights: ["é›»è¦–å¡”å€’å½±"], strategy: "æ­é›»æ¢¯ä¸Šé ‚å±¤ç»ç’ƒåœ°é¢ã€‚\nèµ°åˆ°æ°´æ± æ­£ä¸­å¤®ï¼Œæ‹æ”é›»è¦–å¡”å€’å½±ã€‚" },
                    { time: "21:00", name: "ä¾¿åˆ©å•†åº—", type: "spot", typeLabel: "æ¡è²·", desc: "7-11 è²·å®µå¤œã€‚", highlights: ["ç„¦ç³–å†°æ·‡æ·‹"], strategy: "è²·å®µå¤œå’Œæ˜å¤©çš„æ°´ã€‚\nOhayo ç„¦ç³–çƒ¤å¸ƒè•¾å†°æ·‡æ·‹ (æ•²ç¢è¡¨é¢ç„¦ç³–åƒ)ã€‚" }
                ]},
                { day: 2, date_short: "2/26", date_en: "Thu", location: "Nagoya", places: [
                    { time: "09:00", name: "Konparu æ¦®åº—", type: "food", typeLabel: "æ—©é¤", desc: "å¤–å¸¶ç‚¸è¦ä¸‰æ˜æ²»å»å‰åœåŠ›é‡é¤ã€‚", highlights: ["ç‚¸è¦ä¸‰æ˜æ²»"], strategy: "é—œéµç­–ç•¥ï¼šè·Ÿåº—å“¡èªª 'Take out, please'ã€‚\nå¸¶å»å‰åœåŠ›ç•¶åˆé¤ï¼Œçœä¸‹åœ’å€æ’éšŠæ™‚é–“ã€‚\nä¸è¦åˆ‡é‚Šï¼" },
                    { time: "10:30", name: "å‰å¾€å‰åœåŠ›", type: "transport", typeLabel: "ç§»å‹•", desc: "æ¦®â†’è—¤ä¹‹ä¸˜â†’Linimoã€‚", highlights: ["Linimo"], strategy: "åœ¨ã€Œæ¦®ç«™ã€æ­æ±å±±ç·šåˆ°çµ‚é»ã€Œè—¤ä¹‹ä¸˜ã€ï¼Œè½‰ Linimo ç£æµ®åˆ—è»Šã€‚\nè²· 7-11 æœæ˜” (Smoothie)ã€‚" },
                    { time: "12:00", name: "å‰åœåŠ›å¤§å€‰åº«", type: "spot", typeLabel: "é‡é»", desc: "12:00 å…¥å ´ã€‚", bookingType: "ticket", ticketLink: "https://quickticket.moala.fun/books?id=d1315e41-24de-40a9-a20a-0cf36d07ec8f", highlights: ["åå ´é¢å±•"], strategy: "å‹•ç·šï¼š1.åå ´é¢å±•(æ‹ç…§) â†’ 2.çµæˆ¶åº§é›»å½±é™¢ â†’ 3.åƒä¸‰æ˜æ²» â†’ 4.å•†åº—ã€‚\nå•†åº—è²·ï¼šæ¹¯å©†å©†æˆ’æŒ‡ã€ç„¡è‡‰ç”·å‘¨é‚Šã€‚\nâš ï¸ TszLok è«‹å‹™å¿…å¸¶è­·ç…§ï¼" },
                    { time: "17:00", name: "æ¦®å€è³¼ç‰©", type: "spot", typeLabel: "è³¼ç‰©", desc: "Kapital, Montbell, BEAMS, Salomon.", highlights: ["Salomon", "éª¨é ­T", "ç¾½çµ¨"], strategy: "ADDED: Salomon (CREARE) - å¿…é€›ï¼\nKapital (CREARE 1F): æ‰¾éª¨é ­T/æ‹¼å¸ƒç‰›ä»”ã€‚\nMontbell (Nadia Park 6F): è²·ç¾½çµ¨è¡£ã€‚\nOnitsuka Tiger (PARCO è¥¿é¤¨ 1F)ã€‚" },
                    { time: "19:30", name: "ç†±ç”°è“¬èŠè»’", type: "food", typeLabel: "æ™šé¤", desc: "æ¾å‚å±‹å—é¤¨ 10Fã€‚", booking: "#8823", highlights: ["é°»é­šé£¯ä¸‰åƒ"], strategy: "17:30 å…ˆå»æŠ½è™Ÿç¢¼ç‰Œã€‚\nå¿…åƒï¼šé°»é­šé£¯ä¸‰åƒ (Hitsumabushi)ã€‚\nè©¦è©¦åŠ é«˜æ¹¯çš„èŒ¶æ³¡é£¯ã€‚" },
                    { time: "21:00", name: "HARBS æœ¬åº—", type: "food", typeLabel: "ç”œé»", desc: "é›»è¦–å¡”æ—ã€‚", highlights: ["æ°´æœåƒå±¤"], strategy: "å°±åœ¨é›»è¦–å¡”æ—ã€‚\nå¦‚æœæœ‰ä½å­å°±å…§ç”¨ï¼Œæ²’ä½å­å°±å¤–å¸¶ (Takeout) å›é£¯åº—ã€‚" }
                ]},
                { day: 3, date_short: "2/27", date_en: "Fri", location: "Nagoya", places: [
                    { time: "09:00", name: "Komeda's Coffee", type: "food", typeLabel: "æ—©é¤", desc: "é»é£²æ–™é€ç´…è±†æ³¥åå¸ã€‚", highlights: ["ç´…è±†åå¸"], strategy: "æ”»ç•¥ï¼šæ¯æ—¥11:00å‰ï¼Œé»é£²æ–™(ç´„Â¥500)å³é€åå¸+æ°´ç…®è›‹/ç´…è±†æ³¥ã€‚\næ¯äººå¯çœä¸‹ç´„Â¥800æ—©é¤è²»ï¼\nå»ºè­°åŠ é» Mini Shiro-Noirã€‚" },
                    { time: "10:00", name: "åå¤å±‹æ¸¯æ°´æ—é¤¨", type: "spot", typeLabel: "æ™¯é»", desc: "åŒ—é¤¨çœ‹è™é¯¨ã€‚", highlights: ["è™é¯¨", "æµ·è±šç§€"], strategy: "ç›´å¥”åŒ—é¤¨ 3F çœ‹è™é¯¨ã€‚\næŸ¥å¥½æµ·è±šç§€æ™‚é–“ï¼Œæƒ³æ¿•èº«åå‰4æ’ã€‚\nå—é¤¨çœ‹æ²™ä¸é­šé¢¨æš´ã€‚" },
                    { time: "13:30", name: "çŸ¢å ´ç‚¸è±¬æ’", type: "food", typeLabel: "åˆé¤", desc: "å¤§é ˆåº—ã€‚éµæ¿å‘³å™Œè±¬æ’ã€‚", highlights: ["éµæ¿"], strategy: "å‹™å¿…é»ã€Œéµæ¿ã€ç³»åˆ—ã€‚\nä¸€å®šè¦ç©¿ç´™åœå…œï¼Œé†¬æ±æœƒå™´ã€‚\næ¡Œä¸ŠèŠéº»ç²‰éš¨æ„åŠ ã€‚" },
                    { time: "15:00", name: "å¤§é ˆå•†åº—è¡—", type: "spot", typeLabel: "é€›è¡—", desc: "Alice on Wednesday, ä¸‰è¼ªç¥ç¤¾ã€‚", highlights: ["ä¸‰è¼ªç¥ç¤¾"], strategy: "Alice on Wednesday: é‘½å°é–€é€²å»ã€‚\nä¸‰è¼ªç¥ç¤¾: æ‘¸å…”å­çŸ³åƒæ±‚å¥½é‹ã€‚\nSeria (ç™¾å…ƒåº—)ã€Kannon Coffeeã€‚" },
                    { time: "17:00", name: "Muji åéµç™¾è²¨", type: "spot", typeLabel: "è³¼ç‰©", desc: "ä¸­éƒ¨æœ€å¤§æ——è‰¦åº—ã€‚", highlights: ["å’–å“©åŒ…"], strategy: "å» 'Muji Food' å€è²·èª¿ç†åŒ…ã€‚\nå’–å“©åŒ…ã€å¹´è¼ªè›‹ç³•ã€ä¹¾ç‡¥è‰è“å·§å…‹åŠ›ã€‚" },
                    { time: "18:30", name: "Tsubame Bread", type: "food", typeLabel: "é»å¿ƒ", desc: "åç«™é™„è¿‘ã€‚", highlights: ["çµ¹é¦™åå¸"], strategy: "å¤–å¸¶ä¸€æ¢ã€Œçµ¹é¦™åå¸ã€(Kinuka) ç•¶æ˜å¤©å»é«˜å±±çš„æ—©é¤ã€‚\nç¾å ´åƒåŒ—æµ·é“ç‰›å¥¶éœœæ·‡æ·‹ã€‚" },
                    { time: "19:30", name: "é³¥é–‹ç¸½æœ¬å®¶", type: "food", typeLabel: "æ™šé¤", desc: "JR Gate Tower / ESCAã€‚", highlights: ["è¦ªå­ä¸¼"], strategy: "ä½æ–¼ JR Gate Tower æˆ– ESCAã€‚\nåå¤å±‹äº¤è¶¾é›å£æ„Ÿåç¡¬Qã€‚\nå¿…é»é‡‘è³è¦ªå­ä¸¼ã€æ‰‹ç¾½å…ˆ (ç‚¸é›ç¿…)ã€‚" },
                    { time: "20:30", name: "Piyorin æŒ‘æˆ°", type: "food", typeLabel: "æŒ‘æˆ°", desc: "å°é›è›‹ç³•ã€‚", highlights: ["Piyorin"], strategy: "åœ¨è»Šç«™è²·å°é›è›‹ç³•ã€‚\næ‰‹æŒä¿æŒæ°´å¹³ï¼Œæ­é›»æ‰¶æ¢¯è¦æŠ“ç·Šï¼Œä¸è¦æ™ƒå‹•ã€‚\nå›é£¯åº—æ²’å€’æ‰ç®—è´ã€‚" }
                ]},
                { day: 4, date_short: "2/28", date_en: "Sat", location: "Takayama", places: [
                    { time: "09:00", name: "JR Hida ç‰¹æ€¥", type: "transport", typeLabel: "ç§»å‹•", desc: "å‰å¾€é«˜å±±ã€‚", highlights: ["æŒ‡å®šå¸­"], strategy: "åŠƒä½æ™‚æŒ‡å 'Luggage Seat' (æœ€å¾Œä¸€æ’)ã€‚\nç«è»Šç¾é£Ÿï¼šåƒå£½ç‚¸è¦é£¯ç³°ã€æ¾æµ¦å•†åº—é£›é©’ç‰›ä¾¿ç•¶ã€‚" },
                    { time: "12:15", name: "é«˜å±±æ«»åºµ", type: "stay", typeLabel: "å¯„æ”¾", desc: "é«˜å±±ç«™æ—ã€‚", bookingType: "hotel", hotelLink: "https://hk.trip.com/cw/hotel/ctOrderDetailPages/CheckOrderAuthPage.html?orderId=1359041951886445", highlights: ["å¯„æ”¾è¡Œæ"], strategy: "å‡ºç«™èµ° 3 åˆ†é˜ã€‚å¯„æ”¾è¡Œæ (Check-inå‰)ï¼Œæ‹¿è™Ÿç¢¼ç‰Œã€‚" },
                    { time: "13:00", name: "é«˜å±±è€è¡—", type: "spot", typeLabel: "æ•£ç­–", desc: "ä¸‰ç”ºé€šã€‚", highlights: ["é£›é©’ç‰›å£½å¸"], strategy: "é‚Šèµ°é‚Šåƒã€‚\nå¿…åƒï¼šé£›é©’ç‰›æ¡å£½å¸ (å‚å£å±‹)ã€é£›é©’ç‰›åŒ…å­ (å–œå…«éƒ)ã€‚\nå»èˆ¹å‚é…’é€ æŠ•å¹£è©¦å–æ¸…é…’ã€‚" },
                    { time: "15:00", name: "Check-in", type: "stay", typeLabel: "ä¼‘æ¯", desc: "æ›ä¸Šä½œå‹™è¡£ã€‚", highlights: ["é ‚æ¨“é¢¨æ™¯"], strategy: "1. åœ¨å¤§å»³ Pillow Bar æ¶æ•é ­ã€‚\n2. æ›ä¸Šä½œå‹™è¡£ (Samue)ã€‚\n3. å»é ‚æ¨“çœ‹é¢¨æ™¯ã€‚" },
                    { time: "18:00", name: "å‘³è—å¤©åœ‹", type: "food", typeLabel: "æ™šé¤", desc: "é«˜å±±ç¬¬ä¸€ç‡’è‚‰ã€‚", highlights: ["A5é£›é©’ç‰›"], strategy: "å‹™å¿…é ç´„ã€‚è‹¥ç„¡é ç´„ï¼Œ16:30 å»æ’éšŠã€‚\nå¿…é»ï¼šå‘³è—ç››æ‹¼ç›¤ (Ajikura Mori)ã€‚\nA5 å’Œç‰›æ²¹è„‚å¤šï¼Œæ²¾èŠ¥æœ«æˆ–é¹½æœ€å¥½åƒã€‚" },
                    { time: "22:00", name: "å¤œé³´æ‹‰éºµ", type: "food", typeLabel: "å®µå¤œ", desc: "é£¯åº—å…è²»ã€‚", highlights: ["å…è²»"], strategy: "å»é¤å»³åƒå…è²»æ‹‰éºµ (Yonaki Soba)ã€‚\né‚„é¤“çš„è©±å» Lawson è²·ç‚¸é›å¡Šå› (Red)ã€‚" }
                ]},
                { day: 5, date_short: "3/1", date_en: "Sun", location: "Shirakawa", places: [
                    { time: "08:00", name: "é£¯åº—æ—©é¤", type: "food", typeLabel: "æ—©é¤", desc: "æœ´è‘‰å‘³å™Œã€‚", highlights: ["æœ´è‘‰å‘³å™Œ"], strategy: "å°ˆæ”»é„‰åœŸæ–™ç†å€ã€‚\nä¸€å®šè¦åƒæœ´è‘‰å‘³å™Œé…ç™½é£¯ã€é£›é©’ç‰›å¥¶ã€é†ƒæ¼¬ç‰©ã€‚" },
                    { time: "09:00", name: "æ¿ƒé£›å·´å£«", type: "transport", typeLabel: "ç§»å‹•", desc: "å‰å¾€ç™½å·é„‰ã€‚", highlights: ["æšˆè»Šè—¥"], strategy: "åœ¨æ¿ƒé£›å·´å£«ä¸­å¿ƒæ­è»Šã€‚\næœƒæšˆè»Šè€…å…ˆåƒè—¥ã€‚å¸¶ä¸€ç“¶æ°´ã€‚" },
                    { time: "10:00", name: "ç™½å·é„‰åˆæŒæ‘", type: "spot", typeLabel: "ä¸–ç•Œéºç”¢", desc: "å±•æœ›å°ã€å’Œç”°å®¶ã€‚", highlights: ["å±•æœ›å°"], strategy: "1. æ­æ¥é§è»Šä¸ŠåŸå±±å±•æœ›å°ã€‚\n2. èµ°è·¯ä¸‹å±±é€›å’Œç”°å®¶ã€‚\n3. å»ä¸‰å°å±‹æ‹ç…§ã€‚" },
                    { time: "12:00", name: "å–«èŒ¶ è½äºº", type: "food", typeLabel: "åˆé¤", desc: "Ochiudoã€‚", highlights: ["ç´…è±†æ¹¯"], strategy: "å¿…åƒï¼šå’–å“©é£¯ã€ç´…è±†æ¹¯ (ç„¡é™çºŒç¢—)ã€‚\nååœ¨åœ°çˆæ—æ°£æ°›å¥½ã€‚" },
                    { time: "16:00", name: "è²¸åˆ‡é¢¨å‘‚", type: "spot", typeLabel: "æº«æ³‰", desc: "é£¯åº—ç§äººæ¹¯å±‹ã€‚", highlights: ["ç§äººæ¹¯å±‹"], strategy: "å›é«˜å±±å¾Œï¼Œå»é ‚æ¨“é ç´„è²¸åˆ‡é¢¨å‘‚ (ç§äººæ¹¯å±‹)ã€‚\næ³¡å®Œå–å…è²»ç‰›å¥¶/å†°æ£’ã€‚" },
                    { time: "18:00", name: "ä¸¸æ˜", type: "food", typeLabel: "æ™šé¤", desc: "é£›é©’ç‰›å£½å–œç‡’ã€‚", highlights: ["å£½å–œç‡’"], strategy: "é€²åº—æŒ‡å 'Sukiyaki'ã€‚\næ”»ç•¥ï¼šè‚‰ç‰‡ç…®å¥½ä¸€å®šè¦è£¹æ»¿ç”Ÿè›‹æ¶²å†å…¥å£ã€‚" },
                    { time: "20:00", name: "ä¾¿åˆ©å•†åº—", type: "spot", typeLabel: "æ¡è²·", desc: "è²·æ˜æ—¥æ—©é¤ã€‚", highlights: ["R-1å„ªæ ¼"], strategy: "å› ç‚ºæ˜å¤©è¦æ—©èµ·å»é›ªå±±ã€‚\nè²·é›è›‹æ²™æ‹‰ä¸‰æ˜æ²»ã€æ˜æ²» R-1 å„ªæ ¼é£²ã€‚" }
                ]},
                { day: 6, date_short: "3/2", date_en: "Mon", location: "Okuhida", places: [
                    { time: "07:30", name: "Coffee Don", type: "food", typeLabel: "æ—©é¤", desc: "æ˜­å’Œæ°£æ°›è€èˆ–ã€‚", highlights: ["åå¸å¥—é¤"], strategy: "1951å¹´è€èˆ–ã€‚é»åå¸å¥—é¤é…é»‘å’–å•¡ã€‚\nä¸æƒ³æ—©èµ·å°±åœ¨æˆ¿åƒä¾¿åˆ©å•†åº—æ—©é¤ã€‚" },
                    { time: "08:40", name: "å‰å¾€æ–°ç©—é«˜", type: "transport", typeLabel: "ç§»å‹•", desc: "æ­å·´å£«ã€‚", highlights: ["å·¦å´é¢¨æ™¯"], strategy: "åå·´å£«å·¦å´ (Left Side) çœ‹é¢¨æ™¯ã€‚" },
                    { time: "10:45", name: "Alps no Pan", type: "food", typeLabel: "é»å¿ƒ", desc: "é‹å¹³é«˜åŸç«™ã€‚", highlights: ["å¯é Œ"], strategy: "åœ¨è½‰ä¹˜ç¬¬äºŒæ®µçºœè»Šå‰ï¼Œå»éºµåŒ…åº—è²·å‰›å‡ºçˆçš„ç¾çƒ¤å¯é Œ (Croissant)ã€‚" },
                    { time: "11:00", name: "æ–°ç©—é«˜çºœè»Š", type: "spot", typeLabel: "çµ•æ™¯", desc: "é›™å±¤çºœè»Šã€‚", highlights: ["é›ªä¹‹è¿´å»Š"], strategy: "æ¶é›™å±¤çºœè»Š 2æ¨“ ä½ç½®ã€‚\nå±±é ‚å»èµ°é›ªä¹‹è¿´å»Šã€å¯„æ˜ä¿¡ç‰‡ã€‚" },
                    { time: "14:00", name: "å¹³æ¹¯ä¹‹æ£®", type: "spot", typeLabel: "æº«æ³‰", desc: "æ—¥æ­¸æº«æ³‰ã€‚", highlights: ["é›ªè¦‹æº«æ³‰"], strategy: "å›ç¨‹å·´å£«åœ¨ã€Œå¹³æ¹¯æº«æ³‰ã€ä¸‹ã€‚\nåƒé£›é©’ç‰›éµæ¿ç‡’ã€‚\næ³¡ 16 å€‹éœ²å¤©é›ªè¦‹æº«æ³‰æ± ã€‚é«”é©—é›ªä¸­è£¸èº«å¥”è·‘ã€‚" },
                    { time: "18:00", name: "Center4 Burger", type: "food", typeLabel: "æ™šé¤", desc: "é£›é©’ç‰›æ¼¢å ¡ã€‚", highlights: ["æ¼¢å ¡"], strategy: "é«˜å±±ç¬¬ä¸€åæ¼¢å ¡ã€‚éœ€æå‰é ç´„ã€‚\nè‹¥ç„¡ä½ï¼Œå»å¹³å®‰æ¨‚åƒé¤ƒå­ã€‚" }
                ]},
                { day: 7, date_short: "3/3", date_en: "Tue", location: "Airport", places: [
                    { time: "08:00", name: "å®®å·æœå¸‚", type: "spot", typeLabel: "å¸‚é›†", desc: "æ²³é‚Šæ—©å¸‚ã€‚", highlights: ["ä¼´æ‰‹ç¦®"], strategy: "åªæ”¶ç¾é‡‘ã€‚è²·é¤…ä¹¾æ¯å’–å•¡ã€ç‚¸è›‹ç™½éœœã€å‘³å™Œç…é¤…ã€‚" },
                    { time: "11:00", name: "è±†å¤©ç‹—", type: "food", typeLabel: "åˆé¤", desc: "é«˜å±±æ‹‰éºµã€‚", highlights: ["ä¸­è¯æ‹‰éºµ"], strategy: "æœ€å¾Œå·¡ç¦®ã€‚é†¬æ²¹æ¹¯é ­ï¼Œæ²æ²çš„ç´°éºµã€‚åŠ ä¸€é¡†å‘³ç‰ (è›‹)ã€‚" },
                    { time: "13:30", name: "å‰å¾€æ©Ÿå ´", type: "transport", typeLabel: "ç§»å‹•", desc: "æ¿ƒé£›å·´å£«ç›´é”ã€‚", highlights: ["é ç´„"], strategy: "çµ•å°è¦æº–æ™‚ã€‚è»Šç¨‹ 3.5 å°æ™‚ã€‚\nä¸Šè»Šå‰è²·å¥½é›¶é£Ÿé£²æ–™ã€æº–å‚™æšˆè»Šè—¥ã€‚" },
                    { time: "17:00", name: "ä¸­éƒ¨åœ‹éš›æ©Ÿå ´", type: "spot", typeLabel: "é›¢å¢ƒ", desc: "T2ã€‚", highlights: ["è¦é¤…"], strategy: "1. é ˜è¡Œæ (Check-in)ã€‚\n2. é€› Flight of Dreams 787 å®¢æ©Ÿã€‚\n3. å»é¢¨ä¹‹æµ´çœ‹é£›æ©Ÿæ³¡è…³ã€‚\n4. è²·è¦é¤… (ãˆã³ã›ã‚“ã¹ã„ã®é‡Œ)ã€‚" },
                    { time: "21:00", name: "èµ·é£›è¿”æ¸¯", type: "transport", typeLabel: "é›¢å¢ƒ", desc: "UO685ã€‚", bookingType: "flight", flightNo: "UO685", terminal: "T2", highlights: [], strategy: "å¸¶è‘—æ»¿æ»¿çš„æˆ°åˆ©å“å’Œè‚šå­å›å®¶ï¼" }
                ]}
            ]);

            const tripStart = new Date(2026, 1, 25, 9, 0, 0); 
            const countdownStart = new Date(2026, 1, 3, 9, 0, 0); 
            
            const getHKTime = () => {
                const now = new Date();
                const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
                return new Date(utc + (3600000 * 8)); // UTC+8
            };

            const now = ref(getHKTime());
            const nowFormatted = computed(() => now.value.toLocaleDateString('en-GB', { month: 'numeric', day: 'numeric' }));

            setInterval(() => {
                now.value = getHKTime();
            }, 1000);

            const countdown = computed(() => {
                const diff = tripStart - now.value;
                if(diff <= 0) return {days:0, hours:'00', minutes:'00', seconds:'00'};
                return { 
                    days: Math.floor(diff/(1000*60*60*24)), 
                    hours: Math.floor((diff%(1000*60*60*24))/(1000*60*60)).toString().padStart(2,'0'), 
                    minutes: Math.floor((diff%(1000*60*60))/(1000*60)).toString().padStart(2,'0'),
                    seconds: Math.floor((diff%(1000*60))/1000).toString().padStart(2,'0')
                };
            });
            
            const tripProgress = computed(() => {
                const totalDuration = tripStart - countdownStart; 
                const timePassed = now.value - countdownStart;
                const percentage = (timePassed / totalDuration) * 100;
                return Math.min(Math.max(percentage, 0), 100);
            });

            // IMAGE COMPRESSION (Strict 5MB limit)
            const compressImage = (file, callback) => {
                if(file.size > 5000000) {
                    alert('Image too large (>5MB). Please pick a smaller one.');
                    return;
                }
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        try {
                            const canvas = document.createElement('canvas');
                            const MAX_WIDTH = 600; 
                            const scaleSize = MAX_WIDTH / img.width;
                            if(scaleSize < 1) {
                                canvas.width = MAX_WIDTH;
                                canvas.height = img.height * scaleSize;
                            } else {
                                canvas.width = img.width;
                                canvas.height = img.height;
                            }
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                            callback(canvas.toDataURL('image/jpeg', 0.5)); 
                        } catch (e) {
                            alert("Compression failed, using raw image.");
                            callback(event.target.result);
                        }
                    }
                }
            };

            const handleImageUpload = (event) => { 
                const file = event.target.files[0]; 
                if(file) { 
                    compressImage(file, (result) => {
                        newWishItem.value.image = result; 
                    });
                } 
            };

            onMounted(() => { 
                try {
                    const b = localStorage.getItem('jp_v58_b'); if(b) budgetList.value = JSON.parse(b); 
                    const w = localStorage.getItem('jp_v58_w'); if(w) wishlist.value = JSON.parse(w); 
                    const p = localStorage.getItem('jp_v58_p'); if(p) packingList.value = JSON.parse(p);
                } catch(e) { console.error("Storage error", e); }
            });
            
            // Watchers with error handling for quota
            watch(budgetList, v => { try { localStorage.setItem('jp_v58_b', JSON.stringify(v)); } catch(e) { alert("Storage full!"); } }, {deep:true});
            watch(wishlist, v => { try { localStorage.setItem('jp_v58_w', JSON.stringify(v)); } catch(e) { alert("Storage full! Image too big."); } }, {deep:true});
            watch(packingList, v => { try { localStorage.setItem('jp_v58_p', JSON.stringify(v)); } catch(e) { console.error(e); } }, {deep:true});

            const getTypeColor = (t) => ({food:'border-[#726251] bg-[#c5b59d]', transport:'border-[#70808f] bg-[#c5b59d]', stay:'border-[#91867f] bg-[#c5b59d]', spot:'border-[#4a4238] bg-[#c5b59d]'}[t]||'border-gray-400');
            const openDetail = (p) => { detailModal.value = { show:true, data:p }; };
            const openTicketDetail = (t) => { detailModal.value = { show:true, data: { ...t, isTicket: true } }; };
            const getMethodClass = (m) => ({ 'method-online': m==='online', 'method-onsite': m==='onsite', 'method-mobile': m==='mobile' }[m]);
            const getMethodBadge = (m) => ({ 'bg-[#e6f4ea] text-[#1e4620] border-[#34a853]': m==='online', 'bg-[#fef7e0] text-[#5f370e] border-[#fbbc04]': m==='onsite', 'bg-[#f1f3f4] text-[#3c4043] border-[#9aa0a6]': m==='mobile' }[m]);
            const getMethodLabel = (m) => ({ online:'ç·šä¸Šé ç´„', onsite:'ç¾å ´è³¼è²·', mobile:'æ•¸ä½æ”¯ä»˜' }[m]);

            // FIXED GOOGLE MAPS LINK
            const openMap = (n) => window.open('https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(n + ' Japan'), '_blank');
            
            const addItem = () => { if(newItem.value.name&&newItem.value.price){ budgetList.value.unshift({...newItem.value}); showBudgetInput.value=false; newItem.value={name:'',price:'',payer:'TszLok'}; }};
            const deleteBudget = (item) => { const idx = budgetList.value.indexOf(item); if(idx>-1) budgetList.value.splice(idx,1); };
            const filteredBudgetList = computed(() => budgetFilter.value === 'All' ? budgetList.value : budgetList.value.filter(i => i.payer === budgetFilter.value));
            const filteredTotal = computed(() => filteredBudgetList.value.reduce((s,i)=>s+i.price,0));
            
            const addWishlist = () => { 
                if(newWishItem.value.name) { 
                    try {
                        wishlist.value.unshift({...newWishItem.value}); 
                        newWishItem.value = { name: '', price: '', image: null }; 
                        showWishlistInput.value = false; 
                    } catch(e) {
                        alert("Storage full! Try removing some items.");
                    }
                } 
            };
            const deleteWishlist = (idx) => wishlist.value.splice(idx, 1);

            // CALCULATOR LOGIC
            const appendCalc = (char) => { calcExpression.value += char; };
            const clearCalc = () => { calcExpression.value = ''; calcResult.value = '0'; };
            const backspace = () => { calcExpression.value = calcExpression.value.slice(0, -1); };
            const calculate = () => {
                try {
                    // Safe evaluation for simple math
                    const safeEval = new Function('return ' + calcExpression.value);
                    const res = safeEval();
                    calcResult.value = res.toString();
                } catch (e) {
                    calcResult.value = 'Error';
                }
            };
            
            const displayValue = computed(() => {
                if(!calcExpression.value) return '0';
                // If expression ends with operator, evaluate what we have so far for preview
                try {
                    // Check if last char is number
                    if (/[0-9.]$/.test(calcExpression.value)) {
                         const safeEval = new Function('return ' + calcExpression.value);
                         return safeEval().toLocaleString('en-US', {maximumFractionDigits: 2});
                    }
                } catch(e) {}
                
                if(calcResult.value !== '0' && calcResult.value !== 'Error') return parseFloat(calcResult.value).toLocaleString('en-US', {maximumFractionDigits: 2});
                return calcExpression.value;
            });

            // UPDATED TABS (6 Items)
            const tabs = [ 
                { id: 'itinerary', label: 'Plan', icon: 'fas fa-map-marked-alt' }, 
                { id: 'wallet', label: 'Wallet', icon: 'fas fa-wallet' }, 
                { id: 'packing', label: 'Pack', icon: 'fas fa-suitcase' }, 
                { id: 'reservations', label: 'Resv', icon: 'fas fa-ticket-alt' },
                { id: 'reminders', label: 'Tips', icon: 'fas fa-lightbulb' },
                { id: 'info', label: 'Calc', icon: 'fas fa-calculator' } 
            ];

            return { currentView, dayIndex, itinerary, budgetList, packingList, newItem, showBudgetInput, detailModal, countdown, openDetail, openMap, addItem, deleteBudget, payers, tabs, keyLabels, walletMode, showWishlistInput, newWishItem, wishlist, handleImageUpload, addWishlist, deleteWishlist, currentDayWeather, budgetFilter, filteredBudgetList, filteredTotal, getTypeColor, tripProgress, nowFormatted, isModalOpen, 
                // Calc exports
                currencyRate, calcExpression, appendCalc, clearCalc, backspace, calculate, displayValue,
                // Resv
                ticketList, openTicketDetail, getMethodClass, getMethodBadge, getMethodLabel, getTicketsByMethod
            };
        }
    }).mount('#app');
</script>
</body>
</html>
