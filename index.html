<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ¢“æ¨‚Nagoya v62.0 (Fixed)</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALQAAAC0CAMAAAAKE/YAAAAhUExURQAAAHCAj8W1tcW1tcW1tcW1tcW1tcW1tcW1tcW1tcW1tc/y0e0AAAALdFJOUwAAP19/gL+/z9/vI9vUOgAAAAlwSFlzAAAOwwAADsMBx2+oZAAABqZJREFUeNrtnQt7ojAMhU9baKHQvrf//7+8Q4FCoS1t0znn5Fy8w0eIIcnJJSGFAAAAAAAAAAAAAAAAAAAAAAAA4J+i67q+7/92Gf+aIAiC13A4/Osy/iU1x1uSJH9dxr+k5ng55/zP5fxLao638/n8r8v4l9QcbxVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1/R983bTtu9M07Z/4+rZt27Z9d/q+/xNf347jOI777gzD+ImvbydJkiTJuzMM4ye+vp0lWZZl784wjJ/4+naO53ie9+4Mw/iJr2/neZ7n+bvTNO2f+Pp2juM4jvvudF33J76+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6yq+ruLrKr6u4usqvq7i6/pXfP2S53me99/x9cMwDMMw/H18/fV6vV6v/x1fP03TNE3T38fXT9M0TdPf8fXjOI7jOP4+vn4cx3Ec/x1fP0mSJEn+Pr5+kiRJkvwdXz/LsizL/j6+fpZlWZb9HV8/z/M8z/8+vn6e53me/x1fP8/zPM//Pr5+nud5nv8dX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV9X8XUVX1fxdRVfV/F1FV/Xv+Pr13G9Xq/X3/H167iu67quf8fXr+O6ruu6/h1fv47ruq7r+nd8/Tqu67qu69/x9eu4ruu6rn/H16/juq7rur6Ir6v4uoyvX8f1fd/3fX0RX1fxdRlfv47r+77v+/oivq7i6zK+fh3X933f9/VFfF3F12V8/Tqu7/u+7+uL+LqKr8v4+nVcPwiC4C/j6yq+LuPr13H9IAiCv4yvq/i6jK9fx/WDIAj+Mr6u4usyvn4d1w+CIPjL+LqKr8v4+nVcPwiC4C/j6yq+LuPr13H9IAiCv4yvq/i6jK9fx/WDIAj+Mr6u4usyvn4d1w+CIPjL+LqKr8v4+nVcPwiC4C/j6yq+LuPr13H9IAiCv4yvq/i6jK9fx/WDIAj+Mr6u4usyvn4d1w+CIPjL+LqKr8v4+nVcPwiC4C/j6yq+LuPr13H9IAiC/4Ovi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyvi6+r+LqIr6v4uoyv/wN9F4L72+M1OAAAAABJRU5ErkJggg==">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3.4.19/dist/vue.global.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&family=Shippori+Mincho:wght@600;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg-main: #70808f; --bg-card: #c5b59d; --text-on-card: #4a4238; --text-on-bg: #f3f0eb; }
        body { font-family: 'Zen Maru Gothic', sans-serif; background-color: var(--bg-main); color: var(--text-on-bg); margin: 0; padding: 0; height: 100dvh; width: 100vw; overflow: hidden; -webkit-tap-highlight-color: transparent; }
        .font-mincho { font-family: 'Shippori Mincho', serif; }
        .glass { background: var(--bg-card); color: var(--text-on-card); border: 1px solid rgba(255,255,255,0.3); border-radius: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .safe-top { padding-top: max(20px, env(safe-area-inset-top)); }
        .safe-bottom { padding-bottom: max(20px, env(safe-area-inset-bottom)); }
        input { user-select: text !important; pointer-events: auto !important; }
        .modal-layer { position: fixed; inset: 0; z-index: 99999; }
        .modal-content { position: relative; z-index: 100000; }
        @keyframes slide-up { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-slide-up { animation: slide-up 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .ticket-stub { clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 70%, 5% 65%, 0% 60%, 0% 0%); cursor: pointer; transition: transform 0.1s; }
        .ticket-stub:active { transform: scale(0.98); }
        .method-online { background: #e6f4ea; color: #1e4620; border-left: 4px solid #34a853; }
        .method-onsite { background: #fef7e0; color: #5f370e; border-left: 4px solid #fbbc04; }
        .method-mobile { background: #f1f3f4; color: #3c4043; border-left: 4px solid #9aa0a6; }
        .sync-status { position: fixed; top: 10px; right: 10px; z-index: 9999; font-size: 10px; font-weight: bold; padding: 4px 8px; border-radius: 20px; background: rgba(0,0,0,0.5); color: white; display: flex; items-center; gap: 5px; }
        [v-cloak] { display: none !important; }
        .toggle-btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .phrase-card:active { transform: scale(0.95); background: white; }
    </style>
</head>
<body>

<div id="app" v-cloak class="flex flex-col h-full w-full max-w-md mx-auto relative bg-[#70808f]">
    
    <div class="sync-status" v-if="syncStatus">
        <div class="w-2 h-2 rounded-full" :class="syncColor"></div>
        {{ syncStatus }}
    </div>

    <main v-show="!isModalOpen" class="flex-1 overflow-y-auto no-scrollbar z-10 pb-28 pt-safe-top px-5 scroll-smooth relative">
        
        <div v-if="currentView === 'itinerary'" class="space-y-5 pb-4">
            <div class="flex justify-between items-center mb-2 mt-2">
                <div>
                    <div class="text-[10px] font-bold text-white/80 uppercase tracking-widest">JP.TRIP 2026</div>
                    <h1 class="text-3xl font-black font-mincho text-white flex items-center gap-2"><i class="fas fa-chess-rook text-xl opacity-80"></i> æ¢“æ¨‚Nagoya</h1>
                </div>
                <div class="w-10 h-10 rounded-full border-2 border-white/50 overflow-hidden shadow-lg bg-[#70808f] flex items-center justify-center">
                    <i class="fas fa-mountain text-white text-xl"></i>
                </div>
            </div>
            
            <div class="glass p-5 relative overflow-hidden mb-2 shadow-xl">
                <div class="flex justify-between items-end mb-2"><span class="text-xs font-bold opacity-60 uppercase tracking-wider">è·é›¢å‡ºç™¼ (HKO)</span><i class="fas fa-plane text-[#726251] animate-pulse"></i></div>
                <div class="flex items-baseline gap-2 mb-4">
                    <span class="text-5xl font-black font-mono tracking-tighter">{{ countdown.days }}</span><span class="text-xs font-bold opacity-80 mr-2">days</span>
                    <span class="text-xl font-mono font-bold">{{ countdown.hours }}</span><span class="text-[10px] opacity-60 mr-1">h</span>
                    <span class="text-xl font-mono font-bold">{{ countdown.minutes }}</span><span class="text-[10px] opacity-60 mr-1">m</span>
                    <span class="text-xl font-mono font-bold">{{ countdown.seconds }}</span><span class="text-[10px] opacity-60">s</span>
                </div>
                <div class="relative w-full h-2 bg-[#4a4238]/10 rounded-full mt-2"><div class="absolute top-0 left-0 h-full bg-[#726251] rounded-full transition-all duration-1000" :style="{ width: tripProgress + '%' }"></div></div>
            </div>

            <div class="bg-[#70808f] sticky top-0 z-30 py-2 -mx-5 px-5 border-b border-[#c5b59d]/30 shadow-lg">
                <div class="flex gap-3 overflow-x-auto no-scrollbar">
                    <button v-for="(day, idx) in itinerary" :key="idx" @click="dayIndex = idx" class="flex-shrink-0 w-12 h-14 rounded-xl flex flex-col items-center justify-center border transition-all cursor-pointer active:scale-95" :class="dayIndex === idx ? 'bg-[#c5b59d] text-[#4a4238] border-[#c5b59d] shadow-lg scale-105' : 'bg-white/10 border-white/10 text-white/60'">
                        <span class="text-[9px] font-bold uppercase">{{ day.date_en.substr(0,3) }}</span>
                        <span class="text-lg font-black">{{ day.date_short.split('/')[1] }}</span>
                    </button>
                </div>
            </div>

            <div class="glass p-3 border-l-4 border-[#726251] flex items-center justify-between">
                <div class="flex flex-col"><span class="text-[10px] font-bold opacity-60 uppercase tracking-wider">{{ itinerary[dayIndex].date_short }} Weather</span><span class="text-xs font-bold">{{ itinerary[dayIndex].location }}</span></div>
                <div class="flex gap-3 overflow-x-auto no-scrollbar max-w-[65%]"><div v-for="(h, i) in currentDayWeather" :key="i" class="flex flex-col items-center min-w-[2.5rem]"><span class="text-[9px] opacity-60 font-mono">{{ h.time }}</span><i :class="h.icon" class="text-sm my-0.5"></i><span class="text-[10px] font-bold">{{ h.temp }}</span></div></div>
            </div>
            <div class="relative pl-2">
                <div class="absolute left-[7px] top-2 bottom-0 w-[2px] bg-[#c5b59d]/30 rounded-full"></div>
                <div v-for="(place, pIdx) in itinerary[dayIndex].places" :key="pIdx" class="relative pl-8 mb-6 group">
                    <div class="absolute left-0 top-0 w-4 h-4 bg-[#c5b59d] border-[3px] border-[#70808f] rounded-full z-10" :class="getTypeColor(place.type)"></div>
                    <div @click="openDetail(place)" class="glass p-4 relative overflow-hidden active:scale-[0.98] transition-all cursor-pointer hover:bg-[#d6c9b5] z-10">
                        <div class="flex justify-between items-start mb-2 relative z-10"><span class="text-[10px] font-black bg-[#70808f] text-white px-2 py-1 rounded">{{ place.time }}</span><span class="text-[10px] font-bold opacity-60 uppercase">{{ place.typeLabel }}</span></div>
                        <h3 class="text-lg font-black mb-1 relative z-10">{{ place.name }}</h3><p class="text-xs opacity-80 line-clamp-1 mb-2 relative z-10">{{ place.desc }}</p>
                        <div class="flex flex-wrap gap-2 mt-2 relative z-10"><span v-for="tag in place.highlights" class="px-2 py-1 bg-white/50 border border-black/5 rounded text-[10px] font-bold text-[#726251]">{{ tag }}</span></div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'wallet'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">Spend & Buy</h2>
            <div class="flex bg-white/10 p-1 rounded-xl"><button @click="walletMode='expense'" class="flex-1 py-3 rounded-lg text-xs font-bold transition-all" :class="walletMode==='expense'?'bg-[#c5b59d] text-[#4a4238] shadow-sm':'text-white/60'">è¨˜å¸³</button><button @click="walletMode='wishlist'" class="flex-1 py-3 rounded-lg text-xs font-bold transition-all" :class="walletMode==='wishlist'?'bg-[#c5b59d] text-[#4a4238] shadow-sm':'text-white/60'">è³¼ç‰©</button></div>
            <div v-if="walletMode==='expense'" class="space-y-4">
                <div class="grid grid-cols-3 gap-2">
                    <div @click="budgetFilter='All'" class="glass p-3 flex flex-col items-center justify-center cursor-pointer transition-all border-2" :class="budgetFilter==='All'?'border-[#726251] bg-[#d6c9b5]':'border-transparent'"><span class="text-[9px] font-bold opacity-60 uppercase">Total</span><span class="text-sm font-black">Â¥{{ totalSpent.toLocaleString() }}</span></div>
                    <div @click="budgetFilter='TszLok'" class="glass p-3 flex flex-col items-center justify-center cursor-pointer transition-all border-2" :class="budgetFilter==='TszLok'?'border-[#91867f] bg-[#d6c9b5]':'border-transparent'"><span class="text-[9px] font-bold opacity-60 uppercase">TszLok</span><span class="text-sm font-black">Â¥{{ spentTszLok.toLocaleString() }}</span></div>
                    <div @click="budgetFilter='TszTung'" class="glass p-3 flex flex-col items-center justify-center cursor-pointer transition-all border-2" :class="budgetFilter==='TszTung'?'border-[#726251] bg-[#d6c9b5]':'border-transparent'"><span class="text-[9px] font-bold opacity-60 uppercase">TszTung</span><span class="text-sm font-black">Â¥{{ spentTszTung.toLocaleString() }}</span></div>
                </div>
                <div class="glass p-3 flex justify-between items-center bg-[#f3f0eb]/50"><span class="text-xs font-bold opacity-60">HKD Approx.</span><span class="text-lg font-mono font-black">HKD ${{ (filteredTotal * currencyRate).toFixed(1) }}</span></div>
                <div class="space-y-3 pb-20"><div v-for="(item, idx) in filteredBudgetList" :key="idx" class="glass p-4 flex justify-between items-center"><div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full flex items-center justify-center text-xs text-white shadow-sm" :class="item.payer==='TszLok'?'bg-[#91867f]':'bg-[#726251]'">{{ item.payer[0] }}</div><span class="text-sm font-bold">{{ item.name }}</span></div><div class="flex flex-col items-end"><span class="font-mono font-bold opacity-80">Â¥{{ item.price }}</span><span class="text-[9px] font-mono opacity-50">HKD ${{ (item.price * currencyRate).toFixed(1) }}</span></div><button @click="deleteBudget(item)" class="opacity-40 hover:text-red-600 ml-2"><i class="fas fa-times text-xs"></i></button></div></div>
                <div class="fixed bottom-24 right-6 z-40"><button @click="showBudgetInput=true" class="w-14 h-14 bg-[#c5b59d] text-[#4a4238] rounded-full shadow-xl flex items-center justify-center text-xl border-2 border-white/20 active:scale-90 transition-transform"><i class="fas fa-plus"></i></button></div>
            </div>
            <div v-if="walletMode==='wishlist'" class="grid grid-cols-2 gap-4 pb-20">
                <div @click="showWishlistInput=true" class="glass p-4 flex flex-col items-center justify-center aspect-square border-2 border-dashed border-[#4a4238]/20 hover:bg-[#d6c9b5] cursor-pointer opacity-60 hover:opacity-100 transition-opacity"><i class="fas fa-plus text-2xl mb-2"></i><span class="text-xs font-bold">Add Item</span></div>
                <div v-for="(item, idx) in wishlist" :key="idx" class="glass overflow-hidden relative group"><button @click="deleteWishlist(idx)" class="absolute top-2 right-2 w-6 h-6 bg-black/60 rounded-full flex items-center justify-center text-xs z-10 text-white shadow-md"><i class="fas fa-times"></i></button><img v-if="item.image" :src="item.image" class="w-full aspect-square object-cover"><div v-else class="w-full aspect-square bg-[#4a4238]/10 flex items-center justify-center flex-col p-2 text-center"><i class="fas fa-shopping-bag text-2xl mb-2 opacity-30"></i></div><div class="p-3"><div class="font-bold text-sm truncate">{{ item.name }}</div><div class="font-mono text-xs font-bold opacity-60">Â¥{{ item.price }}</div><div class="font-mono text-[9px] font-bold opacity-40">HKD ${{ (item.price * currencyRate).toFixed(1) }}</div></div></div>
            </div>
        </div>

        <div v-if="currentView === 'packing'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">è¡Œææ¸…å–®</h2>
            <div class="flex bg-white/10 p-1 rounded-xl mb-4">
                <button @click="packingTab='TszLok'" class="flex-1 py-3 rounded-lg text-xs font-bold transition-all toggle-btn" :class="packingTab==='TszLok'?'bg-[#91867f] text-white shadow-sm':'text-white/60'">TszLok (Boy)</button>
                <button @click="packingTab='TszTung'" class="flex-1 py-3 rounded-lg text-xs font-bold transition-all toggle-btn" :class="packingTab==='TszTung'?'bg-[#726251] text-white shadow-sm':'text-white/60'">TszTung (Girl)</button>
            </div>
            <div v-if="packingTab==='TszLok'" class="space-y-4 animate-slide-up">
                <div class="glass overflow-hidden"><div class="bg-[#91867f]/20 px-5 py-3 flex items-center gap-3 border-b border-[#4a4238]/10"><i class="fas fa-briefcase text-[#91867f]"></i><span class="font-bold text-sm uppercase">TszLok Hand Carry</span></div><div class="p-2 grid gap-1"><label v-for="(item, idx) in packingList.tszLok.handCarry" :key="idx" class="flex items-center p-3 hover:bg-white/10 rounded-xl cursor-pointer check-box"><input type="checkbox" v-model="item.checked" @change="saveData" class="hidden"><div class="w-5 h-5 rounded border-2 border-[#4a4238]/30 flex items-center justify-center mr-3 bg-white/50"><i class="fas fa-check text-[#4a4238] text-[10px] opacity-0" :class="{'opacity-100': item.checked}"></i></div><span class="text-sm font-bold" :class="{'line-through opacity-40': item.checked}">{{ item.name }}</span></label></div></div>
                <div class="glass overflow-hidden"><div class="bg-[#91867f]/20 px-5 py-3 flex items-center gap-3 border-b border-[#4a4238]/10"><i class="fas fa-suitcase text-[#91867f]"></i><span class="font-bold text-sm uppercase">TszLok Luggage</span></div><div class="p-2 grid gap-1"><label v-for="(item, idx) in packingList.tszLok.luggage" :key="idx" class="flex items-center p-3 hover:bg-white/10 rounded-xl cursor-pointer check-box"><input type="checkbox" v-model="item.checked" @change="saveData" class="hidden"><div class="w-5 h-5 rounded border-2 border-[#4a4238]/30 flex items-center justify-center mr-3 bg-white/50"><i class="fas fa-check text-[#4a4238] text-[10px] opacity-0" :class="{'opacity-100': item.checked}"></i></div><span class="text-sm font-bold" :class="{'line-through opacity-40': item.checked}">{{ item.name }}</span></label></div></div>
            </div>
            <div v-if="packingTab==='TszTung'" class="space-y-4 animate-slide-up">
                <div class="glass overflow-hidden"><div class="bg-[#726251]/20 px-5 py-3 flex items-center gap-3 border-b border-[#4a4238]/10"><i class="fas fa-briefcase text-[#726251]"></i><span class="font-bold text-sm uppercase">TszTung Hand Carry</span></div><div class="p-2 grid gap-1"><label v-for="(item, idx) in packingList.tszTung.handCarry" :key="idx" class="flex items-center p-3 hover:bg-white/10 rounded-xl cursor-pointer check-box"><input type="checkbox" v-model="item.checked" @change="saveData" class="hidden"><div class="w-5 h-5 rounded border-2 border-[#4a4238]/30 flex items-center justify-center mr-3 bg-white/50"><i class="fas fa-check text-[#4a4238] text-[10px] opacity-0" :class="{'opacity-100': item.checked}"></i></div><span class="text-sm font-bold" :class="{'line-through opacity-40': item.checked}">{{ item.name }}</span></label></div></div>
                <div class="glass overflow-hidden"><div class="bg-[#726251]/20 px-5 py-3 flex items-center gap-3 border-b border-[#4a4238]/10"><i class="fas fa-suitcase text-[#726251]"></i><span class="font-bold text-sm uppercase">TszTung Luggage</span></div><div class="p-2 grid gap-1"><label v-for="(item, idx) in packingList.tszTung.luggage" :key="idx" class="flex items-center p-3 hover:bg-white/10 rounded-xl cursor-pointer check-box"><input type="checkbox" v-model="item.checked" @change="saveData" class="hidden"><div class="w-5 h-5 rounded border-2 border-[#4a4238]/30 flex items-center justify-center mr-3 bg-white/50"><i class="fas fa-check text-[#4a4238] text-[10px] opacity-0" :class="{'opacity-100': item.checked}"></i></div><span class="text-sm font-bold" :class="{'line-through opacity-40': item.checked}">{{ item.name }}</span></label></div></div>
            </div>
        </div>

        <div v-if="currentView === 'reservations'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">é ç´„ & ç¥¨åˆ¸ Resv</h2>
            <div class="space-y-3">
                <div class="glass p-0 overflow-hidden relative border-l-4 border-[#91867f]"><div class="bg-[#91867f]/10 p-3 flex justify-between items-center border-b border-[#4a4238]/10"><span class="text-xs font-bold uppercase tracking-widest text-[#91867f]">Outbound</span><span class="text-xs font-bold text-[#4a4238]">2/25 (Wed)</span></div><div class="p-4 flex justify-between items-center"><div class="text-center"><div class="text-2xl font-black font-mono">HKG</div></div><div class="flex flex-col items-center px-4"><i class="fas fa-arrow-right text-[#91867f] mb-1"></i><div class="text-[10px] font-bold bg-[#4a4238] text-white px-2 py-0.5 rounded">UO680</div></div><div class="text-center"><div class="text-2xl font-black font-mono">NGO</div></div></div></div>
                <div class="glass p-0 overflow-hidden relative border-l-4 border-[#726251]"><div class="bg-[#726251]/10 p-3 flex justify-between items-center border-b border-[#4a4238]/10"><span class="text-xs font-bold uppercase tracking-widest text-[#726251]">Inbound</span><span class="text-xs font-bold text-[#4a4238]">3/3 (Tue)</span></div><div class="p-4 flex justify-between items-center"><div class="text-center"><div class="text-2xl font-black font-mono">NGO</div></div><div class="flex flex-col items-center px-4"><i class="fas fa-arrow-right text-[#726251] mb-1"></i><div class="text-[10px] font-bold bg-[#4a4238] text-white px-2 py-0.5 rounded">UO685</div></div><div class="text-center"><div class="text-2xl font-black font-mono">HKG</div></div></div></div>
            </div>
            <div><div class="flex items-center gap-2 mb-2 text-white/80"><span class="w-2 h-2 rounded-full bg-[#34a853] shadow-[0_0_10px_#34a853]"></span><h3 class="text-xs font-bold uppercase tracking-widest">ç¾åœ¨å°±è²· Online</h3></div><div class="space-y-2"><div v-for="(item, i) in getTicketsByMethod('online')" :key="i" @click="openTicketDetail(item)" class="ticket-stub p-4 rounded-r-xl flex justify-between items-center shadow-md bg-white border-l-4 border-[#34a853]"><div class="flex flex-col"><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-black uppercase opacity-60 text-[#4a4238]">Day {{ item.date.split('/')[1] }}</span><span class="text-[10px] font-bold bg-black/5 px-1.5 rounded">{{ item.date }}</span></div><div class="font-black text-sm text-[#4a4238] leading-tight">{{ item.title }}</div></div><div class="text-right"><i class="fas fa-chevron-right text-xs opacity-30"></i></div></div></div></div>
            <div><div class="flex items-center gap-2 mb-2 text-white/80"><span class="w-2 h-2 rounded-full bg-[#fbbc04] shadow-[0_0_10px_#fbbc04]"></span><h3 class="text-xs font-bold uppercase tracking-widest">ç¾å ´è³¼è²· Onsite</h3></div><div class="space-y-2"><div v-for="(item, i) in getTicketsByMethod('onsite')" :key="i" @click="openTicketDetail(item)" class="ticket-stub p-4 rounded-r-xl flex justify-between items-center shadow-md bg-white border-l-4 border-[#fbbc04]"><div class="flex flex-col"><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-black uppercase opacity-60 text-[#4a4238]">Day {{ item.date.split('/')[1] }}</span><span class="text-[10px] font-bold bg-black/5 px-1.5 rounded">{{ item.date }}</span></div><div class="font-black text-sm text-[#4a4238] leading-tight">{{ item.title }}</div></div><div class="text-right"><i class="fas fa-chevron-right text-xs opacity-30"></i></div></div></div></div>
            <div><div class="flex items-center gap-2 mb-2 text-white/80"><span class="w-2 h-2 rounded-full bg-[#9aa0a6] shadow-[0_0_10px_#9aa0a6]"></span><h3 class="text-xs font-bold uppercase tracking-widest">æ•¸ä½æ”¯ä»˜ Mobile</h3></div><div class="space-y-2"><div v-for="(item, i) in getTicketsByMethod('mobile')" :key="i" @click="openTicketDetail(item)" class="ticket-stub p-4 rounded-r-xl flex justify-between items-center shadow-md bg-white border-l-4 border-[#9aa0a6]"><div class="flex flex-col"><div class="flex items-center gap-2 mb-1"><span class="text-[10px] font-black uppercase opacity-60 text-[#4a4238]">Day {{ item.date.split('/')[1] }}</span><span class="text-[10px] font-bold bg-black/5 px-1.5 rounded">{{ item.date }}</span></div><div class="font-black text-sm text-[#4a4238] leading-tight">{{ item.title }}</div></div><div class="text-right"><i class="fas fa-chevron-right text-xs opacity-30"></i></div></div></div></div>
        </div>

        <div v-if="currentView === 'reminders'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">çœéŒ¢ & æ”»ç•¥ Tips</h2>
            <div class="glass overflow-hidden relative"><div class="bg-[#70808f] p-3 text-white flex justify-between items-center border-b border-white/20"><span class="font-bold text-sm"><i class="fas fa-key mr-2"></i>å¯„æ”¾è¡Œæ</span><span class="bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold">Coin Locker</span></div><div class="p-5"><h3 class="font-bold text-lg mb-2 text-[#4a4238]">åå¤å±‹ç«™/é«˜å±±ç«™</h3><ul class="text-sm space-y-3 opacity-90 leading-relaxed list-disc pl-4 text-[#4a4238]"><li><b class="text-[#726251]">IC å¡ä»˜æ¬¾ï¼š</b>å¤§éƒ¨åˆ†ç½®ç‰©æ«ƒå¯ç”¨ Suica/Pasmo ä»˜æ¬¾ï¼Œä¸ç”¨æ‰¾é›¶éŒ¢ï¼Œä¸”é‘°åŒ™å°±æ˜¯ä½ çš„å¡ã€‚</li><li><b class="text-[#726251]">é«˜å±±ç«™ï¼š</b>è‹¥è»Šç«™ç½®ç‰©æ«ƒæ»¿äº†ï¼Œå¯å»å°é¢çš„ã€Œé«˜å±±æ¿ƒé£›å·´å£«ä¸­å¿ƒã€æ‰¾ç½®ç‰©æ«ƒã€‚</li></ul></div></div>
            <div class="glass overflow-hidden relative"><div class="bg-[#91867f] p-3 text-white flex justify-between items-center border-b border-white/20"><span class="font-bold text-sm"><i class="fas fa-print mr-2"></i>ç·Šæ€¥åˆ—å°</span><span class="bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold">7-11</span></div><div class="p-5"><h3 class="font-bold text-lg mb-2 text-[#4a4238]">è»Šç¥¨æ²’é›»æ€éº¼è¾¦ï¼Ÿ</h3><p class="text-sm opacity-90 text-[#4a4238] mb-2">å¦‚æœæ‰‹æ©Ÿæ²’é›»ç„¡æ³•å‡ºç¤ºè»Šç¥¨ PDFï¼Œå¯å» 7-11 ä½¿ç”¨å¤šåŠŸèƒ½äº‹å‹™æ©Ÿã€‚</p><div class="bg-[#726251]/10 p-2 rounded text-xs font-bold text-[#726251]">ä¸‹è¼‰ã€Œnetprintã€App ä¸Šå‚³ PDFï¼Œå» 7-11 è¼¸å…¥é ç´„è™Ÿç¢¼åˆ—å°ã€‚</div></div></div>
            <div class="glass overflow-hidden relative"><div class="bg-[#70808f] p-3 text-white flex justify-between items-center border-b border-white/20"><span class="font-bold text-sm"><i class="fas fa-subway mr-2"></i>Day 3 äº¤é€š</span><span class="bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold">Â¥760 / 24hr</span></div><div class="p-5"><h3 class="font-bold text-lg mb-2 text-[#4a4238]">åœ°éµ 24 å°æ™‚åˆ¸</h3><ul class="text-sm space-y-3 opacity-90 leading-relaxed list-disc pl-4 text-[#4a4238]"><li><b class="text-[#726251]">å›æœ¬æ¥µå¿«ï¼š</b>è¡Œç¨‹ç¸½è»Šè³‡ç´„ Â¥1,000+ï¼Œä½¿ç”¨æ­¤åˆ¸<span class="font-bold border-b border-[#726251]">ç¾çœ Â¥300</span>ã€‚</li><li><b class="text-[#726251]">å½ˆæ€§æ¥µé«˜ï¼š</b>æ¡ã€Œ24å°æ™‚åˆ¶ã€ã€‚è‹¥ Day 3 æ—©ä¸Š 10:00 ç¬¬ä¸€æ¬¡åˆ·å¡ï¼Œå¯ç”¨åˆ° Day 4 æ—©ä¸Š 09:59ã€‚</li></ul></div></div>
            <div class="glass overflow-hidden relative"><div class="bg-[#91867f] p-3 text-white flex justify-between items-center border-b border-white/20"><span class="font-bold text-sm"><i class="fas fa-snowflake mr-2"></i>Day 6 è­¦å‘Š</span><span class="bg-white/20 px-2 py-0.5 rounded text-[10px] font-bold">å®‰å…¨ç¬¬ä¸€</span></div><div class="p-5"><h3 class="font-bold text-lg mb-2 text-[#4a4238]">å¹³æ¹¯å¤§ç€‘å¸ƒ é›ªåœ°è£å‚™</h3><div class="bg-red-500/10 p-3 rounded-lg mb-3 text-sm font-bold border-l-4 border-red-500 text-red-800">åœ°é¢æ¥µæ»‘ï¼Danger!</div><p class="text-sm opacity-90 text-[#4a4238]">å‰å¾€ç€‘å¸ƒçš„è·¯æ®µç‚ºé›ªåœ°å¾®ä¸Šå¡ï¼Œæ¥µæ˜“çµå†°æ»‘å€’ã€‚è«‹å‹™å¿…ç©¿è‘—<b class="text-red-700">é˜²æ»‘é‹ (é›ªé´)</b> æˆ–åŠ è£ç°¡æ˜“å†°çˆªã€‚</p></div></div>
        </div>

        <div v-if="currentView === 'tools'" class="space-y-6 pt-4 h-full flex flex-col">
            <h2 class="text-2xl font-black font-mincho text-white">éš¨èº«å·¥å…· Tools</h2>
            <div class="glass p-5">
                <h3 class="text-sm font-bold opacity-60 uppercase mb-3"><i class="fas fa-language mr-2"></i>æŒ‡è·¯å¡ Speak for me</h3>
                <div class="grid grid-cols-2 gap-3">
                    <button v-for="p in phrases" :key="p.zh" @click="detailModal={show:true, data:{isPhrase:true, ...p}}" class="bg-white/50 p-4 rounded-xl text-left hover:bg-white transition-colors border border-[#4a4238]/10 phrase-card">
                        <div class="text-xs font-bold opacity-60 mb-1">{{ p.zh }}</div>
                        <div class="font-bold text-lg text-[#4a4238]">{{ p.jp_short }}</div>
                    </button>
                </div>
            </div>
            <div class="glass p-5 border-l-4 border-red-500">
                <h3 class="text-sm font-bold opacity-60 uppercase mb-3"><i class="fas fa-phone-alt mr-2 text-red-500"></i>ç·Šæ€¥è¯çµ¡ Emergency</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center border-b border-[#4a4238]/10 pb-2"><span class="font-bold">è­¦å¯Ÿå±€ (Police)</span><a href="tel:110" class="bg-red-500 text-white px-3 py-1 rounded-lg font-black text-sm">110</a></div>
                    <div class="flex justify-between items-center border-b border-[#4a4238]/10 pb-2"><span class="font-bold">æ•‘è­·è»Š/ç«è­¦ (Fire)</span><a href="tel:119" class="bg-red-500 text-white px-3 py-1 rounded-lg font-black text-sm">119</a></div>
                    <div class="mt-2"><div class="text-[10px] font-bold opacity-50 uppercase">é§æ—¥è¾¦äº‹è™• (HK Immigration)</div><div class="font-bold text-sm mt-1 selectable">+852 1868</div></div>
                </div>
            </div>
            <div class="glass p-5">
                <h3 class="text-sm font-bold opacity-60 uppercase mb-3"><i class="fas fa-map-marker-alt mr-2"></i>é£¯åº—åœ°å€ Hotel Address</h3>
                <div class="bg-[#f3f0eb] p-3 rounded-lg border border-[#4a4238]/20 mb-3"><div class="text-[10px] opacity-60 mb-1">Nagoya (Day 1-3)</div><div class="font-black text-sm text-[#726251]">è¥¿é‰„ãƒ›ãƒ†ãƒ« ã‚¯ãƒ«ãƒ¼ãƒ  åå¤å±‹</div><div class="text-xs opacity-80 mt-1 selectable">æ„›çŸ¥çœŒåå¤å±‹å¸‚ä¸­åŒºéŒ¦3-4-3</div></div>
                <div class="bg-[#f3f0eb] p-3 rounded-lg border border-[#4a4238]/20"><div class="text-[10px] opacity-60 mb-1">Takayama (Day 4-6)</div><div class="font-black text-sm text-[#726251]">æ±æ€¥ã‚¹ãƒ†ã‚¤é£›é¨¨é«˜å±± çµã®æ¹¯</div><div class="text-xs opacity-80 mt-1 selectable">å²é˜œçœŒé«˜å±±å¸‚èŠ±é‡Œç”º4-126</div></div>
            </div>
        </div>

    </main>

    <nav v-show="!isModalOpen" class="fixed bottom-0 w-full h-[85px] bg-[#70808f]/95 backdrop-blur-xl border-t border-[#c5b59d]/20 z-50 flex justify-around items-center px-2 pb-safe-bottom">
        <button v-for="tab in tabs" :key="tab.id" @click="currentView = tab.id" class="flex flex-col items-center justify-center w-12 h-full space-y-1 transition-all cursor-pointer active:scale-95" :class="currentView === tab.id ? 'text-[#c5b59d] scale-110' : 'text-white/40'"><i :class="tab.icon" class="text-xl"></i><span class="text-[9px] font-bold uppercase tracking-widest">{{ tab.label }}</span></button>
    </nav>

    <div v-if="showBudgetInput" class="modal-layer flex items-end justify-center"><div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="showBudgetInput=false"></div><div class="bg-[#c5b59d] w-full max-w-md h-[90vh] rounded-t-3xl animate-slide-up flex flex-col text-[#4a4238] modal-content" @click.stop><div class="p-6 font-bold text-lg border-b border-[#4a4238]/10">Add Expense</div><div class="flex-1 overflow-y-auto p-6 pb-40"><div class="flex gap-3 mb-6"><button v-for="p in payers" :key="p" @click="newItem.payer=p" class="flex-1 py-4 rounded-xl border font-bold text-sm transition-colors" :class="newItem.payer===p?(p==='TszLok'?'bg-[#91867f] text-white border-transparent':'bg-[#726251] text-white border-transparent'):'border-[#4a4238]/30 text-[#4a4238]/60'">{{ p }}</button></div><div class="space-y-6"><div><label class="block text-xs font-bold opacity-60 mb-2">Item Name</label><input v-model="newItem.name" class="w-full bg-white p-5 rounded-2xl font-bold border-2 border-transparent text-[#4a4238] placeholder-[#4a4238]/30 focus:border-[#726251] outline-none text-lg"></div><div><label class="block text-xs font-bold opacity-60 mb-2">Price (Â¥)</label><input v-model.number="newItem.price" type="number" class="w-full bg-white p-5 rounded-2xl font-bold border-2 border-transparent text-[#4a4238] placeholder-[#4a4238]/30 focus:border-[#726251] outline-none text-lg"><div v-if="newItem.price" class="text-right mt-2 font-mono font-bold text-[#4a4238]/60">â‰ˆ HKD ${{ (newItem.price * currencyRate).toFixed(1) }}</div></div></div><div class="flex gap-3 mt-10"><button @click="showBudgetInput=false" class="flex-1 py-4 font-bold text-[#4a4238]/50 bg-black/5 rounded-2xl">Cancel</button><button @click="addItem" class="flex-1 py-4 bg-[#70808f] text-white rounded-2xl font-bold shadow-lg text-lg">Save</button></div></div></div></div>
    
    <div v-if="showWishlistInput" class="modal-layer flex items-end justify-center">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="showWishlistInput=false"></div>
        <div class="bg-[#c5b59d] w-full max-w-md h-[90vh] rounded-t-3xl animate-slide-up flex flex-col text-[#4a4238] modal-content" @click.stop>
            <div class="p-6 font-bold text-lg border-b border-[#4a4238]/10">Add Wishlist</div>
            <div class="flex-1 overflow-y-auto p-6 pb-40">
                <div class="mb-6 relative w-full h-48 bg-white/30 border-2 border-dashed border-[#4a4238]/20 rounded-2xl flex flex-col items-center justify-center overflow-hidden">
                    <div v-if="newWishItem.image" class="w-full h-full relative">
                        <img :src="newWishItem.image" class="w-full h-full object-contain bg-black/10">
                        <button @click="newWishItem.image=null" class="absolute top-2 right-2 bg-red-500 text-white rounded-full w-8 h-8 flex items-center justify-center"><i class="fas fa-times"></i></button>
                    </div>
                    <label v-else class="w-full h-full flex flex-col items-center justify-center cursor-pointer hover:bg-white/50 transition-colors">
                        <i class="fas fa-camera text-3xl mb-2 opacity-50"></i>
                        <span class="text-xs font-bold opacity-50">Select Photo (Album)</span>
                        <input type="file" accept="image/*" @change="handleImageUpload" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                    </label>
                </div>
                <div class="space-y-6"><div><label class="block text-xs font-bold opacity-60 mb-2">Item Name</label><input v-model="newWishItem.name" class="w-full bg-white p-5 rounded-2xl font-bold border-2 border-transparent text-[#4a4238] outline-none focus:border-[#726251] text-lg"></div><div><label class="block text-xs font-bold opacity-60 mb-2">Price (Â¥)</label><input v-model.number="newWishItem.price" type="number" class="w-full bg-white p-5 rounded-2xl font-bold border-2 border-transparent text-[#4a4238] outline-none focus:border-[#726251] text-lg"><div v-if="newWishItem.price" class="text-right mt-2 font-mono font-bold text-[#4a4238]/60">â‰ˆ HKD ${{ (newWishItem.price * currencyRate).toFixed(1) }}</div></div></div>
                <div class="flex gap-3 mt-10"><button @click="showWishlistInput=false" class="flex-1 py-4 font-bold text-[#4a4238]/50 bg-black/5 rounded-2xl">Cancel</button><button @click="addWishlist" class="flex-1 py-4 bg-[#70808f] text-white rounded-2xl font-bold shadow-lg text-lg">Add</button></div>
            </div>
        </div>
    </div>

    <div v-if="detailModal.show" class="modal-layer flex items-end justify-center"><div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="detailModal.show=false"></div><div class="bg-[#c5b59d] w-full max-w-md rounded-t-3xl p-6 relative animate-slide-up max-h-[85vh] overflow-y-auto text-[#4a4238] modal-content" @click.stop><div class="w-12 h-1 bg-[#4a4238]/20 rounded-full mx-auto mb-6"></div>
    
    <div v-if="detailModal.data.isPhrase" class="text-center py-10"><div class="text-sm font-bold opacity-60 mb-4">{{ detailModal.data.zh }}</div><div class="text-4xl font-black mb-6">{{ detailModal.data.jp }}</div><div class="text-xs opacity-50 font-mono">{{ detailModal.data.pronounce }}</div></div>

    <div v-else-if="detailModal.data.isTicket"><span class="px-3 py-1 rounded-lg text-xs font-bold uppercase" :class="getMethodBadge(detailModal.data.method)">{{ getMethodLabel(detailModal.data.method) }}</span><h2 class="text-2xl font-black mt-3 mb-2 font-mincho">{{ detailModal.data.title }}</h2><div class="bg-white/40 p-4 rounded-xl mb-4 shadow-sm"><div class="text-[10px] font-bold opacity-50 uppercase tracking-widest mb-1">åœ°é» / è©³ç´°è³‡è¨Š</div><div class="font-bold mb-1">{{ detailModal.data.location }}</div><div v-if="detailModal.data.desc" class="text-xs opacity-70 font-mono">{{ detailModal.data.desc }}</div><div class="mt-3 flex gap-2"><a v-if="detailModal.data.method === 'online' && detailModal.data.url" :href="detailModal.data.url" target="_blank" class="flex-1 py-3 bg-[#34a853] text-white text-center rounded-xl font-bold shadow-md active:scale-95 transition-transform text-sm"><i class="fas fa-external-link-alt mr-2"></i>é ç´„ç¶²ç«™</a><a v-if="detailModal.data.pdfLink" :href="detailModal.data.pdfLink" target="_blank" class="flex-1 py-3 bg-[#70808f] text-white text-center rounded-xl font-bold shadow-md active:scale-95 transition-transform text-sm"><i class="fas fa-file-pdf mr-2"></i>è»Šç¥¨ PDF</a></div></div><div class="space-y-4"><div v-if="detailModal.data.guide.steps"><h4 class="text-xs font-bold opacity-60 uppercase tracking-widest mb-2">æ“ä½œæ­¥é©Ÿ</h4><ul class="list-decimal pl-5 space-y-2 text-sm font-bold opacity-90"><li v-for="step in detailModal.data.guide.steps">{{ step }}</li></ul></div><div v-if="detailModal.data.guide.reminder" class="bg-red-400/10 p-4 rounded-xl border-l-4 border-red-500 text-sm font-bold text-red-900"><i class="fas fa-exclamation-triangle mr-2"></i>{{ detailModal.data.guide.reminder }}</div></div></div><div v-else><span class="px-3 py-1 bg-[#70808f] text-white rounded-lg text-xs font-bold uppercase">{{ detailModal.data.typeLabel }}</span><h2 class="text-2xl font-black mt-3 mb-2 font-mincho">{{ detailModal.data.name }}</h2><div class="text-sm font-bold opacity-60 mb-6 flex items-center"><i class="far fa-clock mr-2"></i> {{ detailModal.data.time }}</div><div class="space-y-6 text-sm leading-relaxed"><div v-if="detailModal.data.desc"><h4 class="text-xs font-bold opacity-50 uppercase tracking-widest mb-2">Description</h4><p class="font-bold whitespace-pre-line">{{ detailModal.data.desc }}</p></div><div v-if="detailModal.data.strategy" class="bg-[#726251]/10 p-5 rounded-2xl border-l-4 border-[#726251]"><h4 class="text-xs font-bold uppercase tracking-widest mb-3 flex items-center"><i class="fas fa-chess-knight mr-2"></i>æ”»ç•¥ Strategy</h4><div class="font-bold whitespace-pre-line">{{ detailModal.data.strategy }}</div></div></div><div class="mt-6 space-y-3"><a v-if="detailModal.data.ticketLink" :href="detailModal.data.ticketLink" target="_blank" class="block w-full py-4 bg-[#726251] text-white text-center rounded-2xl font-bold shadow-lg">View Ticket</a><a v-if="detailModal.data.hotelLink" :href="detailModal.data.hotelLink" target="_blank" class="block w-full py-4 bg-[#91867f] text-white text-center rounded-2xl font-bold shadow-lg">View Hotel Booking</a></div><div class="h-6"></div><button @click="openMap(detailModal.data.name)" class="w-full py-4 bg-white text-[#4a4238] rounded-2xl font-bold shadow-lg">Open Map</button></div></div></div>

</div>

<script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js';
    import { getFirestore, doc, onSnapshot, setDoc } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

    const firebaseConfig = {
        apiKey: "AIzaSyCDOiAGPDY7Jd7ysg1fapFnCdidwGE66q8",
        authDomain: "nagoya-2026-361a0.firebaseapp.com",
        projectId: "nagoya-2026-361a0",
        storageBucket: "nagoya-2026-361a0.firebasestorage.app",
        messagingSenderId: "156812601167",
        appId: "1:156812601167:web:852ed3f4f431f7506cc73a",
        measurementId: "G-Z0NV8048TJ"
    };

    window.onerror = function(msg, url, line) {
        console.warn("Error suppressed:", msg);
        return false;
    };

    let db;
    try {
        const app = initializeApp(firebaseConfig);
        db = getFirestore(app);
    } catch (e) { console.warn("Firebase Init Error", e); }

    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            const currentView = ref('itinerary'); 
            const dayIndex = ref(0);
            const detailModal = ref({ show: false, data: {} });
            const walletMode = ref('expense');
            const budgetFilter = ref('All'); 
            const showBudgetInput = ref(false);
            const showWishlistInput = ref(false);
            const payers = ['TszLok', 'TszTung'];
            const newItem = ref({ name: '', price: '', payer: 'TszLok' });
            const newWishItem = ref({ name: '', price: '', image: null });
            const budgetList = ref([]);
            const wishlist = ref([]);
            
            const packingTab = ref('TszLok');
            const packingList = ref({
                tszLok: {
                    handCarry: [
                        {name: 'å€‹äººè­‰ä»¶ (èº«åˆ†è­‰/è­·ç…§/ç°½è­‰)', checked: false}, 
                        {name: 'ç™»æ©Ÿè­‰', checked: false}, 
                        {name: 'éŠ€åŒ… (æ—¥åœ“/ä¿¡ç”¨å¡)', checked: false}, 
                        {name: 'SIMå¡ / Wifiè›‹', checked: false}, 
                        {name: 'æ‰‹æ©Ÿ & å……é›»ç·š', checked: false}, 
                        {name: 'è¡Œå‹•é›»æº (å°¿è¢‹)', checked: false}, 
                        {name: 'å£ç½©/æ¶ˆæ¯’æ¶²', checked: false}
                    ],
                    luggage: [
                        {name: 'å¤–å‡ºè¡£ç‰© (4-5å¥—)', checked: false}, 
                        {name: 'ç¡è¡£è¤²', checked: false}, 
                        {name: 'å…§è¡£è¤² & è¥ª', checked: false}, 
                        {name: 'åšå¤–å¥—/ç¾½çµ¨', checked: false}, 
                        {name: 'ç”·å£«å‰ƒé¬šåˆ€', checked: false}, 
                        {name: 'è½‰æ’ (å…©è…³æ‰æ’) & æ‹–æ¿', checked: false}, 
                        {name: 'é›¨å‚˜/é›¨è¡£', checked: false}, 
                        {name: 'æ‹–é‹', checked: false}, 
                        {name: 'å‚™ç”¨è† è¢‹ (è£æ±¡è¡£)', checked: false}
                    ]
                },
                tszTung: {
                    handCarry: [
                        {name: 'å€‹äººè­‰ä»¶ (èº«åˆ†è­‰/è­·ç…§/ç°½è­‰)', checked: false}, 
                        {name: 'ç™»æ©Ÿè­‰', checked: false}, 
                        {name: 'éŠ€åŒ… (æ—¥åœ“/ä¿¡ç”¨å¡)', checked: false}, 
                        {name: 'SIMå¡', checked: false}, 
                        {name: 'æ‰‹æ©Ÿ & å……é›»ç·š', checked: false}, 
                        {name: 'è¡Œå‹•é›»æº (å°¿è¢‹)', checked: false}, 
                        {name: 'åŒ–å¦åŒ… (æ¶²é«”<100ml)', checked: false}
                    ],
                    luggage: [
                        {name: 'å¤–å‡ºè¡£ç‰© (4-5å¥—)', checked: false}, 
                        {name: 'ç¡è¡£è¤²', checked: false}, 
                        {name: 'å…§è¡£è¤² & è¥ª', checked: false}, 
                        {name: 'åšå¤–å¥—/ç¾½çµ¨', checked: false}, 
                        {name: 'åŒ–å¦å“ & å¸å¦', checked: false}, 
                        {name: 'è­·è†šå“ (ä¿æ¿•)', checked: false}, 
                        {name: 'æ´—é¢/æ´—é«®/è­·é«®', checked: false}, 
                        {name: 'é ­é«®å®šå‹/é›»é«®æ£’', checked: false}, 
                        {name: 'æ¢³ & é¢¨ç­’', checked: false}, 
                        {name: 'éš±å½¢çœ¼é¡ & è—¥æ°´', checked: false}, 
                        {name: 'å¥³æ€§è­·ç†ç”¨å“', checked: false}, 
                        {name: 'æ¯›å·¾', checked: false}, 
                        {name: 'å…¬ä»”', checked: false}, 
                        {name: 'ç†±æ°´ç…² (è¦–éœ€è¦)', checked: false}
                    ]
                }
            });

            const phrases = [
                { zh: 'ä¸å¥½æ„æ€', jp_short: 'ã™ã¿ã¾ã›ã‚“', jp: 'ã™ã¿ã¾ã›ã‚“', pronounce: 'Sumimasen' },
                { zh: 'è¬è¬', jp_short: 'ã‚ã‚ŠãŒã¨ã†', jp: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™', pronounce: 'Arigatou Gozaimasu' },
                { zh: 'é€™å€‹', jp_short: 'ã“ã‚Œ', jp: 'ã“ã‚Œã‚’ãã ã•ã„', pronounce: 'Kore o kudasai' },
                { zh: 'æ´—æ‰‹é–“', jp_short: 'ãƒˆã‚¤ãƒ¬', jp: 'ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹ï¼Ÿ', pronounce: 'Toire wa doko desu ka?' },
                { zh: 'çµå¸³', jp_short: 'ãŠä¼šè¨ˆ', jp: 'ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™', pronounce: 'Okaikei o onegaishimasu' },
                { zh: 'ä¸è¦è”¥', jp_short: 'ãƒã‚®æŠœã', jp: 'ãƒã‚®ã‚’æŠœã„ã¦ãã ã•ã„', pronounce: 'Negi o nuite kudasai' },
                { zh: 'æœ‰æ¨è–¦å—', jp_short: 'ãŠã™ã™ã‚', jp: 'ãŠã™ã™ã‚ã¯ä½•ã§ã™ã‹ï¼Ÿ', pronounce: 'Osusume wa nan desu ka?' },
                { zh: 'è«‹å¸¶æˆ‘å»', jp_short: 'ã“ã“ã¸', jp: 'ã“ã“ã¸è¡Œã£ã¦ãã ã•ã„', pronounce: 'Koko e itte kudasai' }
            ];

            const currencyRate = ref(0.052);
            const calcExpression = ref('');
            const calcResult = ref('0');
            const syncStatus = ref('Connecting...');
            const syncColor = ref('bg-yellow-400');
            const tripDocId = "nagoya_v62_0"; 

            const fetchRate = async () => {
                try {
                    const res = await fetch('https://api.frankfurter.dev/v1/latest?from=JPY&to=HKD');
                    const data = await res.json();
                    if(data && data.rates && data.rates.HKD) {
                        currencyRate.value = data.rates.HKD;
                    }
                } catch(e) { console.log("Using default rate"); }
            };
            onMounted(() => { fetchRate(); });

            const getTypeColor = (t) => ({food:'border-[#726251] bg-[#c5b59d]', transport:'border-[#70808f] bg-[#c5b59d]', stay:'border-[#91867f] bg-[#c5b59d]', spot:'border-[#4a4238] bg-[#c5b59d]'}[t]||'border-gray-400');
            const getMethodClass = (m) => ({ 'method-online': m==='online', 'method-onsite': m==='onsite', 'method-mobile': m==='mobile' }[m]);
            const getMethodBadge = (m) => ({ 'bg-[#e6f4ea] text-[#1e4620]': m==='online', 'bg-[#fef7e0] text-[#5f370e]': m==='onsite', 'bg-[#f1f3f4] text-[#3c4043]': m==='mobile' }[m]);
            const getMethodLabel = (m) => ({ online:'ç·šä¸Šé ç´„', onsite:'ç¾å ´è³¼è²·', mobile:'æ•¸ä½æ”¯ä»˜' }[m]);

            onSnapshot(doc(db, "trips", tripDocId), (doc) => {
                syncStatus.value = "Live"; syncColor.value = "bg-green-400";
                if (doc.exists()) {
                    const data = doc.data();
                    if(data.budgetList) budgetList.value = data.budgetList;
                    if(data.wishlist) wishlist.value = data.wishlist;
                    if(data.packingList) packingList.value = data.packingList;
                }
            }, (error) => { console.error(error); syncStatus.value = "Offline"; syncColor.value = "bg-red-500"; });

            const saveData = async () => {
                syncStatus.value = "Saving..."; syncColor.value = "bg-blue-400 animate-pulse";
                try {
                    await setDoc(doc(db, "trips", tripDocId), { budgetList: budgetList.value, wishlist: wishlist.value, packingList: packingList.value }, { merge: true });
                    setTimeout(() => { syncStatus.value = "Live"; syncColor.value = "bg-green-400"; }, 500);
                } catch (e) { syncStatus.value = "Error"; syncColor.value = "bg-red-500"; }
            };
            watch(budgetList, saveData, { deep: true });
            watch(wishlist, saveData, { deep: true });
            const syncPacking = () => saveData();

            const handleImageUpload = (event) => {
                const file = event.target.files[0];
                if(!file) return;
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (e) => {
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX = 500; 
                        const scale = MAX / img.width;
                        if (scale < 1) { canvas.width = MAX; canvas.height = img.height * scale; } else { canvas.width = img.width; canvas.height = img.height; }
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        newWishItem.value.image = canvas.toDataURL('image/jpeg', 0.5);
                    }
                }
            };

            const addItem = () => { if(newItem.value.name&&newItem.value.price){ budgetList.value.unshift({...newItem.value}); showBudgetInput.value=false; newItem.value={name:'',price:'',payer:'TszLok'}; }};
            const addWishlist = () => { if(newWishItem.value.name){ wishlist.value.unshift({...newWishItem.value}); newWishItem.value={name:'',price:'',image:null}; showWishlistInput.value=false; }};
            const deleteBudget = (item) => { const idx = budgetList.value.indexOf(item); if(idx>-1) budgetList.value.splice(idx,1); };
            const deleteWishlist = (idx) => wishlist.value.splice(idx, 1);
            const openDetail = (p) => { detailModal.value = { show:true, data:p }; };
            const openTicketDetail = (t) => { detailModal.value = { show:true, data: { ...t, isTicket: true } }; };
            const getTicketsByMethod = (m) => ticketList.value.filter(t => t.method === m);
            
            // ğŸ”´ FINAL FIXED OPEN MAP FUNCTION
            const openMap = (n) => {
                try {
                    const location = itinerary.value[dayIndex.value].location || 'Japan';
                    const cleanName = n.replace(/\(.*\)/, '').trim(); 
                    const query = encodeURIComponent(cleanName + ' ' + location);
                    const url = 'https://www.google.com/maps/search/?api=1&query=' + query;
                    window.open(url, '_blank');
                } catch (e) {
                    alert("åœ°åœ–é–‹å•Ÿå¤±æ•—ï¼Œè«‹æ‰‹å‹•æœå°‹");
                }
            };
            
            const isModalOpen = computed(() => showBudgetInput.value || showWishlistInput.value || detailModal.value.show);
            const now = ref(new Date());
            
            const countdown = computed(() => { 
                const target = new Date(2026, 1, 25, 9, 0, 0);
                const diff = target - now.value;
                if (diff <= 0) return { days: 0, hours: '00', minutes: '00', seconds: '00' };
                return { 
                    days: Math.floor(diff / (1000 * 60 * 60 * 24)), 
                    hours: Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60)).toString().padStart(2, '0'), 
                    minutes: Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60)).toString().padStart(2, '0'),
                    seconds: Math.floor((diff % (1000 * 60)) / 1000).toString().padStart(2, '0')
                }; 
            });
            const tripProgress = computed(() => Math.min(100, Math.max(0, ((now.value - new Date(2026,1,3,9,0)) / (new Date(2026,1,25,9,0) - new Date(2026,1,3,9,0))) * 100)));
            const nowFormatted = computed(() => now.value.toLocaleDateString('en-GB', { month: 'numeric', day: 'numeric' }));
            setInterval(() => now.value = new Date(), 1000);

            const appendCalc = (c) => calcExpression.value += c;
            const clearCalc = () => { calcExpression.value=''; calcResult.value='0'; };
            const backspace = () => calcExpression.value = calcExpression.value.slice(0,-1);
            const calculate = () => { try { calcResult.value = new Function('return '+calcExpression.value)().toString(); } catch(e) { calcResult.value='Error'; } };
            const displayValue = computed(() => calcExpression.value || calcResult.value);
            
            const filteredBudgetList = computed(() => budgetFilter.value === 'All' ? budgetList.value : budgetList.value.filter(i => i.payer === budgetFilter.value));
            const filteredTotal = computed(() => filteredBudgetList.value.reduce((s,i)=>s+i.price,0));
            const totalSpent = computed(() => budgetList.value.reduce((s,i)=>s+i.price,0));
            const spentTszLok = computed(() => budgetList.value.filter(i=>i.payer==='TszLok').reduce((s,i)=>s+i.price,0));
            const spentTszTung = computed(() => budgetList.value.filter(i=>i.payer==='TszTung').reduce((s,i)=>s+i.price,0));

            const weatherDB = [
                { date: "2/25", hourly: [{time:"14:00",temp:"8Â°",icon:"fas fa-cloud-sun"},{time:"16:00",temp:"7Â°",icon:"fas fa-cloud"},{time:"18:00",temp:"6Â°",icon:"fas fa-moon"},{time:"20:00",temp:"5Â°",icon:"fas fa-moon"}] },
                { date: "2/26", hourly: [{time:"09:00",temp:"7Â°",icon:"fas fa-sun"},{time:"12:00",temp:"11Â°",icon:"fas fa-sun"},{time:"15:00",temp:"10Â°",icon:"fas fa-cloud-sun"},{time:"18:00",temp:"7Â°",icon:"fas fa-moon"}] },
                { date: "2/27", hourly: [{time:"10:00",temp:"9Â°",icon:"fas fa-cloud"},{time:"13:00",temp:"12Â°",icon:"fas fa-cloud-sun"},{time:"16:00",temp:"10Â°",icon:"fas fa-cloud"},{time:"19:00",temp:"8Â°",icon:"fas fa-cloud-rain"}] },
                { date: "2/28", hourly: [{time:"09:00",temp:"2Â°",icon:"fas fa-snowflake"},{time:"12:00",temp:"3Â°",icon:"fas fa-snowflake"},{time:"15:00",temp:"1Â°",icon:"fas fa-snowflake"},{time:"18:00",temp:"-1Â°",icon:"fas fa-snowflake"}] },
                { date: "3/1", hourly: [{time:"09:00",temp:"-2Â°",icon:"fas fa-snowflake"},{time:"12:00",temp:"0Â°",icon:"fas fa-snowflake"},{time:"15:00",temp:"-1Â°",icon:"fas fa-cloud-meatball"},{time:"18:00",temp:"-4Â°",icon:"fas fa-snowflake"}] },
                { date: "3/2", hourly: [{time:"09:00",temp:"-5Â°",icon:"fas fa-snowflake"},{time:"12:00",temp:"-2Â°",icon:"fas fa-sun"},{time:"15:00",temp:"-3Â°",icon:"fas fa-cloud-sun"},{time:"18:00",temp:"-6Â°",icon:"fas fa-moon"}] },
                { date: "3/3", hourly: [{time:"08:00",temp:"4Â°",icon:"fas fa-cloud-sun"},{time:"12:00",temp:"9Â°",icon:"fas fa-sun"},{time:"16:00",temp:"8Â°",icon:"fas fa-cloud-sun"},{time:"20:00",temp:"6Â°",icon:"fas fa-moon"}] }
            ];
            const currentDayWeather = computed(() => weatherDB[dayIndex.value]?.hourly || []);
            const keyLabels = { handCarry: 'Hand Carry', tszLok: 'TszLok (Boy)', tszTung: 'TszTung (Girl)' };

            const ticketList = ref([
                { 
                    date: "2/25 & 3/3", day: "Day 1, 7", title: "åéµ Î¼-Sky (å¾€è¿”æ©Ÿå ´)", route: "æ©Ÿå ´ â†” åå¤å±‹", price: "Â¥1,430", method: "onsite", location: "æ©Ÿå ´/åéµè»Šç«™", 
                    guide: { 
                        steps: ["æŠµé”åéµæ©Ÿå ´ç«™ï¼šèµ°å‡ºæ©Ÿå ´å…¥å¢ƒå¤§å»³å¾Œï¼Œè·Ÿè‘—ã€ŒTrain / Meitetsu Lineã€æ¨™ç¤ºèµ°ã€‚", "æ‰¾åˆ°è—è‰²æˆ–ç´…è‰²å”®ç¥¨æ©Ÿï¼šé¸æ“‡ã€ŒÎ¼-ticketã€æˆ–ã€ŒLimited Expressã€é¸é …ã€‚", "åŠƒä½ä»˜æ¬¾ï¼šå‰å¾€ã€ŒNagoyaã€ï¼Œé¸æ“‡2äººï¼Œé¸ä½ (å¯é¸é€£è™Ÿ)ã€‚", "å¯ç”¨ç¾é‡‘ã€ä¿¡ç”¨å¡æˆ– IC å¡ã€‚"], 
                        reminder: "ä¸€å®šè¦æ‹¿å…©å¼µç¥¨ï¼ˆä¹˜è»Šåˆ¸+åº§ä½åˆ¸ï¼‰æ‰èƒ½é€²ç«™ï¼" 
                    } 
                },
                { 
                    date: "2/26", day: "Day 2", title: "å‰åœåŠ›å¤§å€‰åº« (å…¥å ´åˆ¸)", route: "å…¥å ´é ç´„", price: "å·²é ç´„", method: "online", location: "æ„›ãƒ»åœ°çƒåšç´€å¿µå…¬åœ’", 
                    url: "https://quickticket.moala.fun/books?id=d1315e41-24de-40a9-a20a-0cf36d07ec8f",
                    guide: { steps: ["é–‹å•Ÿé ç´„ Email ç¢ºèªä¿¡ã€‚", "é»æ“Šé€£çµé¡¯ç¤ºå…¥å ´ QR Codeã€‚", "ä¾é ç´„æ™‚é–“ 12:00 æ’éšŠæƒæå…¥å ´ã€‚"], reminder: "è«‹å‹™å¿…æ”œå¸¶è­·ç…§æŸ¥é©—èº«åˆ†ï¼é²åˆ°ç„¡æ•ˆã€‚" } 
                },
                { date: "2/26", day: "Day 2", title: "å‰åœåŠ›äº¤é€š (Linimo)", route: "å¸‚å€ â†” å‰åœåŠ›", price: "ç´„ Â¥1,340", method: "mobile", location: "Apple Wallet", guide: { steps: ["ç”¨ iPhone äº¤é€šå¡ã€‚", "Apple Pay åŠ å€¼ Â¥3000ã€‚", "ç›´æ¥æ„Ÿæ‡‰é–˜é–€ã€‚"], reminder: "ç¢ºèªæ‰‹æ©Ÿæœ‰é›»ï¼" } },
                { date: "2/27", day: "Day 3", title: "åœ°éµ 24 å°æ™‚åˆ¸", route: "å¸‚å€è§€å…‰", price: "Â¥760", method: "onsite", location: "åœ°éµå”®ç¥¨æ©Ÿ", guide: { steps: ["æ‰¾é»ƒè‰²å”®ç¥¨æ©Ÿã€‚", "é¸ 'Value Tickets'ã€‚", "å¹³æ—¥Â¥760 / é€±æœ«Â¥620ã€‚"], reminder: "ç¬¬ä¸€æ¬¡é€²ç«™å•Ÿç”¨ã€‚" } },
                { 
                    date: "2/28", day: "Day 4", title: "æ¿ƒé£›å·´å£« (å»ç¨‹)", route: "åå¤å±‹ â†’ é«˜å±±", price: "Â¥6,000 (ä¾†å›)", method: "online", location: "åéµå·´å£«ä¸­å¿ƒ", 
                    desc: "ç™¼è»Š: 09:30 | å‡ºç¤º Web Ticket", 
                    pdfLink: "ticket_228.pdf", 
                    guide: { steps: ["å‰å¾€åéµå·´å£«ä¸­å¿ƒ(åå¤å±‹ç«™) 3Fã€‚", "å‡ºç¤º Web Ticket æ‰‹æ©Ÿç•«é¢ã€‚", "å°‹æ‰¾å¾€é«˜å±±/ç™½å·é„‰æœˆå°ã€‚"], reminder: "è«‹ææ—© 15 åˆ†é˜æŠµé”ã€‚" } 
                },
                { 
                    date: "3/1", day: "Day 5", title: "æ¿ƒé£›å·´å£« (ç™½å·é„‰å»ç¨‹)", route: "é«˜å±± â†’ ç™½å·é„‰", price: "Â¥2,800 (å–®ç¨‹)", method: "online", location: "é«˜å±±æ¿ƒé£›å·´å£«ä¸­å¿ƒ", 
                    desc: "å»ç¨‹: 08:10 | åº§ä½: 8A/8B",
                    pdfLink: "ticket_301.pdf", 
                    guide: { steps: ["å‰å¾€é«˜å±±ç«™æ—çš„å·´å£«ä¸­å¿ƒ 4 è™Ÿæœˆå°ã€‚", "å‡ºç¤º Email é›»å­ç¥¨ã€‚", "åº§ä½ 8A / 8Bã€‚"], reminder: "é ç´„ç·¨è™Ÿ: 02062000931ã€‚è«‹å‹™å¿…æº–æ™‚ã€‚" } 
                },
                { 
                    date: "3/1", day: "Day 5", title: "æ¿ƒé£›å·´å£« (ç™½å·é„‰å›ç¨‹)", route: "ç™½å·é„‰ â†’ é«˜å±±", price: "Â¥5,600 (2äºº)", method: "online", location: "ç™½å·é„‰å·´å£«ç¸½ç«™", 
                    desc: "ç™¼è»Š: 15:45 | åº§ä½: 1C/1D",
                    pdfLink: "ticket301_back.pdf", 
                    guide: { steps: ["å‰å¾€ç™½å·é„‰å·´å£«ç¸½ç«™ã€‚", "å‡ºç¤ºé›»å­è»Šç¥¨ (æ‰‹æ©Ÿ PDF)ã€‚", "å°‹æ‰¾è»Šè™Ÿ 01ï¼Œåº§ä½ 1C/1Dã€‚"], reminder: "é ç´„ç·¨è™Ÿ: 02072000521ã€‚ç™¼è»Šå‰è«‹ææ—©æŠµé”ã€‚" } 
                },
                { date: "3/2", day: "Day 6", title: "å¥§é£›é©’ 2 æ—¥å¥—ç¥¨", route: "å·´å£«+çºœè»Š", price: "Â¥6,300", method: "onsite", location: "é«˜å±±æ¿ƒé£›å·´å£«ä¸­å¿ƒ", guide: { steps: ["å» JR æ—å·´å£«ä¸­å¿ƒã€‚", "è²· 'Okuhida Value Ticket'ã€‚", "ä»˜ç¾é‡‘ã€‚"], reminder: "å¼„ä¸Ÿä¸è£œç™¼ï¼åŒ…å«æ–°ç©—é«˜çºœè»Šä¾†å›ã€‚" } },
                { 
                    date: "3/3", day: "Day 7", title: "æ¿ƒé£›å·´å£« (å›ç¨‹)", route: "é«˜å±± â†’ åå¤å±‹", price: "ä½¿ç”¨ä¾†å›ç¥¨", method: "online", location: "é«˜å±±æ¿ƒé£›å·´å£«ä¸­å¿ƒ", 
                    desc: "ç™¼è»Š: 13:20",
                    pdfLink: "ticket_303.pdf", 
                    guide: { steps: ["å‰å¾€é«˜å±±æ¿ƒé£›å·´å£«ä¸­å¿ƒã€‚", "å‡ºç¤ºä¾†å›ç¥¨å›ç¨‹æ†‘è­‰ã€‚", "ä¸Šè»Šç¡è¦ºã€‚"], reminder: "ä¸‹è»Šåœ°é»: åéµå·´å£«ä¸­å¿ƒã€‚" } 
                }
            ]);

            const itinerary = ref([
                { day: 1, date_short: "2/25", date_en: "Wed", location: "Nagoya", places: [
                    { time: "14:30", name: "ä¸­éƒ¨åœ‹éš›æ©Ÿå ´", type: "transport", typeLabel: "æŠµé”", desc: "å…¥å¢ƒã€é ˜è¡Œæ (é è¨ˆ 1 å°æ™‚)ã€‚", highlights: ["å…¥å¢ƒ"], strategy: "å‡ºé—œå¾Œè·Ÿè‘—ã€Œåéµé›»è»Šã€è—è‰²æŒ‡æ¨™èµ°ï¼Œå‰å¾€æ©Ÿå ´ç«™ã€‚" }, 
                    { time: "15:30", name: "åéµ Î¼-Sky", type: "transport", typeLabel: "ç§»å‹•", desc: "å‰å¾€åå¤å±‹ç«™ã€‚", highlights: ["æŒ‡å®šå¸­"], strategy: "è³¼ç¥¨ï¼šè‡ªå‹•å”®ç¥¨æ©Ÿé¸ã€ŒÎ¼-ticketã€ï¼Œç›®çš„åœ°ã€ŒNagoyaã€ã€‚\nåŠƒä½ï¼šæ©Ÿå™¨ä¸Šé¸ 2 ä½æˆäººåŠé€£è™Ÿåº§ä½ã€‚\nè²»ç”¨ï¼šÂ¥1,430ã€‚" }, 
                    { time: "16:30", name: "è¥¿éµé…’åº— Croom", type: "stay", typeLabel: "Check-in", desc: "ä¹…å±‹å¤§é€šç«™ 4 è™Ÿå‡ºå£ã€‚", bookingType: "hotel", hotelLink: "https://hk.trip.com/hotels/ctorderdetail?orderid=1359041951884810", highlights: ["å¤§æµ´å ´"], strategy: "ä½ç½®ï¼šä¹…å±‹å¤§é€šç«™ 4 è™Ÿå‡ºå£æ­¥è¡Œ 1 åˆ†é˜ã€‚\nCheck-in å¾Œç¨ä½œä¼‘æ¯ã€‚" }, 
                    { time: "18:00", name: "Indo Ryori Kalash", type: "food", typeLabel: "æ™šé¤", desc: "åœ°éµé¶´èˆç·šã€Œæä¸­ç«™ã€ã€‚", highlights: ["å°åº¦å’–å“©"], strategy: "é€™æ˜¯æ‚¨æŒ‡å®šçš„ç‰¹è‰²é¤å»³ã€‚\næ­ä¹˜åœ°éµé¶´èˆç·šè‡³æä¸­ç«™ã€‚" }, 
                    { time: "20:00", name: "Oasis 21", type: "spot", typeLabel: "å¤œæ™¯", desc: "æ°´çš„å®‡å®™èˆ¹ã€‚", highlights: ["é›»è¦–å¡”"], strategy: "åœ¨é…’åº—é™„è¿‘ï¼Œå»ºè­°ä¸Šé ‚å±¤æ‹æ”åå¤å±‹é›»è¦–å¡”å¤œæ™¯ã€‚" }
                ]},
                { day: 2, date_short: "2/26", date_en: "Thu", location: "Nagoya", places: [
                    { time: "09:00", name: "Konparu æ¦®åº—", type: "food", typeLabel: "æ—©é¤", desc: "åå¤å±‹ç‚¸è¦ä¸‰æ˜æ²»ã€‚", highlights: ["ç‚¸è¦ä¸‰æ˜æ²»"], strategy: "å¿…åƒåå¤å±‹æ‹›ç‰Œç‚¸è¦ä¸‰æ˜æ²»ï¼Œå¯å…§ç”¨æˆ–å¤–å¸¶ã€‚" }, 
                    { time: "11:00", name: "å‰åœåŠ›å…¬åœ’ (å¤–éƒ¨)", type: "spot", typeLabel: "æ‹ç…§", desc: "æ„›ãƒ»åœ°çƒåšç´€å¿µå…¬åœ’ã€‚", highlights: ["é’æ˜¥ä¹‹ä¸˜"], strategy: "äº¤é€šï¼šæ­ä¹˜åœ°éµè½‰ Linimo ç·šã€‚\nå…ˆåœ¨å¤–éƒ¨åœ’å€æ‹ç…§ã€‚" }, 
                    { time: "12:00", name: "å‰åœåŠ›å¤§å€‰åº«", type: "spot", typeLabel: "é‡é»", desc: "éœ€ä¾é ç´„æ™‚é–“å…¥å ´ã€‚", bookingType: "ticket", ticketLink: "#", highlights: ["åå ´é¢å±•"], strategy: "å…§éƒ¨å±•è¦½è±å¯Œï¼Œå»ºè­°é ç•™ 3-4 å°æ™‚ã€‚\nä¸è¦é²åˆ°ï¼" }, 
                    { time: "18:00", name: "æ¦®å€è³¼ç‰©", type: "spot", typeLabel: "è³¼ç‰©", desc: "Tsubame Breadã€‚", highlights: ["ç´…è±†åå¸"], strategy: "æ¡è³¼è‘—åçš„ç´…è±†åå¸ã€‚\né€›é€›æ¦®å€å•†åœˆã€‚" }, 
                    { time: "19:00", name: "è“¬èŠè»’ (æ¾å‚å±‹)", type: "food", typeLabel: "æ™šé¤", desc: "é°»é­šé£¯ä¸‰åƒã€‚", highlights: ["é°»é­šé£¯"], strategy: "äººæ°£æ¥µé«˜ï¼Œå»ºè­°æŠµé”æ¦®å€æ™‚æå‰å»æ«ƒæª¯æŠ½è™Ÿç¢¼ç‰Œã€‚\n\n[â˜” å‚™æ¡ˆ]\nA. ã—ã‚‰æ²³ (Shirakawa): æ¦® Gas Building B1 (åƒ¹æ ¼è¦ªæ°‘)ã€‚\nB. åå¤å±‹å‚™é•· (Bincho): LACHIC 7F (å¯å¹å†·æ°£)ã€‚\nC. èŠ±å²¡ (Hanaoka): ä¸‰ä¹‹ä¸¸é™„è¿‘ (ç¨ç‰¹åƒæ³•)ã€‚" }, 
                    { time: "20:30", name: "HARBS æœ¬åº—", type: "food", typeLabel: "ç”œé»", desc: "æ°´æœåƒå±¤è›‹ç³•ã€‚", highlights: ["å¤–å¸¶"], strategy: "å¤–å¸¶æ‹›ç‰Œæ°´æœåƒå±¤è›‹ç³•å›é…’åº—äº«ç”¨ã€‚" }
                ]},
                { day: 3, date_short: "2/27", date_en: "Fri", location: "Nagoya", places: [
                    { time: "09:00", name: "Komeda's Coffee", type: "food", typeLabel: "æ—©é¤", desc: "é»å’–å•¡é€åå¸ã€‚", highlights: ["ç´…è±†æ³¥"], strategy: "åå¤å±‹ç‰¹è‰²æ—©é¤æ–‡åŒ–ï¼Œé»é£²æ–™é€åšç‰‡åå¸ã€‚" }, 
                    { time: "10:30", name: "åå¤å±‹æ¸¯æ°´æ—é¤¨", type: "spot", typeLabel: "æ™¯é»", desc: "è™é¯¨èˆ‡æµ·è±šè¡¨æ¼”ã€‚", highlights: ["è™é¯¨"], strategy: "é‡é»è§€çœ‹è™é¯¨èˆ‡æµ·è±šè¡¨æ¼”ï¼ˆé å®š 2.5 å°æ™‚ï¼‰ã€‚" }, 
                    { time: "13:30", name: "çŸ¢å ´ç‚¸è±¬æ’", type: "food", typeLabel: "åˆé¤", desc: "å‘³å™Œè±¬æ’ã€‚", highlights: ["éµæ¿"], strategy: "å“åšé“åœ°çš„åå¤å±‹å‘³å™Œè±¬æ’ã€‚" }, 
                    { time: "15:00", name: "å¤§é ˆå•†åº—è¡—", type: "spot", typeLabel: "é€›è¡—", desc: "ä¸‰è¼ªç¥ç¤¾ã€‚", highlights: ["å…”å­ç¥ç¤¾"], strategy: "åƒæ‹œå…”å­ç¥ç¤¾ï¼Œé«”é©—ç†±é¬§çš„å•†åº—è¡—ã€‚" }, 
                    { time: "17:00", name: "Piyorin å°é›è›‹ç³•", type: "food", typeLabel: "æ¶è³¼", desc: "CafÃ© Gentianeã€‚", highlights: ["æŒ‘æˆ°"], strategy: "âš ï¸ 17:00 æœ€å¾Œå‡ºçˆæ™‚é–“ï¼\nå¿…é ˆæº–æ™‚åœ¨åå¤å±‹ç«™æ’éšŠã€‚\n\n[â˜” å‚™æ¡ˆ]\nåœ°é›·ä¹Ÿç‚¸è¦é£¯ç³° (Tenmusu)ï¼Œåéµç™¾è²¨ B1 è³¼è²·å¤–å¸¶ã€‚" }, 
                    { time: "17:40", name: "MUJI åéµç™¾è²¨", type: "spot", typeLabel: "è³¼ç‰©", desc: "ç”Ÿæ´»é›œè²¨ã€‚", highlights: ["æ——è‰¦åº—"], strategy: "é€›ç”Ÿæ´»é›œè²¨è£œè²¨ï¼ˆé ç•™ 1.5 å°æ™‚ï¼‰ã€‚" }, 
                    { time: "19:30", name: "åå¤å±‹ç«™å‘¨é‚Š", type: "food", typeLabel: "æ™šé¤", desc: "å¯¬éºµæˆ–é›ç¿…ã€‚", highlights: ["æ‰‹ç¾½å…ˆ"], strategy: "æ¨è–¦é©›é‡œå¯¬éºµæˆ–ä¸–ç•Œä¹‹å±±å°‡é›ç¿…ã€‚" }
                ]},
                { day: 4, date_short: "2/28", date_en: "Sat", location: "Takayama", places: [
                    { time: "09:30", name: "æ¿ƒé£›å·´å£«", type: "transport", typeLabel: "ç§»å‹•", desc: "å‰å¾€é«˜å±±ã€‚", highlights: ["Web Ticket"], strategy: "åéµå·´å£«ä¸­å¿ƒ 3F æ­ä¹˜ã€‚\nä¸Šè»Šå‡ºç¤º Web Ticket æ‰‹æ©Ÿç•«é¢å³å¯ã€‚\nè²»ç”¨ï¼šä¾†å›ç¥¨æ¯äºº Â¥6,000ã€‚" }, 
                    { time: "12:30", name: "é«˜å±±æ±æ€¥ Stay", type: "stay", typeLabel: "å¯„æ”¾", desc: "æ­¥è¡Œ 2 åˆ†é˜å³é”ã€‚", bookingType: "hotel", hotelLink: "https://hk.trip.com/hotels/list?city=3652", highlights: ["è¿‘è»Šç«™"], strategy: "å…ˆå¯„æ”¾è¡Œæã€‚" }, 
                    { time: "13:00", name: "é«˜å±±è€è¡—", type: "spot", typeLabel: "æ•£ç­–", desc: "ä¸‰ç”ºé€šã€‚", highlights: ["é£›é©’ç‰›å£½å¸"], strategy: "æ¼«æ­¥é«˜å±±è€è¡—ï¼Œå“åšè·¯é‚Šæ”¤é£›é©’ç‰›ç¾é£Ÿã€‚" }, 
                    { time: "15:00", name: "Check-in", type: "stay", typeLabel: "å…¥ä½", desc: "é«˜å±±æ±æ€¥ Stayã€‚", highlights: ["ä¼‘æ¯"], strategy: "è¾¦ç†å…¥ä½æ‰‹çºŒï¼Œç¨ä½œä¼‘æ¯ã€‚" }, 
                    { time: "18:00", name: "å‘³è—å¤©åœ‹", type: "food", typeLabel: "æ™šé¤", desc: "é£›é©’ç‰›ç‡’è‚‰ã€‚", highlights: ["A5é£›é©’ç‰›"], strategy: "âš ï¸ ä¸èƒ½é ç´„ï¼è«‹åœ¨ 17:00 å·¦å³å…ˆå»é–€å£ç™»è¨˜åå­—æŠ½ç±¤ã€‚\n\n[â˜” å‚™æ¡ˆ]\nA. ä¸¸æ˜ (Maruaki): å°±åœ¨é™„è¿‘çš„å¦ä¸€ååº—ã€‚\nB. è€è¡—é£›é©’ç‰›æ¡å£½å¸ (è¼•é£Ÿ)ã€‚" }
                ]},
                { day: 5, date_short: "3/1", date_en: "Sun", location: "Shirakawa", places: [
                    { time: "08:10", name: "æ¿ƒé£›å·´å£«", type: "transport", typeLabel: "ç§»å‹•", desc: "å‰å¾€ç™½å·é„‰ã€‚", highlights: ["8A/8B"], strategy: "é ç´„ç·¨è™Ÿï¼š02062000931ï¼Œåº§ä½ 8A/8Bã€‚\né«˜å±±å·´å£«ç¸½ç«™ 4 è™Ÿæœˆå°å€™è»Šï¼Œå‡ºç¤º Email é›»å­ç¥¨ä¸Šè»Šã€‚" }, 
                    { time: "09:30", name: "åŸå±±å¤©å®ˆé–£", type: "spot", typeLabel: "å±•æœ›å°", desc: "ä¿¯ç°åˆæŒæ‘ã€‚", highlights: ["ç¶“å…¸è§’åº¦"], strategy: "è¶æ—©å…ˆæ­æ¥é§è»Šä¸Šå»æ‹ç…§ï¼Œé¿é–‹ä¸­åˆäººæ½®ã€‚" }, 
                    { time: "12:30", name: "Irori (ã„ã‚ã‚Š)", type: "food", typeLabel: "åˆé¤", desc: "æœ´è‘‰å‘³å™Œç‡’ã€‚", highlights: ["å‚³çµ±æ–™ç†"], strategy: "å“åšå‚³çµ±æœ´è‘‰å‘³å™Œç‡’ã€‚" }, 
                    { time: "13:30", name: "ä¸‰å°å±‹ (å¿ å…µè¡›)", type: "spot", typeLabel: "æ™¯é»", desc: "æ‘å­å¾Œæ–¹ã€‚", highlights: ["ç”°åœ’é¢¨å…‰"], strategy: "æ•£æ­¥åˆ°æ‘å­å¾Œæ–¹ï¼Œæ‹æ”æœ€è‘—åçš„ä¸‰å°å±‹é¢¨æ™¯ã€‚" }, 
                    { time: "14:15", name: "å–«èŒ¶è½äºº", type: "food", typeLabel: "ç”œé»", desc: "ç´…è±†æ¹¯ç„¡é™å–ã€‚", highlights: ["åœçˆè£"], strategy: "å–å’–å•¡ï¼Œäº«ç”¨åœçˆè£çƒ¤ç´…è±†æ¹¯ã€‚" }, 
                    { time: "15:45", name: "æ¿ƒé£›å·´å£«", type: "transport", typeLabel: "ç§»å‹•", desc: "è¿”å›é«˜å±±ã€‚", highlights: ["å›ç¨‹"], strategy: "æ™‚é–“ï¼š16:35 æŠµé”é«˜å±±ã€‚" },
                    { time: "18:00", name: "éºµå±‹ã—ã‚‰ã‹ã‚", type: "food", typeLabel: "æ™šé¤", desc: "é«˜å±±æ‹‰éºµååº—ã€‚", highlights: ["æ’éšŠåº—"], strategy: "é«˜å±±æ‹‰éºµä»£è¡¨ååº—ï¼Œæ¹¯é ­æ¿ƒéƒã€‚\n\n[â˜” å‚™æ¡ˆ]\nLE MIDI (å°±åœ¨é™„è¿‘)ï¼Œå“åšå¸ƒä¸æˆ–æ³•å¼é¤é»ã€‚" }
                ]},
                { day: 6, date_short: "3/2", date_en: "Mon", location: "Okuhida", places: [
                    { time: "09:40", name: "æ¿ƒé£›å·´å£«", type: "transport", typeLabel: "ç§»å‹•", desc: "å‰å¾€æ–°ç©—é«˜ã€‚", highlights: ["å¥—ç¥¨"], strategy: "åœ¨é«˜å±±å·´å£«ç«™è³¼è²·ã€Œå¥§é£›é©’ 2 æ—¥å¥—ç¥¨ã€(Â¥6,300)ã€‚" }, 
                    { time: "12:00", name: "æ–°ç©—é«˜å±±é ‚", type: "spot", typeLabel: "å±•æœ›å°", desc: "æ¨™é«˜ 2156mã€‚", highlights: ["é›ªä¹‹è¿´å»Š"], strategy: "æ¬£è³å…¨æ™¯åŠé›ªä¹‹è¿´å»Šã€‚" }, 
                    { time: "14:20", name: "å¹³æ¹¯å¤§ç€‘å¸ƒ", type: "spot", typeLabel: "æ­¥è¡Œæ”»ç•¥", desc: "é›ªåœ°å¥è¡Œã€‚", highlights: ["è—è‰²å†°ç€‘", "âš ï¸é˜²æ»‘é‹"], strategy: "è·¯ç·šï¼šå¾å¹³æ¹¯å·´å£«ç¸½ç«™å‡ºç™¼ï¼Œå¾€ç€‘å¸ƒæ–¹å‘èµ°ã€‚\nåœ°å½¢ï¼šé›ªåœ°å¾®ä¸Šå¡ï¼Œå–®ç¨‹ç´„ 25 åˆ†é˜ã€‚\nâš ï¸ è£å‚™å»ºè­°ï¼šå‹™å¿…ç©¿è‘—ã€Œé˜²æ»‘é‹ã€(é›ªé´æˆ–åŠ è£å†°çˆª)ï¼Œå› ç‚ºé›ªåœ°çµå†°éå¸¸æ»‘ï¼\næ™¯é»ï¼šé«˜é” 64 ç±³çš„ç€‘å¸ƒæœƒçµå†°æˆæ¼‚äº®çš„è—è‰²ï¼Œæ˜¯å†¬å­£é™å®šç¾æ™¯ã€‚" }, 
                    { time: "15:40", name: "å¹³æ¹¯å·´å£«ç«™", type: "food", typeLabel: "ä¼‘æ¯", desc: "è¶³æ¹¯èˆ‡ç‰›å¥¶ã€‚", highlights: ["æº«æ³‰è›‹"], strategy: "åƒæº«æ³‰è›‹ã€å–é£›é©’ç‰›å¥¶ã€äº«å—å…è²»è¶³æ¹¯ã€‚" }, 
                    { time: "18:30", name: "ä¸¸æ˜", type: "food", typeLabel: "æ™šé¤", desc: "é£›é©’ç‰›å£½å–œç‡’ã€‚", highlights: ["å£½å–œç‡’"], strategy: "é«˜å±±è‘—åé£›é©’ç‰›é¤å»³ã€‚" }
                ]},
                { day: 7, date_short: "3/3", date_en: "Tue", location: "Airport", places: [
                    { time: "09:00", name: "å®®å·æœå¸‚", type: "spot", typeLabel: "å¸‚é›†", desc: "æ²³é‚Šæ—©å¸‚ã€‚", highlights: ["ä¼´æ‰‹ç¦®"], strategy: "æœ€å¾Œæ¡è²·ç•¶åœ°è¾²ç”¢å“åŠå·¥è—å“ã€‚" }, 
                    { time: "12:00", name: "LE MIDI", type: "food", typeLabel: "åˆé¤", desc: "å—ç“œå¸ƒä¸ã€‚", highlights: ["ç”œé»"], strategy: "äº«ç”¨é«˜å±±ç¾é£Ÿã€‚" }, 
                    { time: "13:20", name: "æ¿ƒé£›å·´å£«", type: "transport", typeLabel: "ç§»å‹•", desc: "å‰å¾€åå¤å±‹ã€‚", highlights: ["å›ç¨‹"], strategy: "ä½¿ç”¨ä¾†å›ç¥¨å›ç¨‹ã€‚æŠµé”åéµå·´å£«ä¸­å¿ƒã€‚" }, 
                    { time: "17:20", name: "åéµ Î¼-Sky", type: "transport", typeLabel: "ç§»å‹•", desc: "å‰å¾€æ©Ÿå ´ã€‚", highlights: ["NGO"], strategy: "åœ¨åéµåå¤å±‹ç«™å”®ç¥¨æ©ŸåŠƒä½ä»˜æ¬¾ (Â¥1,430)ã€‚" }, 
                    { time: "21:00", name: "èµ·é£›è¿”æ¸¯", type: "transport", typeLabel: "é›¢å¢ƒ", desc: "UO685ã€‚", bookingType: "flight", flightNo: "UO685", terminal: "T2", highlights: [], strategy: "æ»¿è¼‰è€Œæ­¸ï¼" }
                ]}
            ]);

            const tabs = [ { id: 'itinerary', label: 'Plan', icon: 'fas fa-map-marked-alt' }, { id: 'wallet', label: 'Wallet', icon: 'fas fa-wallet' }, { id: 'packing', label: 'Pack', icon: 'fas fa-suitcase' }, { id: 'reservations', label: 'Resv', icon: 'fas fa-ticket-alt' }, { id: 'reminders', label: 'Tips', icon: 'fas fa-lightbulb' }, { id: 'tools', label: 'Tools', icon: 'fas fa-toolbox' } ];

            return { currentView, dayIndex, itinerary, budgetList, packingList, packingTab, newItem, showBudgetInput, detailModal, countdown, openDetail, openTicketDetail, addItem, deleteBudget, payers, tabs, keyLabels, walletMode, showWishlistInput, newWishItem, wishlist, handleImageUpload, addWishlist, deleteWishlist, currentDayWeather, budgetFilter, filteredBudgetList, filteredTotal, totalSpent, spentTszLok, spentTszTung, getTypeColor, tripProgress, nowFormatted, isModalOpen, phrases, 
                // Calc exports
                currencyRate, calcExpression, appendCalc, clearCalc, backspace, calculate, displayValue,
                // Resv & Utils (RESTORED HERE)
                ticketList, openTicketDetail, getMethodClass, getMethodBadge, getMethodLabel, getTicketsByMethod,
                // Cloud Status
                syncStatus, syncColor, saveData, syncPacking
            };
        }
    }).mount('#app');
</script>
</body>
</html>
