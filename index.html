<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ê¢ìÊ®ÇNagoya Trip v57</title>
    
    <link rel="apple-touch-icon" sizes="180x180" href="icon.jpg">
    <link rel="icon" type="image/jpeg" href="icon.jpg">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;700;900&family=Shippori+Mincho:wght@600;800&display=swap" rel="stylesheet">
    
    <style>
        /* THEME - "ËíºÁÅ∞„ÅÆÂú∞Â±§" Palette */
        :root {
            --bg-main: #70808f;     /* Slate Blue */
            --bg-card: #c5b59d;     /* Sand Beige */
            --text-on-card: #4a4238;/* Dark Brown */
            --text-on-bg: #f3f0eb;  /* Off White */
            --accent: #91867f;      /* Misty Umber */
            --glass-bg: rgba(112, 128, 143, 0.95); 
            --glass-border: rgba(197, 181, 157, 0.2); 
        }
        body { 
            font-family: 'Zen Maru Gothic', sans-serif; 
            background-color: var(--bg-main); 
            color: var(--text-on-bg); 
            margin: 0; padding: 0; 
            height: 100dvh; width: 100vw; 
            overflow: hidden; 
        }
        .font-mincho { font-family: 'Shippori Mincho', serif; }
        .glass { 
            background: var(--bg-card); 
            color: var(--text-on-card);
            border: 1px solid rgba(255,255,255,0.3); 
            border-radius: 20px; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .safe-top { padding-top: max(20px, env(safe-area-inset-top)); }
        .safe-bottom { padding-bottom: max(20px, env(safe-area-inset-bottom)); }
        .check-box input:checked + div { background-color: var(--accent); border-color: var(--accent); }
        [v-cloak] { display: none !important; }
        
        /* Utility */
        .bg-main { background-color: var(--bg-main); }
        .text-main { color: var(--text-on-card); }
    </style>
</head>
<body>

<div id="app" v-cloak class="flex flex-col h-full w-full max-w-md mx-auto relative bg-main">
    
    <main class="flex-1 overflow-y-auto overflow-x-hidden no-scrollbar z-10 pb-28 pt-safe-top px-5 scroll-smooth relative" ref="mainScroll">
        
        <div v-if="currentView === 'itinerary'" class="space-y-5 pb-4">
            <div class="flex justify-between items-center mb-2 mt-2">
                <div>
                    <div class="text-[10px] font-bold text-white/80 uppercase tracking-widest">JP.TRIP 2026</div>
                    <h1 class="text-3xl font-black font-mincho text-white flex items-center gap-2">
                        <i class="fas fa-chess-rook text-xl opacity-80"></i> Ê¢ìÊ®ÇNagoya Trip üáØüáµ
                    </h1>
                </div>
                <div class="w-10 h-10 rounded-full border-2 border-white/50 overflow-hidden shadow-lg bg-[#c5b59d]">
                    <img src="icon.jpg" class="w-full h-full object-cover" onerror="this.style.display='none'">
                </div>
            </div>

            <div class="glass p-5 relative overflow-hidden mb-2 shadow-xl">
                <div class="flex justify-between items-end mb-2">
                    <span class="text-xs font-bold opacity-60 uppercase tracking-wider">Ë∑ùÈõ¢Âá∫Áôº (HKO Time)</span>
                    <i class="fas fa-plane text-[#726251] animate-pulse"></i>
                </div>
                <div class="flex items-baseline gap-2 mb-4">
                    <span class="text-6xl font-black font-mono tracking-tighter">{{ countdown.days }}</span>
                    <span class="text-sm font-bold opacity-80">Days</span>
                    <span class="text-2xl font-mono font-bold ml-2">{{ countdown.hours }}:{{ countdown.minutes }}:{{ countdown.seconds }}</span>
                </div>
                <div class="relative w-full h-2 bg-[#4a4238]/10 rounded-full mt-2">
                    <div class="absolute top-0 left-0 h-full bg-[#726251] rounded-full transition-all duration-1000" :style="{ width: tripProgress + '%' }">
                        <i class="fas fa-plane absolute -right-2 -top-1.5 text-[#726251] text-xs transform rotate-45"></i>
                    </div>
                </div>
                <div class="flex justify-between mt-2 text-[10px] font-bold opacity-50 font-mono">
                    <span>Now ({{ nowFormatted }})</span>
                    <span>2026.02.25 Go</span>
                </div>
            </div>

            <div class="bg-[#70808f]/95 backdrop-blur-md sticky top-0 z-30 py-2 -mx-5 px-5 border-b border-[#c5b59d]/30 shadow-lg">
                <div class="flex gap-3 overflow-x-auto no-scrollbar">
                    <button v-for="(day, idx) in itinerary" :key="idx" @click="dayIndex = idx"
                            class="flex-shrink-0 w-12 h-14 rounded-xl flex flex-col items-center justify-center border transition-all cursor-pointer active:scale-95"
                            :class="dayIndex === idx ? 'bg-[#c5b59d] text-[#4a4238] border-[#c5b59d] shadow-lg scale-105' : 'bg-white/10 border-white/10 text-white/60'">
                        <span class="text-[9px] font-bold uppercase">{{ day.date_en.substr(0,3) }}</span>
                        <span class="text-lg font-black">{{ day.day }}</span>
                    </button>
                </div>
            </div>

            <div class="glass p-3 border-l-4 border-[#726251] flex items-center justify-between">
                <div class="flex flex-col">
                    <span class="text-[10px] font-bold opacity-60 uppercase tracking-wider">{{ itinerary[dayIndex].date_short }} Weather</span>
                    <span class="text-xs font-bold">{{ itinerary[dayIndex].location }}</span>
                </div>
                <div class="flex gap-3 overflow-x-auto no-scrollbar max-w-[65%]">
                    <div v-for="(h, i) in currentDayWeather" :key="i" class="flex flex-col items-center min-w-[2.5rem]">
                        <span class="text-[9px] opacity-60 font-mono">{{ h.time }}</span>
                        <i :class="h.icon" class="text-sm my-0.5"></i>
                        <span class="text-[10px] font-bold">{{ h.temp }}</span>
                    </div>
                </div>
            </div>

            <div class="relative pl-2">
                <div class="absolute left-[7px] top-2 bottom-0 w-[2px] bg-[#c5b59d]/30 rounded-full"></div>
                <div v-for="(place, pIdx) in itinerary[dayIndex].places" :key="pIdx" class="relative pl-8 mb-6 group">
                    <div class="absolute left-0 top-0 w-4 h-4 bg-[#c5b59d] border-[3px] border-[#70808f] rounded-full z-10"></div>
                    <div @click="openDetail(place)" class="glass p-4 relative overflow-hidden active:scale-[0.98] transition-all cursor-pointer hover:bg-[#d6c9b5] z-10">
                        <div class="flex justify-between items-start mb-2 relative z-10">
                            <span class="text-[10px] font-black bg-[#70808f] text-white px-2 py-1 rounded">{{ place.time }}</span>
                            <span class="text-[10px] font-bold opacity-60 uppercase">{{ place.typeLabel }}</span>
                        </div>
                        <h3 class="text-lg font-black mb-1 relative z-10">{{ place.name }}</h3>
                        <p class="text-xs opacity-80 line-clamp-1 mb-2 relative z-10">{{ place.desc }}</p>
                        
                        <div v-if="place.bookingType === 'flight'" class="mt-3 bg-[#70808f]/10 p-3 rounded-xl border border-[#70808f]/20 flex justify-between items-center relative z-20">
                            <div class="flex flex-col"><span class="text-[10px] font-bold uppercase opacity-60">Flight</span><span class="text-lg font-mono font-bold">{{ place.flightNo }}</span></div>
                            <div class="text-right"><span class="text-[10px] opacity-50 block">Info</span><span class="text-sm font-bold opacity-80">{{ place.terminal }}</span></div>
                        </div>
                        
                        <div class="flex flex-wrap gap-2 mt-2 relative z-10">
                            <span v-for="tag in place.highlights" class="px-2 py-1 bg-white/50 border border-black/5 rounded text-[10px] font-bold text-[#726251]">{{ tag }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'wallet'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">Spend & Buyyyyy</h2>
            <div class="flex bg-white/10 p-1 rounded-xl">
                <button @click="walletMode='expense'" class="flex-1 py-3 rounded-lg text-xs font-bold transition-all" :class="walletMode==='expense'?'bg-[#c5b59d] text-[#4a4238] shadow-sm':'text-white/60'">Ë®òÂ∏≥ Expenses</button>
                <button @click="walletMode='wishlist'" class="flex-1 py-3 rounded-lg text-xs font-bold transition-all" :class="walletMode==='wishlist'?'bg-[#c5b59d] text-[#4a4238] shadow-sm':'text-white/60'">Ë≥ºÁâ© Wishlist</button>
            </div>
            
            <div v-if="walletMode==='expense'" class="space-y-4">
                <div class="flex gap-2 overflow-x-auto no-scrollbar">
                    <button @click="budgetFilter='All'" class="px-4 py-2 rounded-full text-xs font-bold border transition-all" :class="budgetFilter==='All'?'bg-[#c5b59d] text-[#4a4238] border-[#c5b59d]':'bg-transparent text-white/60 border-white/20'">All</button>
                    <button @click="budgetFilter='TszLok'" class="px-4 py-2 rounded-full text-xs font-bold border transition-all" :class="budgetFilter==='TszLok'?'bg-[#91867f] text-white border-[#91867f]':'bg-transparent text-[#91867f] border-[#91867f]'">üë¶ TszLok</button>
                    <button @click="budgetFilter='TszTung'" class="px-4 py-2 rounded-full text-xs font-bold border transition-all" :class="budgetFilter==='TszTung'?'bg-[#726251] text-white border-[#726251]':'bg-transparent text-[#726251] border-[#726251]'">üëß TszTung</button>
                </div>
                
                <div class="glass p-5 flex justify-between items-center">
                    <div class="flex flex-col"><span class="text-xs font-bold opacity-60 uppercase mb-1">{{ budgetFilter }} Total</span><span class="text-3xl font-mono font-black">¬•{{ filteredTotal.toLocaleString() }}</span></div>
                    <div v-if="budgetFilter!=='All'" class="w-12 h-12 rounded-full flex items-center justify-center text-2xl" :class="budgetFilter==='TszLok'?'bg-[#91867f] text-white':'bg-[#726251] text-white'"><i class="fas" :class="budgetFilter==='TszLok'?'fa-male':'fa-female'"></i></div>
                </div>
                
                <div class="space-y-3 pb-20">
                    <div v-for="(item, idx) in filteredBudgetList" :key="idx" class="glass p-4 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs text-white shadow-sm" :class="item.payer==='TszLok'?'bg-[#91867f]':'bg-[#726251]'">{{ item.payer[0] }}</div>
                            <span class="text-sm font-bold">{{ item.name }}</span>
                        </div>
                        <div class="flex items-center gap-3"><span class="font-mono font-bold opacity-80">¬•{{ item.price }}</span><button @click="deleteBudget(item)" class="opacity-40 hover:text-red-600"><i class="fas fa-times text-xs"></i></button></div>
                    </div>
                </div>
                
                <div class="fixed bottom-24 right-6 z-40">
                    <button @click="showBudgetInput=true" class="w-14 h-14 bg-[#c5b59d] text-[#4a4238] rounded-full shadow-xl flex items-center justify-center text-xl border-2 border-white/20"><i class="fas fa-plus"></i></button>
                </div>
            </div>

            <div v-if="walletMode==='wishlist'" class="grid grid-cols-2 gap-4 pb-20">
                <div @click="showWishlistInput=true" class="glass p-4 flex flex-col items-center justify-center aspect-square border-2 border-dashed border-[#4a4238]/20 hover:bg-[#d6c9b5] cursor-pointer opacity-60 hover:opacity-100 transition-opacity">
                    <i class="fas fa-camera text-2xl mb-2"></i><span class="text-xs font-bold">Add Item</span>
                </div>
                <div v-for="(item, idx) in wishlist" :key="idx" class="glass overflow-hidden relative group">
                    <button @click="deleteWishlist(idx)" class="absolute top-2 right-2 w-6 h-6 bg-black/60 rounded-full flex items-center justify-center text-xs z-10 text-white"><i class="fas fa-times"></i></button>
                    <img :src="item.image" class="w-full aspect-square object-cover">
                    <div class="p-3"><div class="font-bold text-sm truncate">{{ item.name }}</div><div class="font-mono text-xs font-bold opacity-60">¬•{{ item.price }}</div></div>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'packing'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">Ë°åÊùéÊ∏ÖÂñÆ</h2>
            <div v-for="(group, key) in packingList" :key="key" class="glass overflow-hidden">
                <div class="bg-[#726251]/10 px-5 py-3 flex items-center gap-3 border-b border-[#4a4238]/10">
                    <i class="fas" :class="key==='handCarry'?'fa-briefcase':key==='tszLok'?'fa-male text-[#91867f]':key==='tszTung'?'fa-female text-[#726251]':'fa-box'"></i>
                    <span class="font-bold text-sm uppercase tracking-wide">{{ keyLabels[key] }}</span>
                </div>
                <div class="p-2 grid gap-1">
                    <label v-for="(item, idx) in group" :key="idx" class="flex items-center p-3 hover:bg-[#726251]/5 rounded-xl cursor-pointer check-box transition-colors">
                        <input type="checkbox" v-model="item.checked" class="hidden">
                        <div class="w-5 h-5 rounded border-2 border-[#4a4238]/30 flex items-center justify-center mr-3 transition-colors bg-white/50"><i class="fas fa-check text-[#4a4238] text-[10px] opacity-0"></i></div>
                        <span class="text-sm font-bold transition-opacity" :class="{'line-through opacity-40': item.checked}">{{ item.name }}</span>
                    </label>
                </div>
            </div>
        </div>

        <div v-if="currentView === 'info'" class="space-y-6 pt-4">
            <h2 class="text-2xl font-black font-mincho text-white">Ë≥áË®ä Info</h2>
            
            <div class="glass p-5 text-center">
                <div class="text-[10px] font-bold opacity-60 uppercase tracking-widest mb-1">Ë∑ùÈõ¢Âá∫Áôº (HKO)</div>
                <div class="text-3xl font-black font-mono">{{ countdown.days }} Days</div>
                <div class="text-sm font-bold opacity-60">{{ countdown.hours }} hrs {{ countdown.minutes }} mins</div>
            </div>

            <div class="glass p-5">
                <h3 class="text-xs font-bold opacity-60 uppercase tracking-widest mb-3"><i class="fas fa-calculator mr-2"></i>Currency Calc</h3>
                <div class="flex items-center gap-4">
                    <div class="flex-1 bg-white/50 rounded-xl p-3 border border-[#4a4238]/10">
                        <label class="text-[9px] font-bold opacity-50 block mb-1">JPY (¬•)</label>
                        <input type="number" v-model="currencyCalc.jpy" class="w-full font-mono font-bold text-xl bg-transparent outline-none text-[#4a4238]" placeholder="0">
                    </div>
                    <i class="fas fa-exchange-alt opacity-30 text-xs"></i>
                    <div class="flex-1 bg-white/50 rounded-xl p-3 border border-[#4a4238]/10">
                        <label class="text-[9px] font-bold opacity-50 block mb-1">HKD ($)</label>
                        <div class="font-mono font-bold text-xl text-[#726251]">{{ (currencyCalc.jpy * currencyCalc.rate).toFixed(1) }}</div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <nav class="fixed bottom-0 w-full h-[85px] bg-[#70808f]/95 backdrop-blur-xl border-t border-[#c5b59d]/20 z-50 flex justify-around items-center px-2 pb-safe-bottom">
        <button v-for="tab in tabs" :key="tab.id" @click="currentView = tab.id" class="flex flex-col items-center justify-center w-14 h-full space-y-1 transition-all cursor-pointer active:scale-95" :class="currentView === tab.id ? 'text-[#c5b59d] scale-110' : 'text-white/40'">
            <i :class="tab.icon" class="text-xl"></i>
            <span class="text-[9px] font-bold uppercase tracking-widest">{{ tab.label }}</span>
        </button>
    </nav>

    <div v-if="showBudgetInput" class="fixed inset-0 z-[60] flex items-end justify-center">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="showBudgetInput=false"></div>
        <div class="bg-[#c5b59d] w-full max-w-md h-[90vh] rounded-t-3xl animate-slide-up flex flex-col text-[#4a4238]">
            <div class="p-6 font-bold text-lg border-b border-[#4a4238]/10">Add Expense</div>
            <div class="flex-1 overflow-y-auto p-6 pb-40"> <div class="flex gap-3 mb-6">
                    <button v-for="p in payers" :key="p" @click="newItem.payer=p" class="flex-1 py-4 rounded-xl border font-bold text-sm transition-colors" :class="newItem.payer===p?(p==='TszLok'?'bg-[#91867f] text-white border-transparent':'bg-[#726251] text-white border-transparent'):'border-[#4a4238]/30 text-[#4a4238]/60'">{{ p }}</button>
                </div>
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold opacity-60 mb-2">Item Name</label>
                        <input v-model="newItem.name" class="w-full bg-white p-4 rounded-xl font-bold border-2 border-transparent text-[#4a4238] placeholder-[#4a4238]/30 focus:border-[#726251] outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-bold opacity-60 mb-2">Price (¬•)</label>
                        <input v-model.number="newItem.price" type="number" class="w-full bg-white p-4 rounded-xl font-bold border-2 border-transparent text-[#4a4238] placeholder-[#4a4238]/30 focus:border-[#726251] outline-none">
                    </div>
                </div>
                <div class="flex gap-3 mt-8">
                    <button @click="showBudgetInput=false" class="flex-1 py-4 font-bold text-[#4a4238]/50 bg-black/5 rounded-xl">Cancel</button>
                    <button @click="addItem" class="flex-1 py-4 bg-[#70808f] text-white rounded-xl font-bold shadow-lg">Save</button>
                </div>
            </div>
        </div>
    </div>
    
    <div v-if="showWishlistInput" class="fixed inset-0 z-[60] flex items-end justify-center">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="showWishlistInput=false"></div>
        <div class="bg-[#c5b59d] w-full max-w-md h-[90vh] rounded-t-3xl animate-slide-up flex flex-col text-[#4a4238]">
            <div class="p-6 font-bold text-lg border-b border-[#4a4238]/10">Add to Wishlist</div>
            
            <div class="flex-1 overflow-y-auto p-6 pb-40"> <div class="mb-6 relative group w-full">
                    <div v-if="!newWishItem.image" class="w-full h-48 bg-white/50 border-2 border-dashed border-[#4a4238]/30 rounded-xl flex flex-col items-center justify-center text-[#4a4238]/40 relative hover:bg-white/70 transition-colors">
                        <i class="fas fa-camera text-3xl mb-2"></i><span class="text-sm font-bold">Upload Photo</span>
                        <input type="file" accept="image/*" @change="handleImageUpload" class="absolute inset-0 w-full h-full opacity-0 z-20 cursor-pointer">
                    </div>
                    <div v-else class="relative w-full">
                        <img :src="newWishItem.image" class="w-full max-h-64 object-contain rounded-xl bg-black/10">
                        <div class="flex gap-3 mt-3">
                            <label class="flex-1 py-3 bg-white/50 rounded-xl text-sm font-bold text-center cursor-pointer hover:bg-white/80 text-[#4a4238]">Change<input type="file" accept="image/*" @change="handleImageUpload" class="hidden"></label>
                            <button @click="newWishItem.image = null" class="flex-1 py-3 bg-red-100 text-red-500 rounded-xl text-sm font-bold">Remove</button>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold opacity-60 mb-2">Product Name</label>
                        <input v-model="newWishItem.name" class="w-full bg-white p-4 rounded-xl font-bold border-2 border-transparent text-[#4a4238] outline-none focus:border-[#726251]">
                    </div>
                    <div>
                        <label class="block text-xs font-bold opacity-60 mb-2">Price (¬•)</label>
                        <input v-model.number="newWishItem.price" type="number" class="w-full bg-white p-4 rounded-xl font-bold border-2 border-transparent text-[#4a4238] outline-none focus:border-[#726251]">
                    </div>
                </div>

                <div class="flex gap-3 mt-8">
                    <button @click="showWishlistInput=false" class="flex-1 py-4 font-bold text-[#4a4238]/50 bg-black/5 rounded-xl">Cancel</button>
                    <button @click="addWishlist" class="flex-1 py-4 bg-[#70808f] text-white rounded-xl font-bold shadow-lg">Add Item</button>
                </div>
            </div>
        </div>
    </div>

    <div v-if="detailModal.show" class="fixed inset-0 z-[60] flex items-end justify-center"><div class="absolute inset-0 bg-black/80 backdrop-blur-sm" @click="detailModal.show=false"></div>
        <div class="bg-[#c5b59d] w-full max-w-md rounded-t-3xl p-6 relative animate-slide-up max-h-[85vh] overflow-y-auto text-[#4a4238]">
            <div class="w-12 h-1 bg-[#4a4238]/20 rounded-full mx-auto mb-6"></div>
            <span class="px-3 py-1 bg-[#70808f] text-white rounded-lg text-xs font-bold uppercase">{{ detailModal.data.typeLabel }}</span>
            <h2 class="text-2xl font-black mt-3 mb-2 font-mincho">{{ detailModal.data.name }}</h2>
            <div class="text-sm font-bold opacity-60 mb-6 flex items-center"><i class="far fa-clock mr-2"></i> {{ detailModal.data.time }}</div>
            <div class="space-y-6 text-sm leading-relaxed">
                <div v-if="detailModal.data.desc"><h4 class="text-xs font-bold opacity-50 uppercase tracking-widest mb-2">Description</h4><p class="font-bold whitespace-pre-line">{{ detailModal.data.desc }}</p></div>
                <div v-if="detailModal.data.strategy" class="bg-[#726251]/10 p-5 rounded-2xl border-l-4 border-[#726251]"><h4 class="text-xs font-bold uppercase tracking-widest mb-3 flex items-center"><i class="fas fa-chess-knight mr-2"></i>ÊîªÁï• Strategy</h4><div class="font-bold whitespace-pre-line">{{ detailModal.data.strategy }}</div></div>
            </div>
            <div class="mt-6 space-y-3">
                <a v-if="detailModal.data.ticketLink" :href="detailModal.data.ticketLink" target="_blank" class="block w-full py-4 bg-[#726251] text-white text-center rounded-2xl font-bold shadow-lg">View Ticket</a>
                <a v-if="detailModal.data.hotelLink" :href="detailModal.data.hotelLink" target="_blank" class="block w-full py-4 bg-[#91867f] text-white text-center rounded-2xl font-bold shadow-lg">View Hotel Booking</a>
            </div>
            <div class="h-6"></div>
            <button @click="openMap(detailModal.data.name)" class="w-full py-4 bg-white text-[#4a4238] rounded-2xl font-bold shadow-lg">Open Map</button>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, onMounted, watch } = Vue;

    createApp({
        setup() {
            const currentView = ref('itinerary'); 
            const dayIndex = ref(0);
            const detailModal = ref({ show: false, data: {} });
            const walletMode = ref('expense');
            const budgetFilter = ref('All'); 
            const showBudgetInput = ref(false);
            const showWishlistInput = ref(false);
            const payers = ['TszLok', 'TszTung'];
            const newItem = ref({ name: '', price: '', payer: 'TszLok' });
            const newWishItem = ref({ name: '', price: '', image: null });
            const budgetList = ref([]);
            const wishlist = ref([]);
            const currencyCalc = ref({ jpy: '', rate: 0.052 });

            const weatherDB = [
                { date: "2/25", hourly: [{time:"14:00",temp:"8¬∞",icon:"fas fa-cloud-sun"},{time:"16:00",temp:"7¬∞",icon:"fas fa-cloud"},{time:"18:00",temp:"6¬∞",icon:"fas fa-moon"},{time:"20:00",temp:"5¬∞",icon:"fas fa-moon"}] },
                { date: "2/26", hourly: [{time:"09:00",temp:"7¬∞",icon:"fas fa-sun"},{time:"12:00",temp:"11¬∞",icon:"fas fa-sun"},{time:"15:00",temp:"10¬∞",icon:"fas fa-cloud-sun"},{time:"18:00",temp:"7¬∞",icon:"fas fa-moon"}] },
                { date: "2/27", hourly: [{time:"10:00",temp:"9¬∞",icon:"fas fa-cloud"},{time:"13:00",temp:"12¬∞",icon:"fas fa-cloud-sun"},{time:"16:00",temp:"10¬∞",icon:"fas fa-cloud"},{time:"19:00",temp:"8¬∞",icon:"fas fa-cloud-rain"}] },
                { date: "2/28", hourly: [{time:"09:00",temp:"2¬∞",icon:"fas fa-snowflake"},{time:"12:00",temp:"3¬∞",icon:"fas fa-snowflake"},{time:"15:00",temp:"1¬∞",icon:"fas fa-snowflake"},{time:"18:00",temp:"-1¬∞",icon:"fas fa-snowflake"}] },
                { date: "3/1", hourly: [{time:"09:00",temp:"-2¬∞",icon:"fas fa-snowflake"},{time:"12:00",temp:"0¬∞",icon:"fas fa-snowflake"},{time:"15:00",temp:"-1¬∞",icon:"fas fa-cloud-meatball"},{time:"18:00",temp:"-4¬∞",icon:"fas fa-snowflake"}] },
                { date: "3/2", hourly: [{time:"09:00",temp:"-5¬∞",icon:"fas fa-snowflake"},{time:"12:00",temp:"-2¬∞",icon:"fas fa-sun"},{time:"15:00",temp:"-3¬∞",icon:"fas fa-cloud-sun"},{time:"18:00",temp:"-6¬∞",icon:"fas fa-moon"}] },
                { date: "3/3", hourly: [{time:"08:00",temp:"4¬∞",icon:"fas fa-cloud-sun"},{time:"12:00",temp:"9¬∞",icon:"fas fa-sun"},{time:"16:00",temp:"8¬∞",icon:"fas fa-cloud-sun"},{time:"20:00",temp:"6¬∞",icon:"fas fa-moon"}] }
            ];
            const currentDayWeather = computed(() => weatherDB[dayIndex.value]?.hourly || []);

            const packingList = ref({
                handCarry: [{name: 'ÂÄã‰∫∫Ë≠â‰ª∂ (Ë∫´ÂàÜË≠â/Ë≠∑ÁÖß/Á∞ΩË≠â)', checked: false}, {name: 'ÁôªÊ©üË≠â', checked: false}, {name: 'ÈäÄÂåÖ', checked: false}, {name: 'SIMÂç°', checked: false}, {name: 'ÊâãÊ©ü & ÂÖÖÈõª', checked: false}, {name: 'È†êÁ¥ÑË≠âÊòé', checked: false}, {name: 'Âè£ÁΩ©/Ê∂àÊØí', checked: false}],
                tszLok: [{name: 'Â§ñÂá∫Ë°£Áâ©', checked: false}, {name: 'Áù°Ë°£Ë§≤', checked: false}, {name: 'ÂÖßË°£Ë§≤ & Ë•™', checked: false}, {name: 'Â§ñÂ•ó', checked: false}, {name: 'Áî∑Â£´ÂâÉÈ¨ö', checked: false}, {name: 'ËΩâÊèí & ÊãñÊùø', checked: false}, {name: 'Èõ®ÂÇò/Èõ®Ë°£', checked: false}, {name: 'ÊãñÈûã', checked: false}, {name: 'ÂÇôÁî®ËÜ†Ë¢ã', checked: false}],
                tszTung: [{name: 'Â§ñÂá∫Ë°£Áâ©', checked: false}, {name: 'Áù°Ë°£Ë§≤', checked: false}, {name: 'ÂÖßË°£Ë§≤ & Ë•™', checked: false}, {name: 'Â§ñÂ•ó', checked: false}, {name: 'ÂåñÂ¶ùÂìÅ', checked: false}, {name: 'Ë≠∑ËÜöÂìÅ', checked: false}, {name: 'Ê¥óÈù¢/Ê¥óÈ´Æ', checked: false}, {name: 'È†≠È´ÆÂÆöÂûã', checked: false}, {name: 'Ê¢≥ & È¢®Á≠í', checked: false}, {name: 'Èö±ÂΩ¢ÁúºÈè°', checked: false}, {name: 'Â•≥ÊÄßË≠∑ÁêÜ', checked: false}, {name: 'ÊØõÂ∑æ', checked: false}, {name: 'ÂÖ¨‰ªî', checked: false}, {name: 'ÁÜ±Ê∞¥ÁÖ≤', checked: false}]
            });
            const keyLabels = { handCarry: 'Hand Carry', tszLok: 'TszLok (Boy)', tszTung: 'TszTung (Girl)' };

            const itinerary = ref([
                { day: 1, date_short: "2/25", date_en: "Wed", location: "Nagoya", places: [
                    { time: "14:30", name: "‰∏≠ÈÉ®ÂúãÈöõÊ©üÂ†¥", type: "transport", typeLabel: "ÊäµÈÅî", desc: "NGO ÊäµÈÅî„ÄÇË≥ºË≤∑ Œº-Sky„ÄÇ", bookingType: "flight", flightNo: "UO680", terminal: "T2 ÊäµÈÅî", highlights: ["Á∂†Ëå∂"], strategy: "Âá∫ÈóúÂæåË∑üËëó„ÄåÂêçÈêµÈõªËªä„ÄçÊåáÊ®ôËµ∞„ÄÇ\nÂéªËá™ÂãïÂîÆÁ•®Ê©üÊàñÊ´ÉÊ™ØË≥ºÁ•®„ÄÇ\nË≤∑‰∏ÄÁì∂Á∂†Ëå∂ (‰ºäÂè≥Ë°õÈñÄ)„ÄÇ" },
                    { time: "15:30", name: "ÂâçÂæÄÂ∏ÇÂçÄ", type: "transport", typeLabel: "ÁßªÂãï", desc: "ÂêçÈêµ‚ÜíÂêçÂè§Â±ãÁ´ô‚ÜíÊ´ªÈÄöÁ∑ö‚Üí‰πÖÂ±ãÂ§ßÈÄö„ÄÇ", highlights: ["Ê´ªÈÄöÁ∑ö"], strategy: "ÊäµÈÅîÂêçÂè§Â±ãÁ´ôÂæåÔºå‰∏çË¶ÅÂá∫Á´ôÂà∞Âú∞Èù¢ÔºåÁõ¥Êé•Êâæ„ÄåÊ´ªÈÄöÁ∑ö (Á¥ÖÁ∑ö)„ÄçÂú∞ÈêµÊåáÊ®ô„ÄÇ\nÂæÄ„ÄåÂæ∑Èáç„ÄçÊñπÂêëÔºå‰∏ãËªäÁ´ôÔºö‰πÖÂ±ãÂ§ßÈÄö„ÄÇ" },
                    { time: "16:30", name: "Ë•øÈêµÈÖíÂ∫ó Croom", type: "stay", typeLabel: "Check-in", desc: "‰πÖÂ±ãÂ§ßÈÄöÁ´ô 4B Âá∫Âè£„ÄÇ", bookingType: "hotel", hotelLink: "https://hk.trip.com/hotels/ctorderdetail?orderid=1359041951884810&token=XF5C1EA228E5100852402D0049339DF1962AD9B0C92EE50378311047DCFF0DBE&source=1&tripsignature=AAEAAQAHb3JkZXJpZPCgrtqAPnfjMBlMTZS7pUwyyMtXS1n0jzhz3GZ7Y-Md-tripsign&allianceid=&ouid=&sid=&locale=zh-HK", highlights: ["Â§ßÊµ¥Â†¥"], strategy: "Ëµ∞ 4B Êàñ 1A Âá∫Âè£ÔºàÊúâÈõªÊâ∂Ê¢ØÔºâ„ÄÇ\nC/I ÂæåÂÖàÂéªÂ§ßÊµ¥Â†¥Ê¥óÊæ°ÊàñÂú®ÊàøÈñì‰ºëÊÅØ„ÄÇ\nÈ£ØÂ∫óÂ∞çÈù¢Êúâ 7-11„ÄÇ" },
                    { time: "18:00", name: "Indo Ryori Kalash", type: "food", typeLabel: "ÊôöÈ§ê", desc: "Â∞ºÊ≥äÁàæÂíñÂì©„ÄÇËµ∑Âè∏ÁÉ§È§Ö‰ªΩÈáèÂ∑®Â§ß„ÄÇ", highlights: ["Cheese Naan"], strategy: "ÈÄôÊòØÂ∞ºÊ≥äÁàæ‰∫∫ÈñãÁöÑÂ∫ó„ÄÇ\nÂøÖÈªûÔºöCheese Naan (Ëµ∑Âè∏ÁÉ§È§Ö)„ÄÅButter Chicken Curry„ÄÅMango Lassi„ÄÇ\nÂÖ©‰∫∫Èªû‰∏Ä‰ªΩÁÉ§È§ÖÂàÜÈ£üÂç≥ÂèØ„ÄÇ" },
                    { time: "20:00", name: "Oasis 21", type: "spot", typeLabel: "Â§úÊôØ", desc: "Ê∞¥‰πãÂÆáÂÆôËàπ„ÄÇ", highlights: ["ÈõªË¶ñÂ°îÂÄíÂΩ±"], strategy: "Êê≠ÈõªÊ¢Ø‰∏äÈ†ÇÂ±§ÁéªÁíÉÂú∞Èù¢„ÄÇ\nËµ∞Âà∞Ê∞¥Ê±†Ê≠£‰∏≠Â§ÆÔºåÊãçÊîùÈõªË¶ñÂ°îÂÄíÂΩ±„ÄÇ" },
                    { time: "21:00", name: "‰æøÂà©ÂïÜÂ∫ó", type: "spot", typeLabel: "Êé°Ë≤∑", desc: "7-11 Ë≤∑ÂÆµÂ§ú„ÄÇ", highlights: ["ÁÑ¶Á≥ñÂÜ∞Ê∑áÊ∑ã"], strategy: "Ë≤∑ÂÆµÂ§úÂíåÊòéÂ§©ÁöÑÊ∞¥„ÄÇ\nOhayo ÁÑ¶Á≥ñÁÉ§Â∏ÉËïæÂÜ∞Ê∑áÊ∑ã (Êï≤Á¢éË°®Èù¢ÁÑ¶Á≥ñÂêÉ)„ÄÇ" }
                ]},
                { day: 2, date_short: "2/26", date_en: "Thu", location: "Nagoya", places: [
                    { time: "09:00", name: "Konparu Ê¶ÆÂ∫ó", type: "food", typeLabel: "Êó©È§ê", desc: "Â§ñÂ∏∂ÁÇ∏Ëù¶‰∏âÊòéÊ≤ªÂéªÂêâÂçúÂäõÈáéÈ§ê„ÄÇ", highlights: ["ÁÇ∏Ëù¶‰∏âÊòéÊ≤ª"], strategy: "ÈóúÈçµÁ≠ñÁï•ÔºöË∑üÂ∫óÂì°Ë™™ 'Take out, please'„ÄÇ\nÂ∏∂ÂéªÂêâÂçúÂäõÁï∂ÂçàÈ§êÔºåÁúÅ‰∏ãÂúíÂçÄÊéíÈöäÊôÇÈñì„ÄÇ\n‰∏çË¶ÅÂàáÈÇäÔºÅ" },
                    { time: "10:30", name: "ÂâçÂæÄÂêâÂçúÂäõ", type: "transport", typeLabel: "ÁßªÂãï", desc: "Ê¶Æ‚ÜíËó§‰πã‰∏ò‚ÜíLinimo„ÄÇ", highlights: ["Linimo"], strategy: "Âú®„ÄåÊ¶ÆÁ´ô„ÄçÊê≠Êù±Â±±Á∑öÂà∞ÁµÇÈªû„ÄåËó§‰πã‰∏ò„ÄçÔºåËΩâ Linimo Á£ÅÊµÆÂàóËªä„ÄÇ\nË≤∑ 7-11 ÊûúÊòî (Smoothie)„ÄÇ" },
                    { time: "12:00", name: "ÂêâÂçúÂäõÂ§ßÂÄâÂ∫´", type: "spot", typeLabel: "ÈáçÈªû", desc: "12:00 ÂÖ•Â†¥„ÄÇ", bookingType: "ticket", ticketLink: "https://quickticket.moala.fun/books?id=d1315e41-24de-40a9-a20a-0cf36d07ec8f", highlights: ["ÂêçÂ†¥Èù¢Â±ï"], strategy: "ÂãïÁ∑öÔºö1.ÂêçÂ†¥Èù¢Â±ï(ÊãçÁÖß) ‚Üí 2.ÁçµÊà∂Â∫ßÈõªÂΩ±Èô¢ ‚Üí 3.ÂêÉ‰∏âÊòéÊ≤ª ‚Üí 4.ÂïÜÂ∫ó„ÄÇ\nÂïÜÂ∫óË≤∑ÔºöÊπØÂ©ÜÂ©ÜÊàíÊåá„ÄÅÁÑ°ËáâÁî∑Âë®ÈÇä„ÄÇ\n‚ö†Ô∏è TszLok Ë´ãÂãôÂøÖÂ∏∂Ë≠∑ÁÖßÔºÅ" },
                    { time: "17:00", name: "Ê¶ÆÂçÄË≥ºÁâ©", type: "spot", typeLabel: "Ë≥ºÁâ©", desc: "Kapital, Montbell, BEAMS, Salomon.", highlights: ["Salomon", "È™®È†≠T", "ÁæΩÁµ®"], strategy: "ADDED: Salomon (CREARE) - ÂøÖÈÄõÔºÅ\nKapital (CREARE 1F): ÊâæÈ™®È†≠T/ÊãºÂ∏ÉÁâõ‰ªî„ÄÇ\nMontbell (Nadia Park 6F): Ë≤∑ÁæΩÁµ®Ë°£„ÄÇ\nOnitsuka Tiger (PARCO Ë•øÈ§® 1F)„ÄÇ" },
                    { time: "19:30", name: "ÁÜ±Áî∞Ëì¨ËêäËªí", type: "food", typeLabel: "ÊôöÈ§ê", desc: "ÊùæÂùÇÂ±ãÂçóÈ§® 10F„ÄÇ", booking: "#8823", highlights: ["È∞ªÈ≠öÈ£Ø‰∏âÂêÉ"], strategy: "17:30 ÂÖàÂéªÊäΩËôüÁ¢ºÁâå„ÄÇ\nÂøÖÂêÉÔºöÈ∞ªÈ≠öÈ£Ø‰∏âÂêÉ (Hitsumabushi)„ÄÇ\nË©¶Ë©¶Âä†È´òÊπØÁöÑËå∂Ê≥°È£Ø„ÄÇ" },
                    { time: "21:00", name: "HARBS Êú¨Â∫ó", type: "food", typeLabel: "ÁîúÈªû", desc: "ÈõªË¶ñÂ°îÊóÅ„ÄÇ", highlights: ["Ê∞¥ÊûúÂçÉÂ±§"], strategy: "Â∞±Âú®ÈõªË¶ñÂ°îÊóÅ„ÄÇ\nÂ¶ÇÊûúÊúâ‰ΩçÂ≠êÂ∞±ÂÖßÁî®ÔºåÊ≤í‰ΩçÂ≠êÂ∞±Â§ñÂ∏∂ (Takeout) ÂõûÈ£ØÂ∫ó„ÄÇ" }
                ]},
                { day: 3, date_short: "2/27", date_en: "Fri", location: "Nagoya", places: [
                    { time: "09:00", name: "Komeda's Coffee", type: "food", typeLabel: "Êó©È§ê", desc: "ÈªûÈ£≤ÊñôÈÄÅÁ¥ÖË±ÜÊ≥•ÂêêÂè∏„ÄÇ", highlights: ["Á¥ÖË±ÜÂêêÂè∏"], strategy: "È´îÈ©ó Morning Service„ÄÇ\nÂª∫Ë≠∞Âä†Èªû Mini Shiro-Noir (ÂÜ∞ËàáÁÅ´‰∏πÈ∫•È∫µÂåÖ)„ÄÇ" },
                    { time: "10:00", name: "ÂêçÂè§Â±ãÊ∏ØÊ∞¥ÊóèÈ§®", type: "spot", typeLabel: "ÊôØÈªû", desc: "ÂåóÈ§®ÁúãËôéÈØ®„ÄÇ", highlights: ["ËôéÈØ®", "Êµ∑Ë±öÁßÄ"], strategy: "Áõ¥Â•îÂåóÈ§® 3F ÁúãËôéÈØ®„ÄÇ\nÊü•Â•ΩÊµ∑Ë±öÁßÄÊôÇÈñìÔºåÊÉ≥ÊøïË∫´ÂùêÂâç4Êéí„ÄÇ\nÂçóÈ§®ÁúãÊ≤ô‰∏ÅÈ≠öÈ¢®Êö¥„ÄÇ" },
                    { time: "13:30", name: "Áü¢Â†¥ÁÇ∏Ë±¨Êéí", type: "food", typeLabel: "ÂçàÈ§ê", desc: "Â§ßÈ†àÂ∫ó„ÄÇÈêµÊùøÂë≥ÂôåË±¨Êéí„ÄÇ", highlights: ["ÈêµÊùø"], strategy: "ÂãôÂøÖÈªû„ÄåÈêµÊùø„ÄçÁ≥ªÂàó„ÄÇ\n‰∏ÄÂÆöË¶ÅÁ©øÁ¥ôÂúçÂÖúÔºåÈÜ¨Ê±ÅÊúÉÂô¥„ÄÇ\nÊ°å‰∏äËäùÈ∫ªÁ≤âÈö®ÊÑèÂä†„ÄÇ" },
                    { time: "15:00", name: "Â§ßÈ†àÂïÜÂ∫óË°ó", type: "spot", typeLabel: "ÈÄõË°ó", desc: "Alice on Wednesday, ‰∏âËº™Á•ûÁ§æ„ÄÇ", highlights: ["‰∏âËº™Á•ûÁ§æ"], strategy: "Alice on Wednesday: ÈëΩÂ∞èÈñÄÈÄ≤Âéª„ÄÇ\n‰∏âËº™Á•ûÁ§æ: Êë∏ÂÖîÂ≠êÁü≥ÂÉèÊ±ÇÂ•ΩÈÅã„ÄÇ\nSeria (ÁôæÂÖÉÂ∫ó)„ÄÅKannon Coffee„ÄÇ" },
                    { time: "17:00", name: "Muji ÂêçÈêµÁôæË≤®", type: "spot", typeLabel: "Ë≥ºÁâ©", desc: "‰∏≠ÈÉ®ÊúÄÂ§ßÊóóËâ¶Â∫ó„ÄÇ", highlights: ["ÂíñÂì©ÂåÖ"], strategy: "Âéª 'Muji Food' ÂçÄË≤∑Ë™øÁêÜÂåÖ„ÄÇ\nÂíñÂì©ÂåÖ„ÄÅÂπ¥Ëº™ËõãÁ≥ï„ÄÅ‰πæÁá•ËçâËéìÂ∑ßÂÖãÂäõ„ÄÇ" },
                    { time: "18:30", name: "Tsubame Bread", type: "food", typeLabel: "ÈªûÂøÉ", desc: "ÂêçÁ´ôÈôÑËøë„ÄÇ", highlights: ["ÁµπÈ¶ôÂêêÂè∏"], strategy: "Â§ñÂ∏∂‰∏ÄÊ¢ù„ÄåÁµπÈ¶ôÂêêÂè∏„Äç(Kinuka) Áï∂ÊòéÂ§©ÂéªÈ´òÂ±±ÁöÑÊó©È§ê„ÄÇ\nÁèæÂ†¥ÂêÉÂåóÊµ∑ÈÅìÁâõÂ•∂ÈúúÊ∑áÊ∑ã„ÄÇ" },
                    { time: "19:30", name: "È≥•ÈñãÁ∏ΩÊú¨ÂÆ∂", type: "food", typeLabel: "ÊôöÈ§ê", desc: "JR Gate Tower / ESCA„ÄÇ", highlights: ["Ë¶™Â≠ê‰∏º"], strategy: "‰ΩçÊñº JR Gate Tower Êàñ ESCA„ÄÇ\nÂêçÂè§Â±ã‰∫§Ë∂æÈõûÂè£ÊÑüÂÅèÁ°¨Q„ÄÇ\nÂøÖÈªûÈáëË≥ûË¶™Â≠ê‰∏º„ÄÅÊâãÁæΩÂÖà (ÁÇ∏ÈõûÁøÖ)„ÄÇ" },
                    { time: "20:30", name: "Piyorin ÊåëÊà∞", type: "food", typeLabel: "ÊåëÊà∞", desc: "Â∞èÈõûËõãÁ≥ï„ÄÇ", highlights: ["Piyorin"], strategy: "Âú®ËªäÁ´ôË≤∑Â∞èÈõûËõãÁ≥ï„ÄÇ\nÊâãÊåÅ‰øùÊåÅÊ∞¥Âπ≥ÔºåÊê≠ÈõªÊâ∂Ê¢ØË¶ÅÊäìÁ∑äÔºå‰∏çË¶ÅÊôÉÂãï„ÄÇ\nÂõûÈ£ØÂ∫óÊ≤íÂÄíÊâçÁÆóË¥è„ÄÇ" }
                ]},
                { day: 4, date_short: "2/28", date_en: "Sat", location: "Takayama", places: [
                    { time: "09:00", name: "JR Hida ÁâπÊÄ•", type: "transport", typeLabel: "ÁßªÂãï", desc: "ÂâçÂæÄÈ´òÂ±±„ÄÇ", highlights: ["ÊåáÂÆöÂ∏≠"], strategy: "ÂäÉ‰ΩçÊôÇÊåáÂêç 'Luggage Seat' (ÊúÄÂæå‰∏ÄÊéí)„ÄÇ\nÁÅ´ËªäÁæéÈ£üÔºöÂçÉÂ£ΩÁÇ∏Ëù¶È£ØÁ≥∞„ÄÅÊùæÊµ¶ÂïÜÂ∫óÈ£õÈ©íÁâõ‰æøÁï∂„ÄÇ" },
                    { time: "12:15", name: "È´òÂ±±Ê´ªÂ∫µ", type: "stay", typeLabel: "ÂØÑÊîæ", desc: "È´òÂ±±Á´ôÊóÅ„ÄÇ", bookingType: "hotel", hotelLink: "https://hk.trip.com/cw/hotel/ctOrderDetailPages/CheckOrderAuthPage.html?orderId=1359041951886445&locale=zh-HK&operate=OrderDetail&token=XB4CE8B65E4C1A9B51F4AB74B9B804819FE7D64930B951A2DB518044478D50D7&sign=AAEAAQAHb3JkZXJpZOyudZQ4DEJes1FdTePw_JT10SQJmS9FYEtZeLDRenkH-tripsign&requestid=10f6a615-a991-4765-86e8-fa746cf77a6c&source=1&allianceid=&ouid=&sid=", highlights: ["ÂØÑÊîæË°åÊùé"], strategy: "Âá∫Á´ôËµ∞ 3 ÂàÜÈêò„ÄÇÂØÑÊîæË°åÊùé (Check-inÂâç)ÔºåÊãøËôüÁ¢ºÁâå„ÄÇ" },
                    { time: "13:00", name: "È´òÂ±±ËÄÅË°ó", type: "spot", typeLabel: "Êï£Á≠ñ", desc: "‰∏âÁî∫ÈÄö„ÄÇ", highlights: ["È£õÈ©íÁâõÂ£ΩÂè∏"], strategy: "ÈÇäËµ∞ÈÇäÂêÉ„ÄÇ\nÂøÖÂêÉÔºöÈ£õÈ©íÁâõÊè°Â£ΩÂè∏ (ÂùÇÂè£Â±ã)„ÄÅÈ£õÈ©íÁâõÂåÖÂ≠ê (ÂñúÂÖ´ÈÉé)„ÄÇ\nÂéªËàπÂùÇÈÖíÈÄ†ÊäïÂπ£Ë©¶ÂñùÊ∏ÖÈÖí„ÄÇ" },
                    { time: "15:00", name: "Check-in", type: "stay", typeLabel: "‰ºëÊÅØ", desc: "Êèõ‰∏ä‰ΩúÂãôË°£„ÄÇ", highlights: ["È†ÇÊ®ìÈ¢®ÊôØ"], strategy: "1. Âú®Â§ßÂª≥ Pillow Bar Êê∂ÊûïÈ†≠„ÄÇ\n2. Êèõ‰∏ä‰ΩúÂãôË°£ (Samue)„ÄÇ\n3. ÂéªÈ†ÇÊ®ìÁúãÈ¢®ÊôØ„ÄÇ" },
                    { time: "18:00", name: "Âë≥ËóèÂ§©Âúã", type: "food", typeLabel: "ÊôöÈ§ê", desc: "È´òÂ±±Á¨¨‰∏ÄÁáíËÇâ„ÄÇ", highlights: ["A5È£õÈ©íÁâõ"], strategy: "ÂãôÂøÖÈ†êÁ¥Ñ„ÄÇËã•ÁÑ°È†êÁ¥ÑÔºå16:30 ÂéªÊéíÈöä„ÄÇ\nÂøÖÈªûÔºöÂë≥ËóèÁõõÊãºÁõ§ (Ajikura Mori)„ÄÇ\nA5 ÂíåÁâõÊ≤πËÑÇÂ§öÔºåÊ≤æËä•Êú´ÊàñÈπΩÊúÄÂ•ΩÂêÉ„ÄÇ" },
                    { time: "22:00", name: "Â§úÈ≥¥ÊãâÈ∫µ", type: "food", typeLabel: "ÂÆµÂ§ú", desc: "È£ØÂ∫óÂÖçË≤ª„ÄÇ", highlights: ["ÂÖçË≤ª"], strategy: "ÂéªÈ§êÂª≥ÂêÉÂÖçË≤ªÊãâÈ∫µ (Yonaki Soba)„ÄÇ\nÈÇÑÈ§ìÁöÑË©±Âéª Lawson Ë≤∑ÁÇ∏ÈõûÂ°äÂêõ (Red)„ÄÇ" }
                ]},
                { day: 5, date_short: "3/1", date_en: "Sun", location: "Shirakawa", places: [
                    { time: "08:00", name: "È£ØÂ∫óÊó©È§ê", type: "food", typeLabel: "Êó©È§ê", desc: "Êú¥ËëâÂë≥Âôå„ÄÇ", highlights: ["Êú¥ËëâÂë≥Âôå"], strategy: "Â∞àÊîªÈÑâÂúüÊñôÁêÜÂçÄ„ÄÇ\n‰∏ÄÂÆöË¶ÅÂêÉÊú¥ËëâÂë≥ÂôåÈÖçÁôΩÈ£Ø„ÄÅÈ£õÈ©íÁâõÂ•∂„ÄÅÈÜÉÊº¨Áâ©„ÄÇ" },
                    { time: "09:00", name: "ÊøÉÈ£õÂ∑¥Â£´", type: "transport", typeLabel: "ÁßªÂãï", desc: "ÂâçÂæÄÁôΩÂ∑ùÈÑâ„ÄÇ", highlights: ["ÊöàËªäËó•"], strategy: "Âú®ÊøÉÈ£õÂ∑¥Â£´‰∏≠ÂøÉÊê≠Ëªä„ÄÇ\nÊúÉÊöàËªäËÄÖÂÖàÂêÉËó•„ÄÇÂ∏∂‰∏ÄÁì∂Ê∞¥„ÄÇ" },
                    { time: "10:00", name: "ÁôΩÂ∑ùÈÑâÂêàÊéåÊùë", type: "spot", typeLabel: "‰∏ñÁïåÈÅ∫Áî¢", desc: "Â±ïÊúõÂè∞„ÄÅÂíåÁî∞ÂÆ∂„ÄÇ", highlights: ["Â±ïÊúõÂè∞"], strategy: "1. Êê≠Êé•ÈßÅËªä‰∏äÂüéÂ±±Â±ïÊúõÂè∞„ÄÇ\n2. Ëµ∞Ë∑Ø‰∏ãÂ±±ÈÄõÂíåÁî∞ÂÆ∂„ÄÇ\n3. Âéª‰∏âÂ∞èÂ±ãÊãçÁÖß„ÄÇ" },
                    { time: "12:00", name: "Âñ´Ëå∂ ËêΩ‰∫∫", type: "food", typeLabel: "ÂçàÈ§ê", desc: "Ochiudo„ÄÇ", highlights: ["Á¥ÖË±ÜÊπØ"], strategy: "ÂøÖÂêÉÔºöÂíñÂì©È£Ø„ÄÅÁ¥ÖË±ÜÊπØ (ÁÑ°ÈôêÁ∫åÁ¢ó)„ÄÇ\nÂùêÂú®Âú∞ÁàêÊóÅÊ∞£Ê∞õÂ•Ω„ÄÇ" },
                    { time: "16:00", name: "Ë≤∏ÂàáÈ¢®ÂëÇ", type: "spot", typeLabel: "Ê∫´Ê≥â", desc: "È£ØÂ∫óÁßÅ‰∫∫ÊπØÂ±ã„ÄÇ", highlights: ["ÁßÅ‰∫∫ÊπØÂ±ã"], strategy: "ÂõûÈ´òÂ±±ÂæåÔºåÂéªÈ†ÇÊ®ìÈ†êÁ¥ÑË≤∏ÂàáÈ¢®ÂëÇ (ÁßÅ‰∫∫ÊπØÂ±ã)„ÄÇ\nÊ≥°ÂÆåÂñùÂÖçË≤ªÁâõÂ•∂/ÂÜ∞Ê£í„ÄÇ" },
                    { time: "18:00", name: "‰∏∏Êòé", type: "food", typeLabel: "ÊôöÈ§ê", desc: "È£õÈ©íÁâõÂ£ΩÂñúÁáí„ÄÇ", highlights: ["Â£ΩÂñúÁáí"], strategy: "ÈÄ≤Â∫óÊåáÂêç 'Sukiyaki'„ÄÇ\nÊîªÁï•ÔºöËÇâÁâáÁÖÆÂ•Ω‰∏ÄÂÆöË¶ÅË£πÊªøÁîüËõãÊ∂≤ÂÜçÂÖ•Âè£„ÄÇ" },
                    { time: "20:00", name: "‰æøÂà©ÂïÜÂ∫ó", type: "spot", typeLabel: "Êé°Ë≤∑", desc: "Ë≤∑ÊòéÊó•Êó©È§ê„ÄÇ", highlights: ["R-1ÂÑ™Ê†º"], strategy: "Âõ†ÁÇ∫ÊòéÂ§©Ë¶ÅÊó©Ëµ∑ÂéªÈõ™Â±±„ÄÇ\nË≤∑ÈõûËõãÊ≤ôÊãâ‰∏âÊòéÊ≤ª„ÄÅÊòéÊ≤ª R-1 ÂÑ™Ê†ºÈ£≤„ÄÇ" }
                ]},
                { day: 6, date_short: "3/2", date_en: "Mon", location: "Okuhida", places: [
                    { time: "07:30", name: "Coffee Don", type: "food", typeLabel: "Êó©È§ê", desc: "Êò≠ÂíåÊ∞£Ê∞õËÄÅËàñ„ÄÇ", highlights: ["ÂêêÂè∏Â•óÈ§ê"], strategy: "1951Âπ¥ËÄÅËàñ„ÄÇÈªûÂêêÂè∏Â•óÈ§êÈÖçÈªëÂíñÂï°„ÄÇ\n‰∏çÊÉ≥Êó©Ëµ∑Â∞±Âú®ÊàøÂêÉ‰æøÂà©ÂïÜÂ∫óÊó©È§ê„ÄÇ" },
                    { time: "08:40", name: "ÂâçÂæÄÊñ∞Á©óÈ´ò", type: "transport", typeLabel: "ÁßªÂãï", desc: "Êê≠Â∑¥Â£´„ÄÇ", highlights: ["Â∑¶ÂÅ¥È¢®ÊôØ"], strategy: "ÂùêÂ∑¥Â£´Â∑¶ÂÅ¥ (Left Side) ÁúãÈ¢®ÊôØ„ÄÇ" },
                    { time: "10:45", name: "Alps no Pan", type: "food", typeLabel: "ÈªûÂøÉ", desc: "ÈçãÂπ≥È´òÂéüÁ´ô„ÄÇ", highlights: ["ÂèØÈ†å"], strategy: "Âú®ËΩâ‰πòÁ¨¨‰∫åÊÆµÁ∫úËªäÂâçÔºåÂéªÈ∫µÂåÖÂ∫óË≤∑ÂâõÂá∫ÁàêÁöÑÁèæÁÉ§ÂèØÈ†å (Croissant)„ÄÇ" },
                    { time: "11:00", name: "Êñ∞Á©óÈ´òÁ∫úËªä", type: "spot", typeLabel: "ÁµïÊôØ", desc: "ÈõôÂ±§Á∫úËªä„ÄÇ", highlights: ["Èõ™‰πãËø¥Âªä"], strategy: "Êê∂ÈõôÂ±§Á∫úËªä 2Ê®ì ‰ΩçÁΩÆ„ÄÇ\nÂ±±È†ÇÂéªËµ∞Èõ™‰πãËø¥Âªä„ÄÅÂØÑÊòé‰ø°Áâá„ÄÇ" },
                    { time: "14:00", name: "Âπ≥ÊπØ‰πãÊ£Æ", type: "spot", typeLabel: "Ê∫´Ê≥â", desc: "Êó•Ê≠∏Ê∫´Ê≥â„ÄÇ", highlights: ["Èõ™Ë¶ãÊ∫´Ê≥â"], strategy: "ÂõûÁ®ãÂ∑¥Â£´Âú®„ÄåÂπ≥ÊπØÊ∫´Ê≥â„Äç‰∏ã„ÄÇ\nÂêÉÈ£õÈ©íÁâõÈêµÊùøÁáí„ÄÇ\nÊ≥° 16 ÂÄãÈú≤Â§©Èõ™Ë¶ãÊ∫´Ê≥âÊ±†„ÄÇÈ´îÈ©óÈõ™‰∏≠Ë£∏Ë∫´Â•îË∑ë„ÄÇ" },
                    { time: "18:00", name: "Center4 Burger", type: "food", typeLabel: "ÊôöÈ§ê", desc: "È£õÈ©íÁâõÊº¢Â†°„ÄÇ", highlights: ["Êº¢Â†°"], strategy: "È´òÂ±±Á¨¨‰∏ÄÂêçÊº¢Â†°„ÄÇÈúÄÊèêÂâçÈ†êÁ¥Ñ„ÄÇ\nËã•ÁÑ°‰ΩçÔºåÂéªÂπ≥ÂÆâÊ®ÇÂêÉÈ§ÉÂ≠ê„ÄÇ" }
                ]},
                { day: 7, date_short: "3/3", date_en: "Tue", location: "Airport", places: [
                    { time: "08:00", name: "ÂÆÆÂ∑ùÊúùÂ∏Ç", type: "spot", typeLabel: "Â∏ÇÈõÜ", desc: "Ê≤≥ÈÇäÊó©Â∏Ç„ÄÇ", highlights: ["‰º¥ÊâãÁ¶Æ"], strategy: "Âè™Êî∂ÁèæÈáë„ÄÇË≤∑È§Ö‰πæÊùØÂíñÂï°„ÄÅÁÇ∏ËõãÁôΩÈúú„ÄÅÂë≥ÂôåÁÖéÈ§Ö„ÄÇ" },
                    { time: "11:00", name: "Ë±ÜÂ§©Áãó", type: "food", typeLabel: "ÂçàÈ§ê", desc: "È´òÂ±±ÊãâÈ∫µ„ÄÇ", highlights: ["‰∏≠ËèØÊãâÈ∫µ"], strategy: "ÊúÄÂæåÂ∑°Á¶Æ„ÄÇÈÜ¨Ê≤πÊπØÈ†≠ÔºåÊç≤Êç≤ÁöÑÁ¥∞È∫µ„ÄÇÂä†‰∏ÄÈ°ÜÂë≥Áéâ (Ëõã)„ÄÇ" },
                    { time: "13:30", name: "ÂâçÂæÄÊ©üÂ†¥", type: "transport", typeLabel: "ÁßªÂãï", desc: "ÊøÉÈ£õÂ∑¥Â£´Áõ¥ÈÅî„ÄÇ", highlights: ["È†êÁ¥Ñ"], strategy: "ÁµïÂ∞çË¶ÅÊ∫ñÊôÇ„ÄÇËªäÁ®ã 3.5 Â∞èÊôÇ„ÄÇ\n‰∏äËªäÂâçË≤∑Â•ΩÈõ∂È£üÈ£≤Êñô„ÄÅÊ∫ñÂÇôÊöàËªäËó•„ÄÇ" },
                    { time: "17:00", name: "‰∏≠ÈÉ®ÂúãÈöõÊ©üÂ†¥", type: "spot", typeLabel: "Èõ¢Â¢É", desc: "T2„ÄÇ", highlights: ["Ëù¶È§Ö"], strategy: "1. È†òË°åÊùé (Check-in)„ÄÇ\n2. ÈÄõ Flight of Dreams 787 ÂÆ¢Ê©ü„ÄÇ\n3. ÂéªÈ¢®‰πãÊµ¥ÁúãÈ£õÊ©üÊ≥°ËÖ≥„ÄÇ\n4. Ë≤∑Ëù¶È§Ö („Åà„Å≥„Åõ„Çì„Åπ„ÅÑ„ÅÆÈáå)„ÄÇ" },
                    { time: "21:00", name: "Ëµ∑È£õËøîÊ∏Ø", type: "transport", typeLabel: "Èõ¢Â¢É", desc: "UO685„ÄÇ", bookingType: "flight", flightNo: "UO685", terminal: "T2", highlights: [], strategy: "Â∏∂ËëóÊªøÊªøÁöÑÊà∞Âà©ÂìÅÂíåËÇöÂ≠êÂõûÂÆ∂ÔºÅ" }
                ]}
            ]);

            // COUNTDOWN: HKO TIME (UTC+8)
            const tripStart = new Date(2026, 1, 25, 9, 0, 0); // 2026-02-25
            const countdownStart = new Date(2026, 1, 3, 9, 0, 0); 
            
            // Sync with HK Time
            const getHKTime = () => {
                const now = new Date();
                const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
                return new Date(utc + (3600000 * 8)); // UTC+8
            };

            const now = ref(getHKTime());
            const nowFormatted = computed(() => now.value.toLocaleDateString('en-GB', { month: 'numeric', day: 'numeric' }));

            setInterval(() => {
                now.value = getHKTime();
            }, 1000);

            const countdown = computed(() => {
                const diff = tripStart - now.value;
                if(diff <= 0) return {days:0, hours:'00', minutes:'00', seconds:'00'};
                return { 
                    days: Math.floor(diff/(1000*60*60*24)), 
                    hours: Math.floor((diff%(1000*60*60*24))/(1000*60*60)).toString().padStart(2,'0'), 
                    minutes: Math.floor((diff%(1000*60*60))/(1000*60)).toString().padStart(2,'0'),
                    seconds: Math.floor((diff%(1000*60))/1000).toString().padStart(2,'0')
                };
            });
            
            const tripProgress = computed(() => {
                const totalDuration = tripStart - countdownStart; 
                const timePassed = now.value - countdownStart;
                const percentage = (timePassed / totalDuration) * 100;
                return Math.min(Math.max(percentage, 0), 100);
            });

            // IMAGE COMPRESSION HELPER (With Fallback)
            const compressImage = (file, callback) => {
                if(file.size < 500000) {
                    const reader = new FileReader();
                    reader.onload = (e) => callback(e.target.result);
                    reader.readAsDataURL(file);
                    return;
                }
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        try {
                            const canvas = document.createElement('canvas');
                            const MAX_WIDTH = 600; // Even more aggressive compression
                            const scaleSize = MAX_WIDTH / img.width;
                            if(scaleSize < 1) {
                                canvas.width = MAX_WIDTH;
                                canvas.height = img.height * scaleSize;
                            } else {
                                canvas.width = img.width;
                                canvas.height = img.height;
                            }
                            const ctx = canvas.getContext('2d');
                            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                            callback(canvas.toDataURL('image/jpeg', 0.5)); // 50% quality
                        } catch (e) {
                            alert("Compression failed, using raw image.");
                            callback(event.target.result);
                        }
                    }
                }
            };

            const handleImageUpload = (event) => { 
                const file = event.target.files[0]; 
                if(file) { 
                    compressImage(file, (result) => {
                        newWishItem.value.image = result; 
                    });
                } 
            };

            onMounted(() => { 
                try {
                    const b = localStorage.getItem('jp_v57_b'); if(b) budgetList.value = JSON.parse(b); 
                    const w = localStorage.getItem('jp_v57_w'); if(w) wishlist.value = JSON.parse(w); 
                    const p = localStorage.getItem('jp_v57_p'); if(p) packingList.value = JSON.parse(p);
                } catch(e) { console.error("Storage error", e); }
            });
            
            // Watchers with error handling for quota
            watch(budgetList, v => { try { localStorage.setItem('jp_v57_b', JSON.stringify(v)); } catch(e) { alert("Storage full!"); } }, {deep:true});
            watch(wishlist, v => { try { localStorage.setItem('jp_v57_w', JSON.stringify(v)); } catch(e) { alert("Storage full! Image too big."); } }, {deep:true});
            watch(packingList, v => { try { localStorage.setItem('jp_v57_p', JSON.stringify(v)); } catch(e) { console.error(e); } }, {deep:true});

            const getTypeColor = (t) => ({food:'border-[#726251] bg-[#c5b59d]', transport:'border-[#70808f] bg-[#c5b59d]', stay:'border-[#91867f] bg-[#c5b59d]', spot:'border-[#4a4238] bg-[#c5b59d]'}[t]||'border-gray-400');
            const openDetail = (p) => { detailModal.value = { show:true, data:p }; };
            const openMap = (n) => window.open(`https://www.google.com/maps/search/?api=1&query=${n} Japan`, '_blank');
            const addItem = () => { if(newItem.value.name&&newItem.value.price){ budgetList.value.unshift({...newItem.value}); showBudgetInput.value=false; newItem.value={name:'',price:'',payer:'TszLok'}; }};
            const deleteBudget = (item) => { const idx = budgetList.value.indexOf(item); if(idx>-1) budgetList.value.splice(idx,1); };
            const filteredBudgetList = computed(() => budgetFilter.value === 'All' ? budgetList.value : budgetList.value.filter(i => i.payer === budgetFilter.value));
            const filteredTotal = computed(() => filteredBudgetList.value.reduce((s,i)=>s+i.price,0));
            
            const addWishlist = () => { 
                if(newWishItem.value.name) { 
                    try {
                        wishlist.value.unshift({...newWishItem.value}); 
                        newWishItem.value = { name: '', price: '', image: null }; 
                        showWishlistInput.value = false; 
                    } catch(e) {
                        alert("Storage full! Try removing some items.");
                    }
                } 
            };
            const deleteWishlist = (idx) => wishlist.value.splice(idx, 1);

            const tabs = [ { id: 'itinerary', label: 'Plan', icon: 'fas fa-map-marked-alt' }, { id: 'wallet', label: 'Wallet', icon: 'fas fa-wallet' }, { id: 'packing', label: 'Pack', icon: 'fas fa-suitcase' }, { id: 'info', label: 'Info', icon: 'fas fa-info-circle' } ];

            return { currentView, dayIndex, itinerary, budgetList, packingList, newItem, showBudgetInput, detailModal, countdown, openDetail, openMap, addItem, deleteBudget, payers, tabs, keyLabels, walletMode, showWishlistInput, newWishItem, wishlist, handleImageUpload, addWishlist, deleteWishlist, currencyCalc, currentDayWeather, budgetFilter, filteredBudgetList, filteredTotal, getTypeColor, tripProgress, nowFormatted };
        }
    }).mount('#app');
</script>
</body>
</html>
